
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>biosteam.unit &#8212; BioSTEAM 0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">BioSTEAM 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for biosteam.unit</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Sat Aug 18 14:40:28 2018</span>

<span class="sd">@author: yoelr</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">IPython</span>
<span class="kn">from</span> <span class="nn">graphviz</span> <span class="k">import</span> <span class="n">Digraph</span>
<span class="kn">from</span> <span class="nn">.exceptions</span> <span class="k">import</span> <span class="n">notify_error</span>
<span class="kn">from</span> <span class="nn">.flowsheet</span> <span class="k">import</span> <span class="n">find</span>
<span class="kn">from</span> <span class="nn">.graphics</span> <span class="k">import</span> <span class="n">Graphics</span><span class="p">,</span> <span class="n">default_graphics</span>
<span class="kn">from</span> <span class="nn">.stream</span> <span class="k">import</span> <span class="n">Stream</span>
<span class="kn">from</span> <span class="nn">.proxy_stream</span> <span class="k">import</span> <span class="n">ProxyStream</span>
<span class="kn">from</span> <span class="nn">.heat_utility</span> <span class="k">import</span> <span class="n">HeatUtility</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="k">import</span> <span class="n">color_scheme</span><span class="p">,</span> <span class="n">Ins</span><span class="p">,</span> <span class="n">Outs</span><span class="p">,</span> <span class="n">missing_stream</span>
<span class="kn">from</span> <span class="nn">bookkeep</span> <span class="k">import</span> <span class="n">SmartBook</span>
<span class="kn">from</span> <span class="nn">.power_utility</span> <span class="k">import</span> <span class="n">PowerUtility</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">np</span><span class="p">,</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">biosteam</span>
<span class="n">CS</span> <span class="o">=</span> <span class="n">color_scheme</span>

<span class="n">dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Unit&#39;</span><span class="p">,)</span>

<span class="k">def</span> <span class="nf">_checkbounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return True if value is within bounds. Return False if value is out of bounds and issue a warning.</span>
<span class="sd">        </span>
<span class="sd">        **Parameters**</span>
<span class="sd">        </span>
<span class="sd">            **key:** [str] Name of value</span>
<span class="sd">            </span>
<span class="sd">            **value:** [number, Quantity, or array]</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bounds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">within_bounds</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">within_bounds</span> <span class="o">=</span> <span class="n">SmartBook</span><span class="o">.</span><span class="n">_checkbounds</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                                                   <span class="n">bounds</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">within_bounds</span>


<span class="c1"># %% Unit metaclass</span>

<span class="n">_Unit_is_done</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">class</span> <span class="nc">metaUnit</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Unit metaclass for wrapping up methods with error notifiers, adding key word arguments, and keeping track for Unit lines and inheritance.</span>

<span class="sd">    **Optional class definitions**</span>

<span class="sd">        **_kwargs** = {}: [dict] Default keyword arguments</span>

<span class="sd">        **_init():**</span>
<span class="sd">            Initialize components.</span>
<span class="sd">        </span>
<span class="sd">        **_setup()**</span>
<span class="sd">            Create cached data from kwargs. </span>

<span class="sd">        **_run()**</span>
<span class="sd">            Run rigorous simulation.</span>

<span class="sd">        **_design()**</span>
<span class="sd">            Update results &quot;Design&quot; dictionary with design requirements.</span>

<span class="sd">        **_cost()**</span>
<span class="sd">            Update results &quot;Cost&quot; dictionary with itemized cost.</span>

<span class="sd">    **Class Attributes** </span>

<span class="sd">        **CEPCI** = 567.5: [float] Chemical Engineering Plant Cost Index</span>
<span class="sd">        </span>
<span class="sd">        **_bounds** = {} [dict] Values should be tuples with lower and upper bounds.</span>
<span class="sd">        </span>
<span class="sd">        **_N_ins** = 1: [int] Expected number of input streams</span>

<span class="sd">        **_N_outs** = 2: [int] Expected number of output streams</span>

<span class="sd">        **_N_heat_utilities** = 0: [int] Number of heat utilities  </span>

<span class="sd">        **_has_power_utility** = False: [bool] If True, a PowerUtility object is created for every instance.</span>

<span class="sd">        line = [Defaults to the class name of the first child class]: [str] Name denoting the type of Unit class</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_enforce_bounds</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">_CEPCI</span> <span class="o">=</span> <span class="mf">567.5</span> <span class="c1"># Chemical engineering plant cost index (567.5 at 2017)</span>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">mcl</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">superclasses</span><span class="p">,</span> <span class="n">new_definitions</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prepare unit methods with wrappers for error notification, and add kwargs as key word arguments to __init__. Also initiallize by adding new Unit class to the main flowsheet line dictionary.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">_Unit_is_done</span><span class="p">:</span>
            <span class="c1"># Abstract Unit class</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">mcl</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">superclasses</span><span class="p">,</span> <span class="n">new_definitions</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Add error notification wrapper to every new unit method</span>
            <span class="k">for</span> <span class="n">method_name</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;_setup&#39;</span><span class="p">,</span> <span class="s1">&#39;_run&#39;</span><span class="p">,</span> <span class="s1">&#39;_operation&#39;</span><span class="p">,</span> <span class="s1">&#39;_design&#39;</span><span class="p">,</span> <span class="s1">&#39;_cost&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">new_definitions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">method_name</span><span class="p">):</span>
                    <span class="n">new_definitions</span><span class="p">[</span><span class="n">method_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">notify_error</span><span class="p">(</span><span class="n">new_definitions</span><span class="p">[</span><span class="n">method_name</span><span class="p">])</span>
    
            <span class="c1"># Make new Unit class</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">mcl</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">superclasses</span><span class="p">,</span> <span class="n">new_definitions</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__doc__</span> <span class="ow">is</span> <span class="n">Unit</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">:</span>
                <span class="c1"># Do not inherit docstring from Unit</span>
                <span class="bp">cls</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__doc__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;**Parameters**&#39;</span><span class="p">,</span> 
            <span class="s2">&quot;**Parameters**</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">+</span>
            
        <span class="s2">&quot;        **ID:** [str] Unique identification. If set as &#39;&#39;, a default ID will be chosen.</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">+</span>

        <span class="s2">&quot;        **outs:** tuple[str or Stream] Output streams or IDs to initialize output streams. If None, leave streams missing. If empty, default IDs will be given.</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">+</span>
        
        <span class="s2">&quot;        **ins:** tuple[str or Stream] Input streams or IDs to initialize input streams. If None, leave streams missing. If empty, default IDs will be given.&quot;</span><span class="p">)</span>
    
            <span class="c1"># Set line</span>
            <span class="c1"># default_line constitutes a new Unit class</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">line</span>
            <span class="k">if</span> <span class="n">line</span> <span class="ow">is</span> <span class="s1">&#39;Unit&#39;</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="c1"># Set new graphics object for new line</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">new_definitions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_graphics&#39;</span><span class="p">):</span>
                    <span class="bp">cls</span><span class="o">.</span><span class="n">_graphics</span> <span class="o">=</span> <span class="n">Graphics</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">new_definitions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;line&#39;</span><span class="p">):</span>
                <span class="c1"># Set new graphics for specified line</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">new_definitions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_graphics&#39;</span><span class="p">):</span>
                    <span class="bp">cls</span><span class="o">.</span><span class="n">_graphics</span> <span class="o">=</span> <span class="n">Graphics</span><span class="p">()</span>
            
            <span class="bp">cls</span><span class="o">.</span><span class="n">line</span> <span class="o">=</span> <span class="n">line</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\B([A-Z])&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot; \1&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="n">new_definitions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_kwargs&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s1">&#39;__init__&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_definitions</span><span class="p">:</span>
                <span class="c1"># Key word arguments to replace</span>
                <span class="n">inputs</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">inputs</span> <span class="o">+=</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="n">key</span>
        
                <span class="c1"># Begin changing __init__ to have kwargs by making a string to execute</span>
                <span class="n">str2exec</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;def __init__(self, ID=&#39;&#39;, outs=(), ins=None</span><span class="si">{inputs}</span><span class="s2">):</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">str2exec</span><span class="o">+=</span> <span class="n">f</span><span class="s2">&quot;     _(self, ID, outs, ins</span><span class="si">{inputs}</span><span class="s2">)&quot;</span>
        
                <span class="c1"># Execute string and replace __init__</span>
                <span class="n">globs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;_&#39;</span><span class="p">:</span> <span class="n">Unit</span><span class="o">.</span><span class="fm">__init__</span><span class="p">}</span>
                <span class="n">globs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">locs</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">exec</span><span class="p">(</span><span class="n">str2exec</span><span class="p">,</span> <span class="n">globs</span><span class="p">,</span> <span class="n">locs</span><span class="p">)</span>
                <span class="bp">cls</span><span class="o">.</span><span class="fm">__init__</span> <span class="o">=</span> <span class="n">locs</span><span class="p">[</span><span class="s1">&#39;__init__&#39;</span><span class="p">]</span>
            
            <span class="c1"># Make sure bounds are arrays for boundscheck</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_bounds</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">bounds</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">bounds</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="bp">cls</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">enforce_bounds</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;[bool] True if bounds are checked for all instances and False otherwise.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_enforce_bounds</span>
    <span class="nd">@enforce_bounds</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">enforce_bounds</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_checkbounds</span> <span class="o">=</span> <span class="n">_checkbounds</span> <span class="k">if</span> <span class="n">val</span> <span class="k">else</span> <span class="n">SmartBook</span><span class="o">.</span><span class="n">_boundsignore</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_enforce_bounds</span> <span class="o">=</span> <span class="n">val</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">CEPCI</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Chemical engineering plant cost index (CEPCI)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_CEPCI</span>
    <span class="nd">@CEPCI</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">CEPCI</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">CEPCI</span><span class="p">):</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_CEPCI</span> <span class="o">=</span> <span class="n">CEPCI</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">instances</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dictionary of weak references to all instances of the Unit class.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instances</span>
    
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">line</span> <span class="o">==</span> <span class="s1">&#39;Unit&#39;</span> <span class="ow">and</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;Unit&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="s1">&#39;biosteam.</span><span class="si">{cls.__name__}</span><span class="s1">&#39;</span>
        <span class="k">elif</span> <span class="bp">cls</span><span class="o">.</span><span class="n">line</span> <span class="o">==</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">or</span> <span class="bp">cls</span><span class="o">.</span><span class="n">line</span> <span class="o">==</span> <span class="s1">&#39;Unit&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="s1">&#39;Unit.</span><span class="si">{cls.__name__}</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{cls.line}</span><span class="s1">.</span><span class="si">{cls.__name__}</span><span class="s1">&#39;</span>

<span class="c1"># %% Unit Operation</span>


<div class="viewcode-block" id="Unit"><a class="viewcode-back" href="../../Unit.html#biosteam.Unit">[docs]</a><span class="k">class</span> <span class="nc">Unit</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">metaUnit</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Abstract parent class for Unit objects. Child objects must contain _setup, _run, _design and _cost methods to setup internal objects, estimate stream outputs of a Unit and find design and cost information. These methods should store information in the &#39;_results&#39; dictionary (an instance attribute).  </span>

<span class="sd">    **Parameters**</span>

<span class="sd">        **ID:** [str] Unique identification</span>

<span class="sd">        **outs:** tuple[str or Stream] Output streams or IDs to initialize output streams. If None, leave streams missing. If empty, default IDs will be given.</span>
<span class="sd">        </span>
<span class="sd">        **ins:** tuple[str or Stream] Input streams or IDs to initialize input streams. If None, leave streams missing. If empty, default IDs will be given.</span>

<span class="sd">        ****kwargs:** Keyword arguments that are stored to instance attribute `_kwargs` and later accessed by _setup, _run, _design, and _cost methods.</span>

<span class="sd">    **Class Definitions** </span>
<span class="sd">    </span>
<span class="sd">        **CEPCI** = 567.5: [float] Chemical Engineering Plant Cost Index</span>

<span class="sd">        **_kwargs** = {}: [dict] Default keyword arguments</span>

<span class="sd">        **_init():**</span>
<span class="sd">            Initialize components.</span>
<span class="sd">        </span>
<span class="sd">        **_setup()**</span>
<span class="sd">            Create cached data from _kwargs. </span>

<span class="sd">        **_run()**</span>
<span class="sd">            Run rigorous simulation.</span>

<span class="sd">        **_design()**</span>
<span class="sd">            Update results &quot;Design&quot; dictionary with design requirements.</span>

<span class="sd">        **_cost()**</span>
<span class="sd">            Update results &quot;Cost&quot; dictionary with itemized cost.</span>
<span class="sd">        </span>
<span class="sd">        **_bounds** = {} [dict] Values should be tuples with lower and upper bounds.</span>
<span class="sd">        </span>
<span class="sd">        **_N_ins** = 1: [int] Expected number of input streams</span>

<span class="sd">        **_N_outs** = 2: [int] Expected number of output streams</span>

<span class="sd">        **_N_heat_utilities** = 0: [int] Number of heat utilities  </span>

<span class="sd">        **_has_power_utility** = False: [bool] If True, a PowerUtility object is created for every instance.</span>

<span class="sd">        line = [Defaults to the class name of the first child class]: [str] Name denoting the type of Unit class</span>

<span class="sd">    **ins**</span>
<span class="sd">        </span>
<span class="sd">        list of input streams</span>
<span class="sd">        </span>
<span class="sd">    **outs**</span>
<span class="sd">    </span>
<span class="sd">        list of output streams</span>
<span class="sd">    </span>
<span class="sd">    **Examples**</span>
<span class="sd">    </span>
<span class="sd">        :doc:`Creating a Unit`</span>
<span class="sd">        </span>
<span class="sd">        :doc:`Using -pipe- notation`</span>
<span class="sd">        </span>
<span class="sd">        :doc:`Subclassing a Unit`</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="c1">### Abstract Attributes ###</span>
    
    <span class="c1"># [dict] Default units for results Operation and Design</span>
    <span class="n">_units</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="c1"># [bool] Should be True if it has any associated cost</span>
    <span class="n">_has_cost</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="c1"># [int or None] Expected number of input streams</span>
    <span class="n">_N_ins</span> <span class="o">=</span> <span class="mi">1</span>  
    
    <span class="c1"># [int or None] Expected number of output streams</span>
    <span class="n">_N_outs</span> <span class="o">=</span> <span class="mi">2</span>  
    
    <span class="c1"># [Bool] True if outs are proxy streams linked to ins</span>
    <span class="n">_has_proxystream</span> <span class="o">=</span> <span class="kc">False</span>
    
    <span class="c1"># [dict] Values should be tuples with lower and upper bounds for results dictionary.</span>
    <span class="n">_bounds</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="c1"># [int] number of heat utilities</span>
    <span class="n">_N_heat_utilities</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="c1"># [PowerUtility] A PowerUtility object, if required</span>
    <span class="n">_power_utility</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="c1"># [bool] If True, a PowerUtility object is created for every instance.</span>
    <span class="n">_has_power_utility</span> <span class="o">=</span> <span class="kc">False</span> 
    
    <span class="c1"># [dict] default key word arguments that are accessed by simulation method.</span>
    <span class="n">_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="c1"># [biosteam Graphics] a Graphics object for diagram representation.</span>
    <span class="n">_graphics</span> <span class="o">=</span> <span class="n">default_graphics</span>
    
    <span class="c1">#: [str] The general type of unit, regardless of class</span>
    <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;Unit&#39;</span>

    <span class="c1">### Other defaults ###</span>

    <span class="c1"># [list] Default ID starting letter and number</span>
    <span class="n">_default_ID</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># Default ID</span>
    <span class="n">_ID</span> <span class="o">=</span> <span class="kc">None</span> 
    
    <span class="c1">#: [list] HeatUtility objects associated to unit</span>
    <span class="n">_heat_utilities</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="c1">### Initialize ###</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ID</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">outs</span><span class="o">=</span><span class="p">(),</span> <span class="n">ins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize Unit object. See help(type(self)) for accurate signature.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            **ID:** [str] Unique identification</span>

<span class="sd">            **outs:** tuple[str or Stream] Output streams or IDs to initialize output streams. If None, leave streams missing. If empty, default IDs will be given.</span>
<span class="sd">            </span>
<span class="sd">            **ins:** tuple[str or Stream] Input streams or IDs to initialize input streams. If None, leave streams missing. If empty, default IDs will be given.</span>
<span class="sd">    </span>
<span class="sd">            ****kwargs:** Keyword arguments that are accessed by setup, run, operation, design, and cost methods</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">=</span> <span class="n">ID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_ins</span><span class="p">(</span><span class="n">ins</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_outs</span><span class="p">(</span><span class="n">outs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_results</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_heat_utils</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_power_util</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_install</span><span class="p">()</span>

<div class="viewcode-block" id="Unit.reset"><a class="viewcode-back" href="../../Unit.html#biosteam.Unit.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset unit with new kwargs.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_init_ins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ins</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize input streams.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ins</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ins</span> <span class="o">=</span> <span class="n">Ins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">missing_stream</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_N_ins</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ins</span><span class="p">,</span> <span class="n">Stream</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ins</span> <span class="o">=</span> <span class="n">Ins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ins</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ins</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ins</span> <span class="o">=</span> <span class="n">Ins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Stream</span><span class="p">(</span><span class="n">ins</span><span class="p">))</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">ins</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ins</span> <span class="o">=</span> <span class="n">Ins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">Stream</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_N_ins</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ins</span> <span class="o">=</span> <span class="n">Ins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">Stream</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ins</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">_init_outs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize output streams.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_proxystream</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outs</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_outs</span> <span class="o">=</span> <span class="n">Outs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ProxyStream</span><span class="p">(</span><span class="n">outs</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outs</span><span class="p">,</span> <span class="n">Stream</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_outs</span> <span class="o">=</span> <span class="n">Outs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ProxyStream</span><span class="o">.</span><span class="n">asproxy</span><span class="p">(</span><span class="n">outs</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">outs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_outs</span> <span class="o">=</span> <span class="n">Outs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">ProxyStream</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
                                  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_N_outs</span><span class="p">))</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">outs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_outs</span> <span class="o">=</span> <span class="n">Outs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">ProxyStream</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ins</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_outs</span> <span class="o">=</span> <span class="n">Outs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">ProxyStream</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
                                         <span class="k">else</span> <span class="n">ProxyStream</span><span class="o">.</span><span class="n">asproxy</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
                                         <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">outs</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outs</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_outs</span> <span class="o">=</span> <span class="n">Outs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Stream</span><span class="p">(</span><span class="n">outs</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outs</span><span class="p">,</span> <span class="n">Stream</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_outs</span> <span class="o">=</span> <span class="n">Outs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outs</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">outs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_outs</span> <span class="o">=</span> <span class="n">Outs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">missing_stream</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_N_outs</span><span class="p">)))</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">outs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_outs</span> <span class="o">=</span> <span class="n">Outs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">Stream</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_N_outs</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_outs</span> <span class="o">=</span> <span class="n">Outs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">Stream</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">outs</span><span class="p">))</span>        
    
    <span class="k">def</span> <span class="nf">_init_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize results attribute.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_results</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Design&#39;</span><span class="p">:</span> <span class="p">{},</span>
                         <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="p">{}}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_totalcosts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="c1">#: [list] Purchase price (USD) and utility cost (USD/hr)</span>
    
    <span class="k">def</span> <span class="nf">_init_heat_utils</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize heat utilities.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_N_heat_utilities</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">_heat_utilities</span> <span class="o">=</span> <span class="p">[</span><span class="n">HeatUtility</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span>
                                    <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_N_heat_utilities</span><span class="p">)]</span>
        
    <span class="k">def</span> <span class="nf">_init_power_util</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize power utility.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_power_utility</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_power_utility</span> <span class="o">=</span> <span class="n">PowerUtility</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">_install</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cache objects and/or replace methods for computational efficiency.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_cost</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span> <span class="o">=</span> <span class="n">Unit</span><span class="o">.</span><span class="n">_cost</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">simulate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Result dictionaries for all utilities</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_utils</span> <span class="o">=</span> <span class="n">utils</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">heat_utilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_heat_utilities</span>
            <span class="n">power_utility</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_power_utility</span>
            <span class="k">if</span> <span class="n">heat_utilities</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">heat_utilities</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">power_utility</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">power_utility</span><span class="p">)</span>
                
            <span class="c1"># Itemized purchase costs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_purchase_costs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;Cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">_link_streams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setup ProxyStream objects if any.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_proxystream</span><span class="p">:</span> 
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ins</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outs</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">ProxyStream</span><span class="p">):</span> <span class="n">o</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="n">i</span>
    
    <span class="c1"># Forward pipping</span>
    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Source streams.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Unit</span><span class="p">):</span>
            <span class="n">other</span><span class="o">.</span><span class="n">ins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span>
            <span class="k">return</span> <span class="n">other</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span><span class="p">[</span><span class="n">other</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Stream</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outs</span> <span class="o">=</span> <span class="n">other</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">outs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">other</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outs</span> <span class="o">=</span> <span class="n">other</span>
                <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sink streams.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ins</span><span class="p">[</span><span class="n">other</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Stream</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ins</span> <span class="o">=</span> <span class="n">other</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">other</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ins</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">other</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ins</span> <span class="o">=</span> <span class="n">other</span>
                <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1"># Backwards pipping</span>
    <span class="fm">__pow__</span> <span class="o">=</span> <span class="fm">__sub__</span>
    <span class="fm">__rpow__</span> <span class="o">=</span> <span class="fm">__rsub__</span>
    
    <span class="c1"># Abstract methods</span>
    <span class="k">def</span> <span class="nf">_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">_design</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span>

    <span class="c1"># Summary</span>
    <span class="k">def</span> <span class="nf">_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run _operation, _design, and _cost methods and update purchase price and total utility costs.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_design</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cost</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_totalcosts</span><span class="p">[:]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_purchase_costs</span><span class="p">),</span> <span class="nb">sum</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">cost</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utils</span><span class="p">)</span>

<div class="viewcode-block" id="Unit.simulate"><a class="viewcode-back" href="../../Unit.html#biosteam.Unit.simulate">[docs]</a>    <span class="k">def</span> <span class="nf">simulate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run rigourous simulation and determine all design requirements.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_link_streams</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="p">()</span></div>

<div class="viewcode-block" id="Unit.results"><a class="viewcode-back" href="../../Unit.html#biosteam.Unit.results">[docs]</a>    <span class="k">def</span> <span class="nf">results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_units</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return key results from simulation as a DataFrame if `with_units` is True or as a Series otherwise.&quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span>
        <span class="n">ID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">addkey</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">append</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">addval</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">append</span>
        <span class="k">if</span> <span class="n">with_units</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_power_utility</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_power_utility</span>
                <span class="n">addkey</span><span class="p">((</span><span class="s1">&#39;Power&#39;</span><span class="p">,</span> <span class="s1">&#39;Rate&#39;</span><span class="p">))</span>
                <span class="n">addkey</span><span class="p">((</span><span class="s1">&#39;Power&#39;</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">))</span>
                <span class="n">addval</span><span class="p">((</span><span class="s1">&#39;kW&#39;</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">rate</span><span class="p">))</span>
                <span class="n">addval</span><span class="p">((</span><span class="s1">&#39;kW&#39;</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">cost</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_heat_utilities</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_heat_utilities</span><span class="p">:</span>
                    <span class="n">addkey</span><span class="p">((</span><span class="n">i</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s1">&#39;Duty&#39;</span><span class="p">))</span>
                    <span class="n">addkey</span><span class="p">((</span><span class="n">i</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s1">&#39;Flow&#39;</span><span class="p">))</span>
                    <span class="n">addkey</span><span class="p">((</span><span class="n">i</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">))</span>
                    <span class="n">addval</span><span class="p">((</span><span class="s1">&#39;kJ/hr&#39;</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">duty</span><span class="p">))</span>
                    <span class="n">addval</span><span class="p">((</span><span class="s1">&#39;kg/hr&#39;</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">flow</span><span class="p">))</span>
                    <span class="n">addval</span><span class="p">((</span><span class="s1">&#39;USD/hr&#39;</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">cost</span><span class="p">))</span>
            <span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span>
            <span class="n">Cost</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Cost&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">ko</span><span class="p">,</span> <span class="n">vo</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">vo</span> <span class="ow">is</span> <span class="n">Cost</span><span class="p">:</span> <span class="k">continue</span>
                <span class="k">for</span> <span class="n">ki</span><span class="p">,</span> <span class="n">vi</span> <span class="ow">in</span> <span class="n">vo</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">addkey</span><span class="p">((</span><span class="n">ko</span><span class="p">,</span> <span class="n">ki</span><span class="p">))</span>
                    <span class="n">addval</span><span class="p">((</span><span class="n">units</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ki</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">vi</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">ki</span><span class="p">,</span> <span class="n">vi</span> <span class="ow">in</span> <span class="n">Cost</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">addkey</span><span class="p">((</span><span class="s1">&#39;Cost&#39;</span><span class="p">,</span> <span class="n">ki</span><span class="p">))</span>
                <span class="n">addval</span><span class="p">((</span><span class="s1">&#39;USD&#39;</span><span class="p">,</span> <span class="n">vi</span><span class="p">))</span>
            <span class="n">capital</span><span class="p">,</span> <span class="n">utility</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_totalcosts</span>
            <span class="n">addkey</span><span class="p">((</span><span class="s1">&#39;Purchase cost&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
            <span class="n">addval</span><span class="p">((</span><span class="s1">&#39;USD&#39;</span><span class="p">,</span> <span class="n">capital</span><span class="p">))</span>
            <span class="n">addkey</span><span class="p">((</span><span class="s1">&#39;Utility cost&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
            <span class="n">addval</span><span class="p">((</span><span class="s1">&#39;USD/hr&#39;</span><span class="p">,</span> <span class="n">utility</span><span class="p">))</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span>
                              <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">keys</span><span class="p">),</span>
                              <span class="p">(</span><span class="s1">&#39;Units&#39;</span><span class="p">,</span> <span class="n">ID</span><span class="p">))</span>
            <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span>
            <span class="k">return</span> <span class="n">df</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_power_utility</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_power_utility</span>
                <span class="n">addkey</span><span class="p">((</span><span class="s1">&#39;Power&#39;</span><span class="p">,</span> <span class="s1">&#39;Rate&#39;</span><span class="p">))</span>
                <span class="n">addkey</span><span class="p">((</span><span class="s1">&#39;Power&#39;</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">))</span>
                <span class="n">addval</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">rate</span><span class="p">)</span>
                <span class="n">addval</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">cost</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_heat_utilities</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_heat_utilities</span><span class="p">:</span>
                    <span class="n">addkey</span><span class="p">((</span><span class="n">i</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s1">&#39;Duty&#39;</span><span class="p">))</span>
                    <span class="n">addkey</span><span class="p">((</span><span class="n">i</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s1">&#39;Flow&#39;</span><span class="p">))</span>
                    <span class="n">addkey</span><span class="p">((</span><span class="n">i</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">))</span>
                    <span class="n">addval</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">duty</span><span class="p">)</span>
                    <span class="n">addval</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">flow</span><span class="p">)</span>
                    <span class="n">addval</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">cost</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ko</span><span class="p">,</span> <span class="n">vo</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">ki</span><span class="p">,</span> <span class="n">vi</span> <span class="ow">in</span> <span class="n">vo</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">addkey</span><span class="p">((</span><span class="n">ko</span><span class="p">,</span> <span class="n">ki</span><span class="p">))</span>
                    <span class="n">addval</span><span class="p">(</span><span class="n">vi</span><span class="p">)</span>
            <span class="n">capital</span><span class="p">,</span> <span class="n">utility</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_totalcosts</span>
            <span class="n">addkey</span><span class="p">((</span><span class="s1">&#39;Purchase cost&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
            <span class="n">addval</span><span class="p">(</span><span class="n">capital</span><span class="p">)</span>
            <span class="n">addkey</span><span class="p">((</span><span class="s1">&#39;Utility cost&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
            <span class="n">addval</span><span class="p">(</span><span class="n">utility</span><span class="p">)</span>
            <span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">keys</span><span class="p">))</span>
            <span class="n">series</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">ID</span>
            <span class="k">return</span> <span class="n">series</span></div>

    <span class="n">_checkbounds</span> <span class="o">=</span> <span class="n">_checkbounds</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">CEPCI</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Chemical engineering plant cost index (CEPCI).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">CEPCI</span>
    <span class="nd">@CEPCI</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">CEPCI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">CEPCI</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Cannot change class attribute through an instance.&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ID</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Unique Identification (str). If set as &#39;&#39;, it will choose a default ID.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span>

    <span class="nd">@ID</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">ID</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ID</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="c1"># Select a default ID if requested</span>
            <span class="n">Unit</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">letter</span><span class="p">,</span> <span class="n">number</span> <span class="o">=</span> <span class="n">Unit</span><span class="o">.</span><span class="n">_default_ID</span>
            <span class="n">Unit</span><span class="o">.</span><span class="n">_default_ID</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">ID</span> <span class="o">=</span> <span class="n">letter</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span> <span class="o">=</span> <span class="n">ID</span>
                <span class="n">find</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
                <span class="k">return</span>
        <span class="k">elif</span> <span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span> <span class="o">=</span> <span class="n">ID</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">i</span> <span class="ow">in</span> <span class="n">ID</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="s1">&#39;`~!@#$%^&amp;():&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;ID cannot contain any of the following special characters: `~!@#$%^&amp;():&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ID</span> <span class="o">=</span> <span class="n">ID</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="c1"># Remove old reference to this object</span>
        <span class="n">unitdict</span> <span class="o">=</span> <span class="n">find</span><span class="o">.</span><span class="n">unit</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span> <span class="ow">in</span> <span class="n">unitdict</span><span class="p">:</span> <span class="k">del</span> <span class="n">unitdict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ID</span><span class="p">]</span>
        <span class="n">unitdict</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span> <span class="o">=</span> <span class="n">ID</span>

    <span class="c1"># Input and output streams</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># list of input streams</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ins</span>
    <span class="nd">@ins</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">ins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">streams</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ins</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">streams</span><span class="p">)</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">outs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># list of output streams</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outs</span>
    <span class="nd">@outs</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">outs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">streams</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outs</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">streams</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_upstream_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return set of upsteam neighboring units.&quot;&quot;&quot;</span>
        <span class="n">neighbors</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ins</span><span class="p">:</span>
            <span class="n">u_source</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">source</span>
            <span class="k">if</span> <span class="n">u_source</span><span class="p">:</span> <span class="n">neighbors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">u_source</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">neighbors</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_downstream_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return set of downstream neighboring units.&quot;&quot;&quot;</span>
        <span class="n">neighbors</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outs</span><span class="p">:</span>
            <span class="n">u_sink</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">sink</span>
            <span class="k">if</span> <span class="n">u_sink</span><span class="p">:</span> <span class="n">neighbors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">u_sink</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">neighbors</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_downstream_units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return all units downstreasm.&quot;&quot;&quot;</span>
        <span class="n">downstream_units</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">outer_periphery</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_downstream_neighbors</span>
        <span class="n">inner_periphery</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">old_length</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">new_length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">new_length</span> <span class="o">!=</span> <span class="n">old_length</span><span class="p">:</span>
            <span class="n">old_length</span> <span class="o">=</span> <span class="n">new_length</span>
            <span class="n">inner_periphery</span> <span class="o">=</span> <span class="n">outer_periphery</span>
            <span class="n">downstream_units</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">inner_periphery</span><span class="p">)</span>
            <span class="n">outer_periphery</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">inner_periphery</span><span class="p">:</span>
                <span class="n">outer_periphery</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">unit</span><span class="o">.</span><span class="n">_downstream_neighbors</span><span class="p">)</span>
            <span class="n">new_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">downstream_units</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">downstream_units</span>

    <span class="k">def</span> <span class="nf">_neighborhood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return all neighboring units within given radius.</span>
<span class="sd">        </span>
<span class="sd">        **Parameters**</span>
<span class="sd">        </span>
<span class="sd">            **radius:**[int] Maxium number streams between neighbors.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">radius</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">radius</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">upstream_neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upstream_neighbors</span>
        <span class="n">downstream_neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_downstream_neighbors</span>
        <span class="n">neighborhood</span> <span class="o">=</span> <span class="n">upstream_neighbors</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">downstream_neighbors</span><span class="p">)</span>
        <span class="n">direct_neighborhood</span> <span class="o">=</span> <span class="n">neighborhood</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">radius</span><span class="p">):</span>
            <span class="n">neighbors</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">direct_neighborhood</span><span class="p">:</span>
                <span class="n">neighbors</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">neighbor</span><span class="o">.</span><span class="n">_upstream_neighbors</span><span class="p">)</span>
                <span class="n">neighbors</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">neighbor</span><span class="o">.</span><span class="n">_downstream_neighbors</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">neighbors</span> <span class="o">==</span> <span class="n">direct_neighborhood</span><span class="p">:</span> <span class="k">break</span>
            <span class="n">direct_neighborhood</span> <span class="o">=</span> <span class="n">neighbors</span>
            <span class="n">neighborhood</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">direct_neighborhood</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">neighborhood</span>

<div class="viewcode-block" id="Unit.diagram"><a class="viewcode-back" href="../../Unit.html#biosteam.Unit.diagram">[docs]</a>    <span class="k">def</span> <span class="nf">diagram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Display a `Graphviz &lt;https://pypi.org/project/graphviz/&gt;`__ diagram of the unit and all neighboring units within given radius.</span>
<span class="sd">        </span>
<span class="sd">        **Parameters**</span>
<span class="sd">        </span>
<span class="sd">            **radius:** [int] Maxium number streams between neighbors.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">radius</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">neighborhood</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_neighborhood</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>
            <span class="n">neighborhood</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">sys</span> <span class="o">=</span> <span class="n">biosteam</span><span class="o">.</span><span class="n">System</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">neighborhood</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">diagram</span><span class="p">()</span>
        
        <span class="n">graphics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graphics</span>

        <span class="c1"># Make a Digraph handle</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">Digraph</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;unit&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;unit&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;graph&#39;</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="s1">&#39;0.5&#39;</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span> <span class="n">outputorder</span><span class="o">=</span><span class="s1">&#39;edgesfirst&#39;</span><span class="p">,</span>
               <span class="n">nodesep</span><span class="o">=</span><span class="s1">&#39;1.1&#39;</span><span class="p">,</span> <span class="n">ranksep</span><span class="o">=</span><span class="s1">&#39;0.8&#39;</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="s1">&#39;1000&#39;</span><span class="p">)</span>  <span class="c1"># Specifications</span>
        <span class="n">f</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">rankdir</span><span class="o">=</span><span class="s1">&#39;LR&#39;</span><span class="p">)</span>  <span class="c1"># Left to right</span>

        <span class="c1"># If many streams, keep streams close</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ins</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outs</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;graph&#39;</span><span class="p">,</span> <span class="n">nodesep</span><span class="o">=</span><span class="s1">&#39;0.4&#39;</span><span class="p">)</span>

        <span class="c1"># Initialize node arguments based on unit and make node</span>
        <span class="n">graphics</span><span class="o">.</span><span class="n">node_function</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">type_</span> <span class="o">=</span> <span class="n">graphics</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="n">graphics</span><span class="o">.</span><span class="n">name</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">type_</span>
        <span class="n">f</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_graphics</span><span class="o">.</span><span class="n">node</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Set stream node attributes</span>
        <span class="n">f</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="s1">&#39;rarrow&#39;</span><span class="p">,</span> <span class="n">fillcolor</span><span class="o">=</span><span class="s1">&#39;#79dae8&#39;</span><span class="p">,</span>
               <span class="n">style</span><span class="o">=</span><span class="s1">&#39;filled&#39;</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s1">&#39;0.6&#39;</span><span class="p">,</span>
               <span class="n">height</span><span class="o">=</span><span class="s1">&#39;0.6&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">peripheries</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>

        <span class="c1"># Make nodes and edges for input streams</span>
        <span class="n">di</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Destination position of stream</span>
        <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ins</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">stream</span><span class="o">.</span><span class="n">ID</span> <span class="ow">or</span> <span class="n">stream</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;Missing Stream&#39;</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">f</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">ID</span><span class="p">)</span>  
            <span class="n">edge_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graphics</span><span class="o">.</span><span class="n">edge_in</span>
            <span class="k">if</span> <span class="n">di</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">edge_in</span><span class="p">):</span> <span class="n">di</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">f</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;edge&#39;</span><span class="p">,</span> <span class="n">arrowtail</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">arrowhead</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                   <span class="n">tailport</span><span class="o">=</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">edge_in</span><span class="p">[</span><span class="n">di</span><span class="p">])</span>
            <span class="n">f</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">di</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Make nodes and edges for output streams</span>
        <span class="n">oi</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Origin position of stream</span>
        <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">ID</span><span class="p">)</span> 
            <span class="n">edge_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graphics</span><span class="o">.</span><span class="n">edge_out</span>  
            <span class="k">if</span> <span class="n">oi</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">edge_out</span><span class="p">):</span> <span class="n">oi</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">f</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;edge&#39;</span><span class="p">,</span> <span class="n">arrowtail</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">arrowhead</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                   <span class="n">headport</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">edge_out</span><span class="p">[</span><span class="n">oi</span><span class="p">])</span>
            <span class="n">f</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">stream</span><span class="o">.</span><span class="n">ID</span><span class="p">)</span>
            <span class="n">oi</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Display digraph on console</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">SVG</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">))</span>
        <span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>
    
    <span class="c1">### Net input and output flows ###</span>
    
    <span class="c1"># Molar flow rates</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_mol_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Molar flows going in (kmol/hr).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">mol</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ins</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_mol_out</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Molar flows going out (kmol/hr).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">mol</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_molfrac_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Molar fractions going in (kmol/hr).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mol_in</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_molnet_in</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_molfrac_out</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Molar fractions going in.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mol_out</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_molnet_out</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_molnet_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Net molar flow going in (kmol/hr).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">molnet</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ins</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_molnet_out</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Net molar flow going out (kmol/hr).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">molnet</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span><span class="p">)</span>

    <span class="c1"># Mass flow rates</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_mass_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Mass flows going in (kg/hr).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">mass</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ins</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_mass_out</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Mass flows going out (kg/hr).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">mass</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_massfrac_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Mass fractions going in.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mass_in</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_massnet_in</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_massfrac_out</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Mass fractions going out.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mass_out</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_massnet_out</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_massnet_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Net mass flow going in (kg/hr).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">massnet</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ins</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_massnet_out</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Net mass flow going out (kg/hr).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">massnet</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span><span class="p">)</span>

    <span class="c1"># Volumetric flow rates</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_vol_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Volumetric flows going in (m3/hr).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">vol</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ins</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_volnet_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Net volumetric flow going in (m3/hr).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vol_in</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_volfrac_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Volumetric fractions going in.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vol_in</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_volnet_in</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_vol_out</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Volumetric flows going out (m3/hr).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">vol</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_volnet_out</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Net volumetric flow going out (m3/hr).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vol_out</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_volfrac_out</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Volumetric fractions going out.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vol_out</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_volnet_out</span>

    <span class="c1"># Enthalpy flow rates</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_H_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enthalpy flow going in (kJ/hr).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">H</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ins</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_H_out</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enthalpy flow going out (kJ/hr).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">H</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_Hf_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enthalpy of formation flow going in (kJ/hr).&quot;&quot;&quot;</span>
        <span class="n">_Hf_in</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ins</span><span class="p">:</span>
            <span class="n">_Hf_in</span> <span class="o">+=</span> <span class="n">stream</span><span class="o">.</span><span class="n">Hf</span>
        <span class="k">return</span> <span class="n">_Hf_in</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_Hf_out</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enthalpy of formation flow going out (kJ/hr).&quot;&quot;&quot;</span>
        <span class="n">_Hf_out</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span><span class="p">:</span>
            <span class="n">_Hf_out</span> <span class="o">+=</span> <span class="n">stream</span><span class="o">.</span><span class="n">Hf</span>
        <span class="k">return</span> <span class="n">_Hf_out</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_Hnet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Net enthalpy flow (including enthalpies of formation).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_H_out</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_H_in</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Hf_out</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Hf_in</span>
    
    <span class="c1"># Representation</span>
    <span class="k">def</span> <span class="nf">_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">show_units</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Information on unit.&quot;&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="s1">&#39;{type(self).__name__}: </span><span class="si">{self.ID}</span><span class="se">\n</span><span class="s1">&#39;</span>
              <span class="o">+</span> <span class="n">f</span><span class="s1">&#39;{CS.dim(&quot;ins...&quot;)}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ins</span><span class="p">:</span>
            <span class="n">stream_info</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">_info</span><span class="p">(</span><span class="o">**</span><span class="n">show_units</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;Missing Stream&#39;</span> <span class="ow">in</span> <span class="n">stream_info</span><span class="p">:</span>
                <span class="n">info</span> <span class="o">+=</span> <span class="n">f</span><span class="s1">&#39;[</span><span class="si">{i}</span><span class="s1">] </span><span class="si">{stream.ID}</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">_source</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">stream_info</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">source_info</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;  from  {type(unit).__name__}-</span><span class="si">{unit}</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">unit</span> <span class="k">else</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">info</span> <span class="o">+=</span> <span class="n">f</span><span class="s1">&#39;[</span><span class="si">{i}</span><span class="s1">] </span><span class="si">{stream.ID}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">source_info</span> <span class="o">+</span> <span class="n">stream_info</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">info</span> <span class="o">+=</span> <span class="n">f</span><span class="s1">&#39;{CS.dim(&quot;outs...&quot;)}</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outs</span><span class="p">:</span>
            <span class="n">stream_info</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">_info</span><span class="p">(</span><span class="o">**</span><span class="n">show_units</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;Missing Stream&#39;</span> <span class="ow">in</span> <span class="n">stream_info</span><span class="p">:</span>
                <span class="n">info</span> <span class="o">+=</span> <span class="n">f</span><span class="s1">&#39;[</span><span class="si">{i}</span><span class="s1">] </span><span class="si">{stream.ID}</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">_sink</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">stream_info</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">sink_info</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;  to  {type(unit).__name__}-</span><span class="si">{unit}</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">unit</span> <span class="k">else</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">info</span> <span class="o">+=</span> <span class="n">f</span><span class="s1">&#39;[</span><span class="si">{i}</span><span class="s1">] </span><span class="si">{stream.ID}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">sink_info</span> <span class="o">+</span> <span class="n">stream_info</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> &#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">    &#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">info</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<div class="viewcode-block" id="Unit.show"><a class="viewcode-back" href="../../Unit.html#biosteam.Unit.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">show_units</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prints information on unit.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">(</span><span class="o">**</span><span class="n">show_units</span><span class="p">))</span></div>
    
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span></div>

<span class="n">_Unit_is_done</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">BioSTEAM 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Yoel Cortes-Pena and Guest Group.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.4.
    </div>
  </body>
</html>