
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>biosteam.units.fermentation &#8212; BioSTEAM 0.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">BioSTEAM 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for biosteam.units.fermentation</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Thu Aug 23 22:45:47 2018</span>

<span class="sd">@author: yoelr</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">biosteam.units.reactor</span> <span class="k">import</span> <span class="n">BatchReactor</span>
<span class="kn">from</span> <span class="nn">biosteam.units.hx</span> <span class="k">import</span> <span class="n">HXutility</span>
<span class="kn">from</span> <span class="nn">biosteam</span> <span class="k">import</span> <span class="n">Stream</span><span class="p">,</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="k">import</span> <span class="n">odeint</span>

<div class="viewcode-block" id="Fermentation"><a class="viewcode-back" href="../../../Fermentation.html#biosteam.Fermentation">[docs]</a><span class="k">class</span> <span class="nc">Fermentation</span><span class="p">(</span><span class="n">BatchReactor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a Fermentation object which models large-scale batch fermentation for the production of 1st generation ethanol using yeast [1, 2, 3, 4]. Only sucrose and glucose are taken into account. Conversion is based on reaction time, *tau*. Cleaning and unloading time, *tau_0*, fraction of working volume, *V_wf*, and number of reactors, N_reactors, are attributes that can be changed. Cost of a reactor is based on the NREL batch fermentation tank cost assuming volumetric scaling with a 6/10th exponent [3].</span>
<span class="sd">    </span>
<span class="sd">    **Parameters**</span>
<span class="sd">    </span>
<span class="sd">        **tau:** Reaction time.</span>
<span class="sd">        </span>
<span class="sd">        **efficiency:** User enforced efficiency.</span>
<span class="sd">    </span>
<span class="sd">    **ins**</span>
<span class="sd">    </span>
<span class="sd">        [:] Inffluent streams</span>
<span class="sd">        </span>
<span class="sd">    **outs**</span>
<span class="sd">    </span>
<span class="sd">        [0] Effluent</span>
<span class="sd">        </span>
<span class="sd">        [1] CO2</span>
<span class="sd">    </span>
<span class="sd">    **References**</span>
<span class="sd">    </span>
<span class="sd">        [1] Oliveira, Samuel C., et al. &quot;Discrimination between ethanol inhibition models in a continuous alcoholic fermentation process using flocculating yeast.&quot; Applied biochemistry and biotechnology 74.3 (1998): 161-172.</span>
<span class="sd">        </span>
<span class="sd">        [2] Oliveira, Samuel C., et al. &quot;Continuous ethanol fermentation in a tower reactor with flocculating yeast recycle: scale-up effects on process performance, kinetic parameters and model predictions.&quot; Bioprocess Engineering 20.6 (1999): 525-530.</span>
<span class="sd">        </span>
<span class="sd">        [3] Oliveira, Samuel C., et al. &quot;Mathematical modeling of a continuous alcoholic fermentation process in a two-stage tower reactor cascade with flocculating yeast recycle.&quot; Bioprocess and biosystems engineering 38.3 (2015): 469-479.</span>
<span class="sd">        </span>
<span class="sd">        [4] Oliveira, Samuel C., et al. &quot;Kinetic Modeling of 1‚ÄêG Ethanol Fermentations.&quot; Fermentation Processes. InTech, 2017.</span>
<span class="sd">        </span>
<span class="sd">        [5] D. Humbird, R. Davis, L. Tao, C. Kinchin, D. Hsu, and A. Aden National. Renewable Energy Laboratory Golden, Colorado. P. Schoen, J. Lukas, B. Olthof, M. Worley, D. Sexton, and D. Dudgeon. Harris Group Inc. Seattle, Washington and Atlanta, Georgia. Process Design and Economics for Biochemical Conversion of Lignocellulosic Biomass to Ethanol Dilute-Acid Pretreatment and Enzymatic Hydrolysis of Corn Stover. May 2011. Technical Report NREL/TP-5100-47764</span>
<span class="sd">        </span>
<span class="sd">    .. note::</span>
<span class="sd">        </span>
<span class="sd">        A compound with CAS &#39;Yeast&#39; must be present in species.</span>
<span class="sd">        </span>
<span class="sd">    **Examples**</span>
<span class="sd">    </span>
<span class="sd">        :doc:`Fermentation Example`</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_units</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Reactor volume&#39;</span><span class="p">:</span> <span class="s1">&#39;m3&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Cycle time&#39;</span><span class="p">:</span> <span class="s1">&#39;hr&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Loading time&#39;</span><span class="p">:</span> <span class="s1">&#39;hr&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Total dead time&#39;</span><span class="p">:</span> <span class="s1">&#39;hr&#39;</span><span class="p">}</span>
    <span class="n">_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tau&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># Reaction time</span>
               <span class="s1">&#39;efficiency&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>  <span class="c1"># Theoretical efficiency</span>
    <span class="n">_N_heat_utilities</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_has_power_utility</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="c1">#: Cleaning and unloading time</span>
    <span class="n">tau_0</span> <span class="o">=</span> <span class="mi">12</span> 
    
    <span class="c1">#: Number of reactors</span>
    <span class="n">_N_reactors</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="c1">#: Fraction of filled tank to total tank volume</span>
    <span class="n">V_wf</span> <span class="o">=</span> <span class="mf">0.8</span>
    
    <span class="c1">#: Base CEPCI </span>
    <span class="n">CEPCI_0</span> <span class="o">=</span> <span class="mf">521.9</span> 
    
    <span class="c1">#: Base price (USD)    </span>
    <span class="n">C_0</span> <span class="o">=</span> <span class="mi">844000</span>
    
    <span class="c1">#: Base volume (m3)    </span>
    <span class="n">V_0</span> <span class="o">=</span> <span class="mi">3785</span>
    
    <span class="c1">#: Scaling exponent for costing</span>
    <span class="n">exp</span> <span class="o">=</span> <span class="mf">0.6</span> 
    
    <span class="c1">#: Base agitator price (USD)</span>
    <span class="n">C_A</span> <span class="o">=</span> <span class="mi">52500</span> 
    
    <span class="c1">#: Base agitator power (kW)</span>
    <span class="n">A_p</span> <span class="o">=</span> <span class="mf">22.371</span>
    
    <span class="c1">#: tuple of kinetic parameters for the kinetic model. Default constants are fitted for Oliveria&#39;s model (mu_m1, mu_m2, Ks1, Ks2, Pm1, Pm2, Xm, Y_PS, a)</span>
    <span class="n">kinetic_constants</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.31</span><span class="p">,</span>  <span class="c1"># mu_m1</span>
                         <span class="mf">1.01</span><span class="p">,</span>  <span class="c1"># mu_m2</span>
                         <span class="mf">1.88</span><span class="p">,</span>  <span class="c1"># Ks1</span>
                         <span class="mf">2.81</span><span class="p">,</span>  <span class="c1"># Ks2</span>
                         <span class="mf">82.8</span><span class="p">,</span>  <span class="c1"># Pm1</span>
                         <span class="mf">108.2</span><span class="p">,</span> <span class="c1"># Pm2</span>
                         <span class="mf">113.4</span><span class="p">,</span> <span class="c1"># Xm</span>
                         <span class="mf">0.45</span><span class="p">,</span>  <span class="c1"># Y_PS</span>
                         <span class="mf">0.18</span><span class="p">)</span>  <span class="c1"># a</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">N_reactors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enforced Number of batch reactors.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_N_reactors</span>
    
    <span class="nd">@N_reactors</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">N_reactors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">N</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Number of reactors must be greater than 1, value </span><span class="si">{N}</span><span class="s2"> is infeasible&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_N_reactors</span> <span class="o">=</span> <span class="n">N</span>

    <span class="k">def</span> <span class="nf">_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cooler</span> <span class="o">=</span> <span class="n">hx</span> <span class="o">=</span> <span class="n">HXutility</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_heat_utilities</span> <span class="o">=</span> <span class="n">hx</span><span class="o">.</span><span class="n">_heat_utilities</span>
    
    <span class="k">def</span> <span class="nf">_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span><span class="p">[</span><span class="s1">&#39;tau&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Reaction time must be larger than 0, not &#39;</span><span class="si">{self._kwargs[&#39;tau&#39;]}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_calc_efficiency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feed</span><span class="p">,</span> <span class="n">tau</span><span class="p">):</span>
        <span class="c1"># Get initial concentrations</span>
        <span class="n">y</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="s1">&#39;Yeast&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;64-17-5&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;492-61-5&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;7732-18-5&#39;</span><span class="p">,</span> <span class="n">CAS</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">mass</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="n">mass</span>
        <span class="n">volnet</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="n">volnet</span>
        <span class="n">concentration_in</span> <span class="o">=</span> <span class="n">mass</span><span class="o">/</span><span class="n">volnet</span>
        <span class="n">X0</span><span class="p">,</span> <span class="n">P0</span><span class="p">,</span> <span class="n">S0</span> <span class="o">=</span> <span class="p">(</span><span class="n">concentration_in</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>
        
        <span class="c1"># Integrate to get final concentration</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="n">C_t</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kinetic_model</span><span class="p">,</span> <span class="p">(</span><span class="n">X0</span><span class="p">,</span> <span class="n">P0</span><span class="p">,</span> <span class="n">S0</span><span class="p">),</span> <span class="n">t</span><span class="p">,</span>
                     <span class="n">args</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kinetic_constants</span><span class="p">)</span>
        <span class="c1"># Cache data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_X</span> <span class="o">=</span> <span class="n">C_t</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_P</span> <span class="o">=</span> <span class="n">C_t</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_S</span> <span class="o">=</span> <span class="n">S</span> <span class="o">=</span> <span class="n">C_t</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
        
        <span class="c1"># Calculate efficiency</span>
        <span class="n">Sf</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">Sf</span> <span class="o">=</span> <span class="n">Sf</span> <span class="k">if</span> <span class="n">Sf</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">Y_PS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kinetic_constants</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">eff</span> <span class="o">=</span> <span class="p">(</span><span class="n">S0</span> <span class="o">-</span> <span class="n">Sf</span><span class="p">)</span><span class="o">/</span><span class="n">S0</span> <span class="o">*</span> <span class="n">Y_PS</span><span class="o">/</span><span class="mf">0.511</span>
        <span class="k">return</span> <span class="n">eff</span>
        
<div class="viewcode-block" id="Fermentation.kinetic_model"><a class="viewcode-back" href="../../../Fermentation.html#biosteam.Fermentation.kinetic_model">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">kinetic_model</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="o">*</span><span class="n">kinetic_constants</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;(dXdt, dPdt, dSdt)&#39;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return change of yeast, ethanol, and substrate concentration in kg/m3.</span>
<span class="sd">        </span>
<span class="sd">        **Parameters**</span>
<span class="sd">        </span>
<span class="sd">            **z:** Iterable with (X, E, S) [-]:</span>
<span class="sd">                * X: Yeast concentration (kg/m3)</span>
<span class="sd">                * P: Ethanol concentration (kg/m3)</span>
<span class="sd">                * S: Substrate concentration (kg/m3)</span>
<span class="sd">            </span>
<span class="sd">            **t:** Time point</span>
<span class="sd">            </span>
<span class="sd">            ***kinetic_constants:**</span>
<span class="sd">                * mu_m1: Maximum specific growth rate (1/hr)</span>
<span class="sd">                * mu_m2: Maximum specific ethanol production rate (g-product/g-cell-hr)</span>
<span class="sd">                * Ks1: Sugar saturation constant for growth (g/L)</span>
<span class="sd">                * Ks2: Sugar saturation constant for product (g/L)</span>
<span class="sd">                * Pm1: Maximum product concentration at zero growth [mu_m1=0] (g/L)</span>
<span class="sd">                * Pm2: Maximum product concentration [mu_m2=0] (g/L)</span>
<span class="sd">                * Xm: Maximum cell concentration [mu_m1=0] (g/L)</span>
<span class="sd">                * Y_PS: Ethanol yield based on sugar consumed</span>
<span class="sd">                * a: Toxic power</span>
<span class="sd">                </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mu_m1</span><span class="p">,</span> <span class="n">mu_m2</span><span class="p">,</span> <span class="n">Ks1</span><span class="p">,</span> <span class="n">Ks2</span><span class="p">,</span> <span class="n">Pm1</span><span class="p">,</span> <span class="n">Pm2</span><span class="p">,</span> <span class="n">Xm</span><span class="p">,</span> <span class="n">Y_PS</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">kinetic_constants</span>
        
        <span class="c1"># Current yeast, ethanol, and glucose concentration (kg/m3)</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">S</span> <span class="o">=</span> <span class="n">z</span>
        
        <span class="c1"># Compute coefficients</span>
        <span class="n">mu_X</span> <span class="o">=</span> <span class="n">mu_m1</span> <span class="o">*</span> <span class="p">(</span><span class="n">S</span><span class="o">/</span><span class="p">(</span><span class="n">Ks1</span> <span class="o">+</span> <span class="n">S</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">P</span><span class="o">/</span><span class="n">Pm1</span><span class="p">)</span><span class="o">**</span><span class="n">a</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">X</span><span class="o">/</span><span class="n">Xm</span><span class="p">))</span>
        <span class="n">mu_P</span> <span class="o">=</span> <span class="n">mu_m2</span> <span class="o">*</span> <span class="p">(</span><span class="n">S</span><span class="o">/</span><span class="p">(</span><span class="n">Ks2</span> <span class="o">+</span> <span class="n">S</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">P</span><span class="o">/</span><span class="n">Pm2</span><span class="p">)</span>
        <span class="n">mu_S</span> <span class="o">=</span> <span class="n">mu_P</span><span class="o">/</span><span class="mf">0.45</span>
        
        <span class="c1"># Compute derivatives</span>
        <span class="n">dXdt</span> <span class="o">=</span> <span class="n">mu_X</span> <span class="o">*</span> <span class="n">X</span>
        <span class="n">dPdt</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_P</span> <span class="o">*</span> <span class="n">X</span><span class="p">)</span>
        <span class="n">dSdt</span> <span class="o">=</span>  <span class="o">-</span> <span class="n">mu_S</span> <span class="o">*</span> <span class="n">X</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">dXdt</span><span class="p">,</span> <span class="n">dPdt</span><span class="p">,</span> <span class="n">dSdt</span><span class="p">)</span></div>
        

    <span class="k">def</span> <span class="nf">_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Assume no Glycerol produced</span>
        <span class="c1"># No ethanol lost with CO2</span>
        <span class="n">mw_Ethanol</span> <span class="o">=</span> <span class="mf">46.06844</span>
        <span class="n">mw_glucose</span> <span class="o">=</span> <span class="mf">180.156</span>

        <span class="c1"># Unpack</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">CO2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outs</span>
        <span class="n">out</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ins</span><span class="p">)</span>
        
        <span class="c1"># Species involved in reaction</span>
        <span class="n">species</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;64-17-5&#39;</span><span class="p">,</span> <span class="s1">&#39;492-61-5&#39;</span><span class="p">,</span> <span class="s1">&#39;57-50-1&#39;</span><span class="p">,</span> <span class="s1">&#39;7732-18-5&#39;</span><span class="p">]</span>
        <span class="n">e</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">indx</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="o">*</span><span class="n">species</span><span class="p">,</span> <span class="n">CAS</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">glucose</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">indx</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">sucrose</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">indx</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
        
        <span class="c1"># Hydrolysis</span>
        <span class="n">new_glucose</span> <span class="o">=</span> <span class="n">sucrose</span><span class="o">*</span><span class="mi">2</span>
        <span class="n">ch_sucrose</span> <span class="o">=</span> <span class="o">-</span><span class="n">sucrose</span>
        <span class="n">ch_Water</span> <span class="o">=</span> <span class="o">-</span><span class="n">sucrose</span>
        <span class="n">out</span><span class="o">.</span><span class="n">_mol</span><span class="p">[[</span><span class="n">g</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">w</span><span class="p">]]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">new_glucose</span><span class="p">,</span> <span class="n">ch_sucrose</span><span class="p">,</span> <span class="n">ch_Water</span><span class="p">]</span>
        <span class="n">out</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="mi">32</span> <span class="o">+</span> <span class="mf">273.15</span>
        
        <span class="c1"># Fermentation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;Design&#39;</span><span class="p">][</span><span class="s1">&#39;Efficiency&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eff</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;efficiency&#39;</span><span class="p">)</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_efficiency</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tau&#39;</span><span class="p">])</span>
            <span class="p">)</span>
        <span class="n">fermented</span> <span class="o">=</span> <span class="n">eff</span><span class="o">*</span><span class="p">(</span><span class="n">glucose</span> <span class="o">+</span> <span class="n">new_glucose</span><span class="p">)</span>
        <span class="n">ch_glucose</span> <span class="o">=</span> <span class="o">-</span> <span class="n">fermented</span>
        <span class="n">ch_Ethanol</span> <span class="o">=</span> <span class="mf">0.5111</span><span class="o">*</span><span class="n">fermented</span> <span class="o">*</span> <span class="n">mw_glucose</span><span class="o">/</span><span class="n">mw_Ethanol</span>
        <span class="n">co2</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="s1">&#39;124-38-9&#39;</span><span class="p">,</span> <span class="n">CAS</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">changes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ch_Ethanol</span><span class="p">,</span> <span class="n">ch_glucose</span><span class="p">]</span>
        <span class="n">out</span><span class="o">.</span><span class="n">mol</span><span class="p">[[</span><span class="n">e</span><span class="p">,</span> <span class="n">g</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">changes</span>
        <span class="n">CO2</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">co2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mf">0.5111</span><span class="p">)</span><span class="o">*</span><span class="n">fermented</span> <span class="o">*</span> <span class="n">mw_glucose</span><span class="o">/</span><span class="mf">44.0095</span>
        <span class="n">CO2</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span>
        <span class="n">CO2</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">T</span>
    
    <span class="k">def</span> <span class="nf">_optimize_N_reactors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">totalcosts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_totalcosts</span>
        <span class="n">cost_old</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N_reactors</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulate</span><span class="p">()</span>
        <span class="n">cost_new</span> <span class="o">=</span> <span class="n">totalcosts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">while</span> <span class="n">cost_new</span> <span class="o">&lt;</span> <span class="n">cost_old</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">N_reactors</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">simulate</span><span class="p">()</span>
            <span class="n">cost_old</span> <span class="o">=</span> <span class="n">cost_new</span>
            <span class="n">cost_new</span> <span class="o">=</span> <span class="n">totalcosts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N_reactors</span> <span class="o">-=</span> <span class="mi">1</span>
        
    <span class="k">def</span> <span class="nf">_design</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">N_reactors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_reactors</span>
        <span class="k">if</span> <span class="n">N_reactors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_N_reactors</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_optimize_N_reactors</span><span class="p">()</span>
            <span class="n">N_reactors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_N_reactors</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_N_reactors</span> <span class="o">=</span> <span class="kc">None</span>
            
        <span class="n">v_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">volnet</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span><span class="p">[</span><span class="s1">&#39;tau&#39;</span><span class="p">]</span>
        <span class="n">tau_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_0</span>
        <span class="n">Design</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;Design&#39;</span><span class="p">]</span>
        <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Number of reactors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">N_reactors</span>
        <span class="n">Design</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_solve</span><span class="p">(</span><span class="n">v_0</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">tau_0</span><span class="p">,</span> <span class="n">N_reactors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_wf</span><span class="p">))</span>
        <span class="n">hx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cooler</span>
        <span class="n">new_flow</span> <span class="o">=</span> <span class="n">Stream</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">new_flow</span><span class="o">.</span><span class="n">mol</span> <span class="o">/=</span> <span class="n">N_reactors</span> 
        <span class="n">hx</span><span class="o">.</span><span class="n">outs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_flow</span>
        <span class="n">hx</span><span class="o">.</span><span class="n">ins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_flow</span>
        <span class="n">hu</span> <span class="o">=</span> <span class="n">hx</span><span class="o">.</span><span class="n">_heat_utilities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">hu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Hnet</span><span class="o">/</span><span class="n">N_reactors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">hx</span><span class="o">.</span><span class="n">_design</span><span class="p">(</span><span class="n">hu</span><span class="o">.</span><span class="n">duty</span><span class="p">)</span>
        <span class="n">hx</span><span class="o">.</span><span class="n">_cost</span><span class="p">()</span>
        <span class="n">hu</span><span class="o">.</span><span class="n">duty</span> <span class="o">*=</span> <span class="n">N_reactors</span>
        <span class="n">hu</span><span class="o">.</span><span class="n">cost</span> <span class="o">*=</span> <span class="n">N_reactors</span>
        <span class="n">hu</span><span class="o">.</span><span class="n">flow</span> <span class="o">*=</span> <span class="n">N_reactors</span>
        <span class="k">return</span> <span class="n">Design</span>
    
    <span class="k">def</span> <span class="nf">_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span>
        <span class="n">Cost</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Cost&#39;</span><span class="p">]</span>
        <span class="n">Design</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;Design&#39;</span><span class="p">]</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Number of reactors&#39;</span><span class="p">]</span>
        <span class="n">V_i</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Reactor volume&#39;</span><span class="p">]</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">V_i</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">V_0</span>
        <span class="n">F_CEPCI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CEPCI</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">CEPCI_0</span>
        <span class="n">FF</span> <span class="o">=</span> <span class="n">F_CEPCI</span> <span class="o">*</span> <span class="n">N</span> <span class="o">*</span> <span class="n">R</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">exp</span>
        
        <span class="n">Cost</span><span class="p">[</span><span class="s1">&#39;Reactors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FF</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">C_0</span>
        <span class="n">Cost</span><span class="p">[</span><span class="s1">&#39;Coolers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cooler</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;Cost&#39;</span><span class="p">][</span><span class="s1">&#39;Heat exchanger&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_power_utility</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A_p</span> <span class="o">*</span> <span class="n">R</span> <span class="o">*</span> <span class="n">N</span> <span class="o">*</span> <span class="n">F_CEPCI</span><span class="p">)</span>
        <span class="n">Cost</span><span class="p">[</span><span class="s1">&#39;Agitators&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FF</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">C_A</span>
        <span class="k">return</span> <span class="n">Cost</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">BioSTEAM 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Yoel Cortes-Pena and Guest Group.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.9.
    </div>
  </body>
</html>