
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>biosteam._tea &#8212; BioSTEAM 0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">BioSTEAM 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for biosteam._tea</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Mon Feb  4 19:38:37 2019</span>

<span class="sd">@author: Guest Group</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">newton</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;TEA&#39;</span><span class="p">,)</span>

<span class="n">_DataFrame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
<span class="n">_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span>
<span class="n">_asarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span>

<span class="c1"># TODO: Add &#39;SL&#39;, &#39;DB&#39;, &#39;DDB&#39;, &#39;SYD&#39;, &#39;ACRS&#39; and &#39;MACRS&#39; functions to generate depreciation data</span>

<span class="c1"># %% Depreciation data</span>

<span class="n">_MACRS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;MACRS5&#39;</span><span class="p">:</span>  <span class="n">_array</span><span class="p">([</span><span class="o">.</span><span class="mi">2000</span><span class="p">,</span> <span class="o">.</span><span class="mi">3200</span><span class="p">,</span> <span class="o">.</span><span class="mi">1920</span><span class="p">,</span>
                             <span class="o">.</span><span class="mi">1152</span><span class="p">,</span> <span class="o">.</span><span class="mi">1152</span><span class="p">,</span> <span class="o">.</span><span class="mi">0576</span><span class="p">]),</span>
          
          <span class="s1">&#39;MACRS7&#39;</span><span class="p">:</span>  <span class="n">_array</span><span class="p">([</span><span class="o">.</span><span class="mi">1429</span><span class="p">,</span> <span class="o">.</span><span class="mi">2449</span><span class="p">,</span> <span class="o">.</span><span class="mi">1749</span><span class="p">,</span>
                             <span class="o">.</span><span class="mi">1249</span><span class="p">,</span> <span class="o">.</span><span class="mi">0893</span><span class="p">,</span> <span class="o">.</span><span class="mi">0892</span><span class="p">,</span>
                             <span class="o">.</span><span class="mi">0893</span><span class="p">,</span> <span class="o">.</span><span class="mi">0446</span><span class="p">]),</span>
          
          <span class="s1">&#39;MACRS10&#39;</span><span class="p">:</span> <span class="n">_array</span><span class="p">([</span><span class="o">.</span><span class="mi">1000</span><span class="p">,</span> <span class="o">.</span><span class="mi">1800</span><span class="p">,</span> <span class="o">.</span><span class="mi">1440</span><span class="p">,</span>
                             <span class="o">.</span><span class="mi">1152</span><span class="p">,</span> <span class="o">.</span><span class="mi">0922</span><span class="p">,</span> <span class="o">.</span><span class="mi">0737</span><span class="p">,</span>
                             <span class="o">.</span><span class="mi">0655</span><span class="p">,</span> <span class="o">.</span><span class="mi">0655</span><span class="p">,</span> <span class="o">.</span><span class="mi">0656</span><span class="p">,</span>
                             <span class="o">.</span><span class="mi">0655</span><span class="p">,</span> <span class="o">.</span><span class="mi">0328</span><span class="p">]),</span>

          <span class="s1">&#39;MACRS15&#39;</span><span class="p">:</span> <span class="n">_array</span><span class="p">([</span><span class="o">.</span><span class="mi">0500</span><span class="p">,</span> <span class="o">.</span><span class="mi">0950</span><span class="p">,</span> <span class="o">.</span><span class="mi">0855</span><span class="p">,</span>
                             <span class="o">.</span><span class="mi">0770</span><span class="p">,</span> <span class="o">.</span><span class="mi">0693</span><span class="p">,</span> <span class="o">.</span><span class="mi">0623</span><span class="p">,</span>
                             <span class="o">.</span><span class="mi">0590</span><span class="p">,</span> <span class="o">.</span><span class="mi">0590</span><span class="p">,</span> <span class="o">.</span><span class="mi">0591</span><span class="p">,</span>
                             <span class="o">.</span><span class="mi">0590</span><span class="p">,</span> <span class="o">.</span><span class="mi">0591</span><span class="p">,</span> <span class="o">.</span><span class="mi">0590</span><span class="p">,</span>
                             <span class="o">.</span><span class="mi">0591</span><span class="p">,</span> <span class="o">.</span><span class="mi">0590</span><span class="p">,</span> <span class="o">.</span><span class="mi">0591</span><span class="p">,</span>
                             <span class="o">.</span><span class="mi">0295</span><span class="p">])}</span>


<span class="c1"># %% Cash flow and results info</span>

<span class="n">_cashflow_columns</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Depreciable capital&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Depreciation&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Fixed capital&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Working capital&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Annual operating cost (excl. depr.)&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Sales&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Net earnings&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Cash flow&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Discounted cash flow&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Cumulative cash flow&#39;</span><span class="p">)</span>


<span class="c1"># %% Techno-Economic Analysis</span>

<div class="viewcode-block" id="TEA"><a class="viewcode-back" href="../../TEA.html#biosteam.TEA">[docs]</a><span class="k">class</span> <span class="nc">TEA</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Create a TEA object that can perform cash flow analysis on a System object.</span>
<span class="sd">    </span>
<span class="sd">        **Parameters**</span>
<span class="sd">        </span>
<span class="sd">            **system:** [System] Should contain feed and product streams.</span>
<span class="sd">            </span>
<span class="sd">        **Examples**</span>
<span class="sd">        </span>
<span class="sd">            :doc:`Techno-economic analysis of a biorefinery` </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;_results&#39;</span><span class="p">,</span> <span class="s1">&#39;system&#39;</span><span class="p">,</span> <span class="s1">&#39;cashflow&#39;</span><span class="p">,</span> <span class="s1">&#39;_cached&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;_options&#39;</span><span class="p">,</span> <span class="s1">&#39;_IRR_guess&#39;</span><span class="p">,</span> <span class="s1">&#39;_cost_guess&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;_costs&#39;</span><span class="p">,</span> <span class="s1">&#39;_costs_data&#39;</span><span class="p">)</span>
    
    <span class="c1">#: Default cash flow options</span>
    <span class="n">_default</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Lang factor&#39;</span><span class="p">:</span> <span class="mf">4.37</span><span class="p">,</span>
                <span class="s1">&#39;Operating days&#39;</span><span class="p">:</span> <span class="mi">330</span><span class="p">,</span>
                <span class="s1">&#39;IRR&#39;</span><span class="p">:</span> <span class="mf">0.15</span><span class="p">,</span>
                <span class="s1">&#39;Wage&#39;</span><span class="p">:</span> <span class="mf">5e4</span><span class="p">,</span>
                <span class="s1">&#39;Year&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;Employees&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
                <span class="s1">&#39;Fringe benefits&#39;</span><span class="p">:</span> <span class="mf">0.40</span><span class="p">,</span>
                <span class="s1">&#39;Income tax&#39;</span><span class="p">:</span> <span class="mf">0.35</span><span class="p">,</span>
                <span class="s1">&#39;Property tax&#39;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span>
                <span class="s1">&#39;Property insurance&#39;</span><span class="p">:</span> <span class="mf">0.005</span><span class="p">,</span>
                <span class="s1">&#39;Duration&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
                <span class="s1">&#39;Supplies&#39;</span><span class="p">:</span> <span class="mf">0.20</span><span class="p">,</span>
                <span class="s1">&#39;Mantainance&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span>
                <span class="s1">&#39;Administration&#39;</span><span class="p">:</span> <span class="mf">0.005</span><span class="p">,</span>
                <span class="s1">&#39;Working capital&#39;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
                <span class="s1">&#39;Startup&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;Land&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;Royalties&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;Depreciation&#39;</span><span class="p">:</span> <span class="s1">&#39;MACRS7&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Startup schedule&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span>
                <span class="s1">&#39;Other recurring costs&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;Other fixed capital&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
    
    <span class="n">_results_units</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Pay back period&#39;</span><span class="p">:</span> <span class="s1">&#39;yr&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Return on investment&#39;</span><span class="p">:</span> <span class="s1">&#39;1/yr&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Net present value&#39;</span><span class="p">:</span> <span class="s1">&#39;USD&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Depreciable capital&#39;</span><span class="p">:</span> <span class="s1">&#39;USD&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Fixed capital investment&#39;</span><span class="p">:</span> <span class="s1">&#39;USD&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Total capital investment&#39;</span><span class="p">:</span> <span class="s1">&#39;USD&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Depreciation&#39;</span><span class="p">:</span> <span class="s1">&#39;USD/yr&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Annual operating cost&#39;</span><span class="p">:</span> <span class="s1">&#39;USD/yr&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Working capital&#39;</span><span class="p">:</span> <span class="s1">&#39;USD&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Utility cost&#39;</span><span class="p">:</span> <span class="s1">&#39;USD/yr&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Material cost&#39;</span><span class="p">:</span> <span class="s1">&#39;USD/yr&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Sales&#39;</span><span class="p">:</span> <span class="s1">&#39;USD/yr&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Labor&#39;</span><span class="p">:</span> <span class="s1">&#39;USD/yr&#39;</span><span class="p">}</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        [dict] Options for cash flow analysis [-]:</span>
<span class="sd">            * **Lang factor:** Used to get fixed capital investment from total purchase cost.</span>
<span class="sd">            * **Operating days:** (day).</span>
<span class="sd">            * **IRR:** Internal rate of return (fraction).</span>
<span class="sd">            * **Wage:** Wage per employee (USD/yr).</span>
<span class="sd">            * **Year:** Start year of venture.</span>
<span class="sd">            * **Employees:** Number of employees.</span>
<span class="sd">            * **Fringe benefits:** Cost of fringe benefits as a fraction of labor cost.</span>
<span class="sd">            * **Income tax:** Combined federal and state income tax rate (fraction).</span>
<span class="sd">            * **Property tax:** Fee as a fraction of fixed capital investment.</span>
<span class="sd">            * **Property insurance:** Fee as a fraction of fixed capital investment.</span>
<span class="sd">            * **Duration:** Duration of venture (years).</span>
<span class="sd">            * **Supplies:** Yearly fee as a fraction of labor costs.</span>
<span class="sd">            * **Mantainance:** Yearly fee as a fraction of fixed capital investment.</span>
<span class="sd">            * **Administration:** Yearly fee as a fraction of fixed capital investment.</span>
<span class="sd">            * **Working capital:** Fee as a fraction of fixed capital investment.</span>
<span class="sd">            * **Startup:** Cost of start up as a fraction of depreciable capital.</span>
<span class="sd">            * **Land:** Cost of land as a fraction of depreciable capital.</span>
<span class="sd">            * **Royalties:** Cost of royalties as a fraction of depreciable capital.</span>
<span class="sd">            * **Depreciation:** &#39;MACRS&#39; + number of years (e.g. &#39;MACRS7&#39;).</span>
<span class="sd">            * **Startup schedule:** tuple of startup investment fractions per year, starting from year 0. For example, for 50% capital investment in year 0 and 50% investment in year 1: (0.5, 0.5).</span>
<span class="sd">            * **Other recurring costs:** Any additional recurring costs per year of operation.</span>
<span class="sd">            * **Other fixed capital:** Any additional investment not accounted for in equipment cost.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">system</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system</span> <span class="o">=</span> <span class="n">system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_options</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_default</span><span class="p">)</span>
        
        <span class="c1"># [dict] Cached values from &#39;_init&#39; methods:</span>
        <span class="c1">#  {operating_days: flowrate_factor,</span>
        <span class="c1">#   year_duration: (duration_array, cashflow_data),</span>
        <span class="c1">#   depreciation_schedule: (start, Depreciation, D_len, schedule)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cached</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1">#: [dict] Summarized results of cash flow analysis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_results</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1">#: [DataFrame] Cash flow table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cashflow</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="c1">#: Guess IRR for solve_IRR method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_IRR_guess</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="c1">#: Guess stream cost for solve_price method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cost_guess</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="n">units</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">_costunits</span>
        <span class="n">units</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">line</span><span class="p">)</span>
        <span class="n">costs</span> <span class="o">=</span> <span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">_totalcosts</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">units</span><span class="p">]</span>
        
        <span class="c1">#: All purchase and utility costs for units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_costs_data</span> <span class="o">=</span> <span class="n">costs</span>
        
        <span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">((</span><span class="n">u</span><span class="o">.</span><span class="n">line</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">ID</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">units</span><span class="p">)</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Purchase cost (USD)&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Utility cost (USD/hr)&#39;</span><span class="p">)</span>
        
        <span class="c1">#: [DataFrame] All purchase and utility costs for units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_costs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">costs</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
        
        <span class="n">system</span><span class="o">.</span><span class="n">_TEA</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">costs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;[DataFrame] All purchase and utility costs for units.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_costs</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_costs_data</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_costs</span>

<div class="viewcode-block" id="TEA.results"><a class="viewcode-back" href="../../TEA.html#biosteam.TEA.results">[docs]</a>    <span class="k">def</span> <span class="nf">results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_units</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return results of techno-economic analysis as a DataFrame object if `with_units` is True or as a Series otherwise.&quot;&quot;&quot;</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">addkey</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">append</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">addval</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">append</span>
        <span class="k">if</span> <span class="n">with_units</span><span class="p">:</span>
            <span class="n">results_units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results_units</span>
            <span class="k">for</span> <span class="n">ki</span><span class="p">,</span> <span class="n">vi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">addkey</span><span class="p">(</span><span class="n">ki</span><span class="p">)</span>
                <span class="n">addval</span><span class="p">((</span><span class="n">results_units</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ki</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">vi</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Units&#39;</span><span class="p">,</span> <span class="s1">&#39;Value&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">)</span></div>

<div class="viewcode-block" id="TEA.NPV"><a class="viewcode-back" href="../../TEA.html#biosteam.TEA.NPV">[docs]</a>    <span class="k">def</span> <span class="nf">NPV</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate NPV by cash flow analysis and update the &quot;results&quot; and &quot;cashflow&quot; attributes.&quot;&quot;&quot;</span>
        <span class="n">flow_factor</span><span class="p">,</span> <span class="n">cashflow_info</span><span class="p">,</span> <span class="n">depreciation_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cached_data</span><span class="p">()</span>
        <span class="n">cashflow_data</span><span class="p">,</span> <span class="n">duration_array</span> <span class="o">=</span> <span class="n">cashflow_info</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_parameters</span><span class="p">(</span><span class="n">flow_factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calc_cashflow</span><span class="p">(</span><span class="n">cashflow_data</span><span class="p">,</span>
                            <span class="n">parameters</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span>
                            <span class="n">depreciation_data</span><span class="p">)</span>
        <span class="n">NPV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_NPV_and_update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;IRR&#39;</span><span class="p">],</span>
                                        <span class="n">cashflow_data</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:],</span>
                                        <span class="n">duration_array</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_results</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">cashflow_data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">NPV</span></div>
    
<div class="viewcode-block" id="TEA.production_cost"><a class="viewcode-back" href="../../TEA.html#biosteam.TEA.production_cost">[docs]</a>    <span class="k">def</span> <span class="nf">production_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">products</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return production cost of products.</span>
<span class="sd">        </span>
<span class="sd">        **Parameters**</span>
<span class="sd">        </span>
<span class="sd">            ***products:** [Stream] Main products of the system</span>
<span class="sd">        </span>
<span class="sd">        .. Note::</span>
<span class="sd">           If there is more than one main product, The production cost is proportionally allocated to each of the main products with respect to their marketing values. The marketing value of each product is determined by the annual production multiplied by its selling price.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span>
        <span class="n">sysfeeds</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">feeds</span>
        <span class="n">sysproducts</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">products</span>
        <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span>
        <span class="n">flow_factor</span> <span class="o">=</span> <span class="mi">24</span><span class="o">*</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;Operating days&#39;</span><span class="p">]</span>
        <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span>
        <span class="n">DC_</span><span class="p">,</span> <span class="n">UC_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">costs</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># Depreciable capital (USD) and utility cost (USD/hr)</span>
        <span class="n">MC_</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Material cost USD/hr</span>
        <span class="n">CP_</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Coproducts USD/hr</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sysfeeds</span><span class="p">:</span>
            <span class="n">price</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">price</span>
            <span class="k">if</span> <span class="n">price</span><span class="p">:</span> <span class="n">MC_</span> <span class="o">+=</span> <span class="n">price</span><span class="o">*</span><span class="n">s</span><span class="o">.</span><span class="n">massnet</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sysproducts</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">products</span><span class="p">:</span>
                <span class="n">price</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">price</span>
                <span class="k">if</span> <span class="n">price</span><span class="p">:</span> <span class="n">CP_</span> <span class="o">+=</span> <span class="n">price</span><span class="o">*</span><span class="n">s</span><span class="o">.</span><span class="n">massnet</span>
        <span class="c1"># Multiply by flow_factor for USD/yr</span>
        <span class="n">UC_</span> <span class="o">*=</span> <span class="n">flow_factor</span>
        <span class="n">MC_</span> <span class="o">*=</span> <span class="n">flow_factor</span>
        <span class="n">CP_</span> <span class="o">*=</span> <span class="n">flow_factor</span>
        <span class="n">DC_</span> <span class="o">*=</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Lang factor&#39;</span><span class="p">]</span>
        <span class="n">FC_</span> <span class="o">=</span> <span class="n">DC_</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Startup&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Land&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Royalties&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Other fixed capital&#39;</span><span class="p">]</span>
        <span class="n">fb</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Fringe benefits&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Supplies&#39;</span><span class="p">]</span>
        <span class="n">f</span> <span class="o">=</span>  <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;Mantainance&#39;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Administration&#39;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Property tax&#39;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Property insurance&#39;</span><span class="p">])</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">DC_</span><span class="o">/</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;Duration&#39;</span><span class="p">]</span> <span class="c1"># Depreciation</span>
        <span class="n">L_</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Wage&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;Employees&#39;</span><span class="p">]</span>
        <span class="n">total_operating_cost</span> <span class="o">=</span> <span class="n">UC_</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">fb</span><span class="p">)</span><span class="o">*</span><span class="n">L_</span> <span class="o">+</span> <span class="n">MC_</span> <span class="o">+</span> <span class="n">f</span><span class="o">*</span><span class="n">FC_</span> <span class="o">+</span> <span class="n">d</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Other recurring costs&#39;</span><span class="p">]</span>
        <span class="n">market_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">cost</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">products</span><span class="p">])</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">market_values</span><span class="o">/</span><span class="n">market_values</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">operating_cost</span> <span class="o">=</span> <span class="n">weights</span><span class="o">*</span><span class="n">total_operating_cost</span>
        <span class="k">return</span> <span class="n">operating_cost</span></div>
    
    <span class="k">def</span> <span class="nf">_get_cached_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return cached data.</span>
<span class="sd">        </span>
<span class="sd">        **Return**</span>
<span class="sd">        </span>
<span class="sd">            **flow_factor:** [float] Factor to convert flow rate from kg/hr to kg/yr of operation.</span>
<span class="sd">            </span>
<span class="sd">            **cashflow_info:** tuple[array] including:</span>
<span class="sd">                * cashflow_data: Cash flow data table</span>
<span class="sd">                * duration_array: Range from 1 to the end of the project length</span>
<span class="sd">        </span>
<span class="sd">            **depreciation_data:** [tuple] including:</span>
<span class="sd">                * start: Index of year when operation starts</span>
<span class="sd">                * Depreciation: Array of depreciation as a fraction of fixed cost</span>
<span class="sd">                * D_len: Lenght of depreciation</span>
<span class="sd">                * index_startup: Year index and fixed capital investment fractions</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Keys for cached data</span>
        <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span>
        <span class="n">cached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached</span>
        <span class="n">year_duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">],</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Duration&#39;</span><span class="p">])</span>
        <span class="n">depreciation_schedule</span> <span class="o">=</span> <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;Depreciation&#39;</span><span class="p">],</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Startup schedule&#39;</span><span class="p">])</span>
        <span class="n">operating_days</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Operating days&#39;</span><span class="p">]</span>
        
        <span class="c1"># Get and update cached data</span>
        <span class="n">flow_factor</span> <span class="o">=</span> <span class="n">cached</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">operating_days</span><span class="p">)</span>
        <span class="n">cashflow_info</span> <span class="o">=</span> <span class="n">cached</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">year_duration</span><span class="p">)</span>
        <span class="n">depreciation_data</span> <span class="o">=</span> <span class="n">cached</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">depreciation_schedule</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">flow_factor</span><span class="p">:</span>
            <span class="n">cached</span><span class="p">[</span><span class="n">operating_days</span><span class="p">]</span> <span class="o">=</span> <span class="n">flow_factor</span> <span class="o">=</span> <span class="mi">24</span><span class="o">*</span><span class="n">operating_days</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cashflow_info</span><span class="p">:</span>
            <span class="n">year</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">year_duration</span>
            <span class="n">index</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">year</span> <span class="o">+</span> <span class="n">duration</span><span class="p">))</span> <span class="k">if</span> <span class="n">year</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">duration</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cashflow</span> <span class="o">=</span> <span class="n">_DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">_cashflow_columns</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">cashflow_data</span> <span class="o">=</span> <span class="n">_asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cashflow</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">duration_array</span> <span class="o">=</span> <span class="n">_array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">duration</span><span class="p">))</span>
            <span class="n">cached</span><span class="p">[</span><span class="n">year_duration</span><span class="p">]</span> <span class="o">=</span> <span class="n">cashflow_info</span> <span class="o">=</span> <span class="p">(</span><span class="n">cashflow_data</span><span class="p">,</span> <span class="n">duration_array</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">depreciation_data</span><span class="p">:</span>
            <span class="n">depreciation</span><span class="p">,</span> <span class="n">schedule</span> <span class="o">=</span> <span class="n">depreciation_schedule</span>
            <span class="n">Depreciation</span> <span class="o">=</span> <span class="n">_MACRS</span><span class="p">[</span><span class="n">depreciation</span><span class="p">]</span>
            <span class="n">start</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">schedule</span><span class="p">)</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">Depreciation</span><span class="p">)</span>
            <span class="n">schedule</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">schedule</span><span class="p">)</span>
            <span class="n">depreciation_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span>
                                 <span class="n">Depreciation</span><span class="p">,</span>
                                 <span class="n">end</span><span class="p">,</span>
                                 <span class="n">schedule</span><span class="p">)</span>
            <span class="n">cached</span><span class="p">[</span><span class="n">depreciation_schedule</span><span class="p">]</span> <span class="o">=</span> <span class="n">depreciation_data</span>
        
        <span class="k">return</span> <span class="n">flow_factor</span><span class="p">,</span> <span class="n">cashflow_info</span><span class="p">,</span> <span class="n">depreciation_data</span>
    
    <span class="k">def</span> <span class="nf">_calc_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow_factor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return elementary cash flow parameters.&quot;&quot;&quot;</span>
        <span class="c1"># Cash flow parameters (USD or USD/yr)</span>
        <span class="c1"># DC_: Depreciable capital</span>
        <span class="c1"># FC_: Fixed capital</span>
        <span class="c1"># WC_: Working capital</span>
        <span class="c1"># UC_: Utility cost</span>
        <span class="c1"># MC_: Material cost</span>
        <span class="c1"># S_: Sales</span>
        <span class="c1"># L_: Labor cost</span>
        <span class="c1"># C_: Annual operating cost (excluding depreciation)</span>
        
        <span class="n">system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span>
        <span class="n">feeds</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">feeds</span>
        <span class="n">products</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">products</span>
        <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span>
        <span class="n">DC_</span><span class="p">,</span> <span class="n">UC_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">costs</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># Depreciable capital (USD) and utility cost (USD/hr)</span>
        <span class="n">MC_</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Material cost USD/hr</span>
        <span class="n">S_</span>  <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Sales USD/hr</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">feeds</span><span class="p">:</span>
            <span class="n">price</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">price</span>
            <span class="k">if</span> <span class="n">price</span><span class="p">:</span> <span class="n">MC_</span> <span class="o">+=</span> <span class="n">price</span><span class="o">*</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">_mol</span><span class="o">*</span><span class="n">s</span><span class="o">.</span><span class="n">_MW</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">products</span><span class="p">:</span>
            <span class="n">price</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">price</span>
            <span class="k">if</span> <span class="n">price</span><span class="p">:</span> <span class="n">S_</span> <span class="o">+=</span> <span class="n">price</span><span class="o">*</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">_mol</span><span class="o">*</span><span class="n">s</span><span class="o">.</span><span class="n">_MW</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="c1"># Multiply by flow_factor for USD/yr</span>
        <span class="n">UC_</span> <span class="o">*=</span> <span class="n">flow_factor</span>
        <span class="n">MC_</span> <span class="o">*=</span> <span class="n">flow_factor</span>
        <span class="n">S_</span> <span class="o">*=</span> <span class="n">flow_factor</span>
        <span class="n">DC_</span> <span class="o">*=</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Lang factor&#39;</span><span class="p">]</span>
        <span class="n">FC_</span> <span class="o">=</span> <span class="n">DC_</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Startup&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Land&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Royalties&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Other fixed capital&#39;</span><span class="p">]</span>
        <span class="n">fb</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Fringe benefits&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Supplies&#39;</span><span class="p">]</span>
        <span class="n">f</span> <span class="o">=</span>  <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;Mantainance&#39;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Administration&#39;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Property tax&#39;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Property insurance&#39;</span><span class="p">])</span>
        <span class="n">WC_</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Working capital&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">FC_</span>
        <span class="n">L_</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Wage&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;Employees&#39;</span><span class="p">]</span>
        <span class="n">C_</span> <span class="o">=</span> <span class="n">UC_</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">fb</span><span class="p">)</span><span class="o">*</span><span class="n">L_</span> <span class="o">+</span> <span class="n">MC_</span> <span class="o">+</span> <span class="n">f</span><span class="o">*</span><span class="n">FC_</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Other recurring costs&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">DC_</span><span class="p">,</span> <span class="n">FC_</span><span class="p">,</span> <span class="n">WC_</span><span class="p">,</span> <span class="n">S_</span><span class="p">,</span> <span class="n">C_</span><span class="p">,</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Income tax&#39;</span><span class="p">],</span> <span class="n">UC_</span><span class="p">,</span> <span class="n">MC_</span><span class="p">,</span> <span class="n">L_</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_calc_cashflow</span><span class="p">(</span><span class="n">cashflow_data</span><span class="p">,</span>
                       <span class="n">parameters</span><span class="p">,</span>
                       <span class="n">depreciation_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Perform cash flow analysis and return net present value.&quot;&quot;&quot;</span>
        <span class="c1"># Cash flow data and parameters</span>
        <span class="c1"># C_DC: Depreciable capital</span>
        <span class="c1"># C_FC: Fixed capital</span>
        <span class="c1"># C_WC: Working capital</span>
        <span class="c1"># D: Depreciation</span>
        <span class="c1"># C: Annual operating cost (excluding depreciation)</span>
        <span class="c1"># S: Sales</span>
        <span class="c1"># NE: Net earnings</span>
        <span class="c1"># CF: Cash flow</span>
        <span class="c1"># DCF: Discounted cash flow</span>
        <span class="c1"># CPV: Cumulative present value</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">Depreciation</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">schedule</span> <span class="o">=</span> <span class="n">depreciation_data</span>
        <span class="n">C_DC</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">C_FC</span><span class="p">,</span> <span class="n">C_WC</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">NE</span><span class="p">,</span> <span class="n">CF</span><span class="p">,</span> <span class="n">DCF</span><span class="p">,</span> <span class="n">CPV</span> <span class="o">=</span> <span class="n">cashflow_data</span>
        <span class="n">DC_</span><span class="p">,</span> <span class="n">FC_</span><span class="p">,</span> <span class="n">WC_</span><span class="p">,</span> <span class="n">S_</span><span class="p">,</span> <span class="n">C_</span><span class="p">,</span> <span class="n">tax</span> <span class="o">=</span> <span class="n">parameters</span>
        
        <span class="c1"># Calculate</span>
        <span class="n">D</span><span class="p">[:]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">C_DC</span><span class="p">[:</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="n">DC_</span><span class="o">*</span><span class="n">schedule</span>
        <span class="n">C_FC</span><span class="p">[:</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="n">FC_</span><span class="o">*</span><span class="n">schedule</span>
        <span class="n">D</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="n">DC_</span><span class="o">*</span><span class="n">Depreciation</span>
        <span class="n">C_WC</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="n">WC_</span>
        <span class="n">C_WC</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">WC_</span>
        <span class="n">C</span><span class="p">[</span><span class="n">start</span><span class="p">:]</span> <span class="o">=</span> <span class="n">C_</span>
        <span class="n">S</span><span class="p">[</span><span class="n">start</span><span class="p">:]</span> <span class="o">=</span> <span class="n">S_</span>
        <span class="n">NE</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span> <span class="o">-</span> <span class="n">C</span> <span class="o">-</span> <span class="n">D</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">tax</span><span class="p">)</span>
        <span class="n">CF</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">NE</span> <span class="o">+</span> <span class="n">D</span><span class="p">)</span> <span class="o">-</span> <span class="n">C_FC</span> <span class="o">-</span> <span class="n">C_WC</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_calc_NPV_and_update</span><span class="p">(</span><span class="n">IRR</span><span class="p">,</span> <span class="n">CF_subset</span><span class="p">,</span> <span class="n">duration_array</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return NPV at given IRR and cashflow data. Update cash flow subset.&quot;&quot;&quot;</span>
        <span class="n">CF</span><span class="p">,</span> <span class="n">DCF</span><span class="p">,</span> <span class="n">CPV</span> <span class="o">=</span> <span class="n">CF_subset</span>
        <span class="n">DCF</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">CF</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">IRR</span><span class="p">)</span><span class="o">**</span><span class="n">duration_array</span>
        <span class="n">CPV</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">DCF</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">CPV</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_calc_NPV</span><span class="p">(</span><span class="n">IRR</span><span class="p">,</span> <span class="n">CF</span><span class="p">,</span> <span class="n">duration_array</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return NPV at given IRR and cashflow data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">CF</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">IRR</span><span class="p">)</span><span class="o">**</span><span class="n">duration_array</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">_update_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">NPV</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update results attribute.&quot;&quot;&quot;</span>
        <span class="n">DC</span><span class="p">,</span> <span class="n">FCI</span><span class="p">,</span> <span class="n">WC</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">tax</span><span class="p">,</span> <span class="n">UC</span><span class="p">,</span> <span class="n">MC</span><span class="p">,</span> <span class="n">L</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">FCI</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Duration&#39;</span><span class="p">]</span>
        <span class="n">AOC</span> <span class="o">=</span> <span class="n">C</span> <span class="o">+</span> <span class="n">D</span>
        <span class="n">TCI</span> <span class="o">=</span> <span class="n">FCI</span> <span class="o">+</span> <span class="n">WC</span>
        <span class="n">net_earnings</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">tax</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">S</span><span class="o">-</span><span class="n">AOC</span><span class="p">)</span>
        <span class="n">ROI</span> <span class="o">=</span> <span class="n">net_earnings</span><span class="o">/</span><span class="n">TCI</span>
        <span class="n">PBP</span> <span class="o">=</span> <span class="n">FCI</span><span class="o">/</span><span class="p">(</span><span class="n">net_earnings</span> <span class="o">+</span> <span class="n">D</span><span class="p">)</span>
        
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Depreciable capital&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DC</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Fixed capital investment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FCI</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Working capital&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">WC</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Total capital investment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TCI</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Depreciation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Utility cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">UC</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Material cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MC</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Sales&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Labor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Annual operating cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">AOC</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Net present value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NPV</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Return on investment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ROI</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Pay back period&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PBP</span>

<div class="viewcode-block" id="TEA.solve_IRR"><a class="viewcode-back" href="../../TEA.html#biosteam.TEA.solve_IRR">[docs]</a>    <span class="k">def</span> <span class="nf">solve_IRR</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the IRR at the break even point (NPV = 0) through cash flow analysis.</span>
<span class="sd">        </span>
<span class="sd">        **Parameters**</span>
<span class="sd">        </span>
<span class="sd">            **update:** [bool] If True, update IRR, cashflow, and results.</span>
<span class="sd">           </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate cashflow table</span>
        <span class="n">flow_factor</span><span class="p">,</span> <span class="n">cashflow_info</span><span class="p">,</span> <span class="n">depreciation_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cached_data</span><span class="p">()</span>
        <span class="n">cashflow_data</span><span class="p">,</span> <span class="n">duration_array</span> <span class="o">=</span> <span class="n">cashflow_info</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_parameters</span><span class="p">(</span><span class="n">flow_factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calc_cashflow</span><span class="p">(</span><span class="n">cashflow_data</span><span class="p">,</span>
                            <span class="n">parameters</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span>
                            <span class="n">depreciation_data</span><span class="p">)</span>
        
        <span class="c1"># Guess for solver</span>
        <span class="n">guess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_IRR_guess</span>
        <span class="n">IRR_guess</span> <span class="o">=</span> <span class="n">guess</span> <span class="k">if</span> <span class="n">guess</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;IRR&#39;</span><span class="p">]</span>
        
        <span class="c1"># Solve</span>
        <span class="k">if</span> <span class="n">update</span><span class="p">:</span>
            <span class="n">data_subset</span> <span class="o">=</span> <span class="n">cashflow_data</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_subset</span><span class="p">,</span> <span class="n">duration_array</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_calc_cashflow</span><span class="p">(</span><span class="n">cashflow_data</span><span class="p">,</span>
                                <span class="n">parameters</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span>
                                <span class="n">depreciation_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_IRR_guess</span> <span class="o">=</span> <span class="n">IRR</span> <span class="o">=</span> <span class="n">newton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_calc_NPV_and_update</span><span class="p">,</span>
                                           <span class="n">IRR_guess</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;IRR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">IRR</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_results</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">data_subset</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_IRR_guess</span> <span class="o">=</span> <span class="n">IRR</span> <span class="o">=</span> <span class="n">newton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_calc_NPV</span><span class="p">,</span> <span class="n">IRR_guess</span><span class="p">,</span>
                                           <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">cashflow_data</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span> <span class="n">duration_array</span><span class="p">),</span>
                                           <span class="n">tol</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">IRR</span></div>
    
<div class="viewcode-block" id="TEA.solve_price"><a class="viewcode-back" href="../../TEA.html#biosteam.TEA.solve_price">[docs]</a>    <span class="k">def</span> <span class="nf">solve_price</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the price (USD/kg) of stream at the break even point (NPV = 0) through cash flow analysis. </span>
<span class="sd">        </span>
<span class="sd">        **Parameters**</span>
<span class="sd">        </span>
<span class="sd">            **stream:** [Stream] Stream with variable selling price.</span>
<span class="sd">            </span>
<span class="sd">            **update:** [bool] If True, update stream price, cashflow, and results.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate cashflow table</span>
        <span class="n">flow_factor</span><span class="p">,</span> <span class="n">cashflow_info</span><span class="p">,</span> <span class="n">depreciation_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cached_data</span><span class="p">()</span>
        <span class="n">cashflow_data</span><span class="p">,</span> <span class="n">duration_array</span> <span class="o">=</span> <span class="n">cashflow_info</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_parameters</span><span class="p">(</span><span class="n">flow_factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calc_cashflow</span><span class="p">(</span><span class="n">cashflow_data</span><span class="p">,</span>
                            <span class="n">parameters</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span>
                            <span class="n">depreciation_data</span><span class="p">)</span>
        
        <span class="c1"># Create function that adjusts cash flow with new stream price</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">depreciation_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tax</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">IRR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;IRR&#39;</span><span class="p">]</span>
        <span class="n">cost_factor</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">massnet</span><span class="o">*</span><span class="n">flow_factor</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">tax</span><span class="p">)</span>
        <span class="n">CF</span> <span class="o">=</span> <span class="n">cashflow_data</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">][</span><span class="n">start</span><span class="p">:]</span>
        <span class="n">CF_copy</span> <span class="o">=</span> <span class="n">_array</span><span class="p">(</span><span class="n">CF</span><span class="p">)</span>
        <span class="n">system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span>
        <span class="k">if</span> <span class="n">stream</span> <span class="ow">in</span> <span class="n">system</span><span class="o">.</span><span class="n">feeds</span><span class="p">:</span>
            <span class="n">adjust</span> <span class="o">=</span> <span class="n">CF_copy</span><span class="o">.</span><span class="fm">__sub__</span>
        <span class="k">elif</span> <span class="n">stream</span> <span class="ow">in</span> <span class="n">system</span><span class="o">.</span><span class="n">products</span><span class="p">:</span>
            <span class="n">adjust</span> <span class="o">=</span> <span class="n">CF_copy</span><span class="o">.</span><span class="fm">__add__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Stream &#39;</span><span class="si">{stream.ID}</span><span class="s2">&#39; must be either a feed or a product of the system&quot;</span><span class="p">)</span>
        
        <span class="c1"># Guess cost adjustment for solver</span>
        <span class="n">guess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cost_guess</span>
        <span class="n">cost_guess</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">guess</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">guess</span>
        
        <span class="c1"># Solve</span>
        <span class="k">if</span> <span class="n">update</span><span class="p">:</span>
            <span class="n">calc_NPV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_NPV_and_update</span>
            <span class="n">data_subset</span> <span class="o">=</span> <span class="n">cashflow_data</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span>
            <span class="k">def</span> <span class="nf">break_even_point</span><span class="p">(</span><span class="n">cost</span><span class="p">):</span>
                <span class="n">CF</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">adjust</span><span class="p">(</span><span class="n">cost</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">calc_NPV</span><span class="p">(</span><span class="n">IRR</span><span class="p">,</span> <span class="n">data_subset</span><span class="p">,</span> <span class="n">duration_array</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cost_guess</span> <span class="o">=</span> <span class="n">cost</span> <span class="o">=</span> <span class="n">newton</span><span class="p">(</span><span class="n">break_even_point</span><span class="p">,</span> <span class="n">cost_guess</span><span class="p">)</span>
            <span class="n">stream</span><span class="o">.</span><span class="n">price</span> <span class="o">+=</span> <span class="n">cost</span><span class="o">/</span><span class="n">cost_factor</span>
            <span class="n">price</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">price</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_parameters</span><span class="p">(</span><span class="n">flow_factor</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_calc_cashflow</span><span class="p">(</span><span class="n">cashflow_data</span><span class="p">,</span>
                                <span class="n">parameters</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span>
                                <span class="n">depreciation_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_results</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">data_subset</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">calc_NPV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_NPV</span>
            <span class="n">data_subset</span> <span class="o">=</span> <span class="n">cashflow_data</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">def</span> <span class="nf">break_even_point</span><span class="p">(</span><span class="n">cost</span><span class="p">):</span>
                <span class="n">CF</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">adjust</span><span class="p">(</span><span class="n">cost</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">calc_NPV</span><span class="p">(</span><span class="n">IRR</span><span class="p">,</span> <span class="n">data_subset</span><span class="p">,</span> <span class="n">duration_array</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cost_guess</span> <span class="o">=</span> <span class="n">cost</span> <span class="o">=</span> <span class="n">newton</span><span class="p">(</span><span class="n">break_even_point</span><span class="p">,</span> <span class="n">cost_guess</span><span class="p">)</span>
            <span class="n">price</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">price</span> <span class="o">+</span> <span class="n">cost</span><span class="o">/</span><span class="n">cost_factor</span>
        
        <span class="k">return</span> <span class="n">price</span></div>
    
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">f</span><span class="s1">&#39;&lt;{type(self).__name__}: </span><span class="si">{self.system.ID}</span><span class="s1">&gt;&#39;</span>
    
    <span class="k">def</span> <span class="nf">_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;{type(self).__name__}: </span><span class="si">{self.system.ID}</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">IRR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;IRR&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span>
        <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
            <span class="n">NPV</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Net present value&#39;</span><span class="p">]</span>
            <span class="n">ROI</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Return on investment&#39;</span><span class="p">]</span>
            <span class="n">PBP</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Pay back period&#39;</span><span class="p">]</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">f</span><span class="s1">&#39; NPV: </span><span class="si">{NPV:.3g}</span><span class="s1"> USD at </span><span class="si">{IRR:.1f}</span><span class="s1">% IRR</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">f</span><span class="s1">&#39; ROI: </span><span class="si">{ROI:.3g}</span><span class="s1"> 1/yr</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">f</span><span class="s1">&#39; PBP: </span><span class="si">{PBP:.3g}</span><span class="s1"> yr&#39;</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">f</span><span class="s1">&#39; NPV: None</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">f</span><span class="s1">&#39; ROI: None</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">f</span><span class="s1">&#39; PBP: None&#39;</span>
        <span class="k">return</span> <span class="n">out</span>
    
<div class="viewcode-block" id="TEA.show"><a class="viewcode-back" href="../../TEA.html#biosteam.TEA.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print information on TEA.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">())</span></div></div>
        
        
        
    
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">BioSTEAM 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Yoel Cortes-Pena and Guest Group.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.4.
    </div>
  </body>
</html>