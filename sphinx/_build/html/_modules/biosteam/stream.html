
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>biosteam.stream &#8212; BioSTEAM 0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">BioSTEAM 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for biosteam.stream</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Sat Aug 18 14:05:10 2018</span>

<span class="sd">@author: yoelr</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">biosteam</span> <span class="k">import</span> <span class="n">Q_</span><span class="p">,</span> <span class="n">units_of_measure</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">newton</span><span class="p">,</span> <span class="n">least_squares</span>
<span class="kn">from</span> <span class="nn">biosteam.utils</span> <span class="k">import</span> <span class="n">material_array</span><span class="p">,</span> <span class="n">property_array</span><span class="p">,</span> <span class="n">PropertyFactory</span><span class="p">,</span> \
                           <span class="n">tuple_array</span><span class="p">,</span> <span class="n">reorder</span><span class="p">,</span> <span class="n">get_frac</span><span class="p">,</span> <span class="n">Sink</span><span class="p">,</span> <span class="n">Source</span>
<span class="kn">from</span> <span class="nn">biosteam.find</span> <span class="k">import</span> <span class="n">find</span>
<span class="kn">from</span> <span class="nn">biosteam.species</span> <span class="k">import</span> <span class="n">Species</span>
<span class="kn">from</span> <span class="nn">biosteam.exceptions</span> <span class="k">import</span> <span class="n">SolverError</span><span class="p">,</span> <span class="n">DimensionError</span>
<span class="kn">from</span> <span class="nn">biosteam.UNIFAC</span> <span class="k">import</span> <span class="n">DORTMUND</span>

<span class="n">ln</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span>
<span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<span class="c1">#plt.style.use(&#39;dark_background&#39;)</span>
<span class="c1">#CS = color_scheme</span>

<span class="c1"># %% TODOs</span>

<span class="c1"># TODO: add material property interphase when using Cape Open package</span>


<span class="c1"># %% Functions</span>

<span class="k">def</span> <span class="nf">nonzero_species</span><span class="p">(</span><span class="n">index_ID</span><span class="p">,</span> <span class="n">flow</span><span class="p">):</span>
    <span class="n">index</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">species</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">index_ID</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">flow</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">species</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="n">species</span>


<span class="c1"># %% Units of measure</span>

<span class="n">mol_units</span> <span class="o">=</span> <span class="n">units_of_measure</span><span class="p">[</span><span class="s1">&#39;mol&#39;</span><span class="p">]</span>
<span class="n">mass_units</span> <span class="o">=</span> <span class="n">units_of_measure</span><span class="p">[</span><span class="s1">&#39;mass&#39;</span><span class="p">]</span>
<span class="n">vol_units</span> <span class="o">=</span> <span class="n">units_of_measure</span><span class="p">[</span><span class="s1">&#39;vol&#39;</span><span class="p">]</span>
<span class="n">T_units</span> <span class="o">=</span> <span class="n">units_of_measure</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span>

<span class="n">mol_flow_dim</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mol_units</span><span class="p">)</span><span class="o">.</span><span class="n">dimensionality</span>
<span class="n">mass_flow_dim</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mass_units</span><span class="p">)</span><span class="o">.</span><span class="n">dimensionality</span>
<span class="n">vol_flow_dim</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">vol_units</span><span class="p">)</span><span class="o">.</span><span class="n">dimensionality</span>

<span class="k">class</span> <span class="nc">ShowFormat</span><span class="p">:</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;_T&#39;</span><span class="p">,</span> <span class="s1">&#39;_P&#39;</span><span class="p">,</span> <span class="s1">&#39;_flow&#39;</span><span class="p">,</span> <span class="s1">&#39;_fraction&#39;</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_T</span> <span class="o">=</span> <span class="s1">&#39;K&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_P</span> <span class="o">=</span> <span class="s1">&#39;Pa&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flow</span> <span class="o">=</span> <span class="s1">&#39;kmol/hr&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fraction</span> <span class="o">=</span> <span class="kc">False</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">T</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_T</span>
    <span class="nd">@T</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">T</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
        <span class="c1"># Test to make sure it has temperature units</span>
        <span class="n">Q_</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">ito</span><span class="p">(</span><span class="s1">&#39;K&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_T</span> <span class="o">=</span> <span class="n">T</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">P</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_P</span>
    <span class="nd">@P</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">P</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
        <span class="c1"># Test to make sure it has pressure units</span>
        <span class="n">Q_</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span><span class="o">.</span><span class="n">ito</span><span class="p">(</span><span class="s1">&#39;Pa&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_P</span> <span class="o">=</span> <span class="n">P</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">flow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flow</span>
    <span class="nd">@flow</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">flow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">):</span>
        <span class="c1"># Test to make sure it has flow units</span>
        <span class="n">flow_dim</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">flow</span><span class="p">)</span><span class="o">.</span><span class="n">dimensionality</span>
        <span class="n">invalid_dimension</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="p">(</span><span class="n">mol_flow_dim</span><span class="p">,</span> <span class="n">mass_flow_dim</span><span class="p">,</span> <span class="n">vol_flow_dim</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">flow_dim</span> <span class="o">==</span> <span class="n">dim</span><span class="p">:</span>
                <span class="n">invalid_dimension</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">invalid_dimension</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DimensionError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Dimensions for flow units must be in molar, mass or volumetric flow rates, not &#39;</span><span class="si">{flow_dim}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flow</span> <span class="o">=</span> <span class="n">flow</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fraction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fraction</span>
    <span class="nd">@fraction</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">fraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fraction</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fraction</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">fraction</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dummy</span> <span class="o">=</span> <span class="s1">&#39;-in fractions-&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="k">return</span> <span class="n">f</span><span class="s2">&quot;&lt;{type(self).__name__}: T=&#39;</span><span class="si">{self.T}</span><span class="s2">&#39;, P=&#39;</span><span class="si">{self.P}</span><span class="s2">&#39;, flow=&#39;</span><span class="si">{self.flow}</span><span class="s2">&#39;</span><span class="si">{dummy}</span><span class="s2">&gt;&quot;</span>

<span class="c1"># %% Flow properties</span>

<span class="nd">@PropertyFactory</span>
<span class="k">def</span> <span class="nf">MassFlow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mass flow (kg/hr).&quot;&quot;&quot;</span>
    <span class="n">mol</span><span class="p">,</span> <span class="n">MW</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
    <span class="k">if</span> <span class="n">mol</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">mol</span> <span class="o">*</span> <span class="n">MW</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.</span>

<span class="nd">@MassFlow</span><span class="o">.</span><span class="n">setter</span>
<span class="k">def</span> <span class="nf">MassFlow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">mol</span><span class="p">,</span> <span class="n">MW</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
    <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
        <span class="n">mol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">/</span><span class="n">MW</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>

<span class="nd">@PropertyFactory</span>    
<span class="k">def</span> <span class="nf">VolumetricFlow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Volumetric flow (m^3/hr).&quot;&quot;&quot;</span>
    <span class="n">specie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
    <span class="n">stream</span><span class="p">,</span> <span class="n">mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
    <span class="k">if</span> <span class="n">mol</span><span class="p">:</span>
        <span class="n">specie</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">T</span>
        <span class="n">specie</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">P</span>
        <span class="n">specie</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">specie</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">mol</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.</span>

<span class="nd">@VolumetricFlow</span><span class="o">.</span><span class="n">setter</span>
<span class="k">def</span> <span class="nf">VolumetricFlow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">specie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
    <span class="n">stream</span><span class="p">,</span> <span class="n">mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
    <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
        <span class="n">specie</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">T</span>
        <span class="n">specie</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">P</span>
        <span class="n">specie</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">mol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">/</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">specie</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>


<span class="c1"># %% Stream classes</span>


<span class="k">class</span> <span class="nc">metaStream</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Metaclass for Stream.&quot;&quot;&quot;</span>
    <span class="n">__instances</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">superclasses</span><span class="p">,</span> <span class="n">new_definitions</span><span class="p">):</span>
        <span class="c1"># Add a Species object if not inherited</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;_species&#39;</span><span class="p">):</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_species</span> <span class="o">=</span> <span class="n">Species</span><span class="p">()</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_show_format</span> <span class="o">=</span> <span class="n">ShowFormat</span><span class="p">()</span>
        <span class="nb">type</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">__instances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">species</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;[Species] Contains pure component thermodynamic properties for computing overall properties of Stream instances.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_species</span>

    <span class="nd">@species</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">species</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">species</span><span class="p">):</span>
        <span class="c1"># Set Species object and working species</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">Species</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">__instances</span><span class="p">:</span>
                <span class="c1"># Set species</span>
                <span class="n">cl</span><span class="o">.</span><span class="n">_species</span> <span class="o">=</span> <span class="n">species</span>
                
                <span class="c1"># ID of all species</span>
                <span class="n">cl</span><span class="o">.</span><span class="n">_specie_IDs</span> <span class="o">=</span> <span class="n">IDs</span> <span class="o">=</span> <span class="n">species</span><span class="o">.</span><span class="n">ID</span>
                
                <span class="c1"># CAS of all species</span>
                <span class="n">cl</span><span class="o">.</span><span class="n">_CAS</span> <span class="o">=</span> <span class="n">CAS</span> <span class="o">=</span> <span class="n">species</span><span class="o">.</span><span class="n">CAS</span>
                
                <span class="c1"># Number of species</span>
                <span class="n">cl</span><span class="o">.</span><span class="n">_Nspecies</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">IDs</span><span class="p">)</span>  
                
                <span class="c1"># Indexes of the species (for flow rates)</span>
                <span class="n">cl</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_Nspecies</span><span class="p">))</span>
                
                <span class="c1"># Dictionary of ID to index</span>
                <span class="n">cl</span><span class="o">.</span><span class="n">_ID_index</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">IDs</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>
                
                <span class="c1"># Dictionary of index to ID</span>
                <span class="n">cl</span><span class="o">.</span><span class="n">_index_ID</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">IDs</span><span class="p">))</span>
                
                <span class="c1"># Dictionary of CAS to index</span>
                <span class="n">cl</span><span class="o">.</span><span class="n">_CAS_index</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">CAS</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>
                
                <span class="c1"># Dictionary of index to CAS </span>
                <span class="n">cl</span><span class="o">.</span><span class="n">_index_CAS</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">CAS</span><span class="p">))</span>
                
                <span class="c1"># Set molecular weights for all species</span>
                <span class="n">cl</span><span class="o">.</span><span class="n">_MW</span> <span class="o">=</span> <span class="n">tuple_array</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">get_props</span><span class="p">(</span><span class="n">IDs</span><span class="p">,</span> <span class="s1">&#39;MW&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Must pass a Species object&#39;</span><span class="p">)</span>
            
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">show_format</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;[ShowFormat] Contains attributes with the units of measure for the show method.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_show_format</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="n">Stream</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="s1">&#39;biosteam.</span><span class="si">{cls.__name__}</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="s1">&#39;Stream.</span><span class="si">{cls.__name__}</span><span class="s1">&#39;</span>


<div class="viewcode-block" id="Stream"><a class="viewcode-back" href="../../Stream.html#biosteam.Stream">[docs]</a><span class="k">class</span> <span class="nc">Stream</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">metaStream</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a Stream object that defines a thermodynamic state along with material flow rates. Stream objects calculate thermodynamic and transport properties of the mixture and its components. The Species object define the chemical species avalilable for the Stream class. Ideal mixture is assumed for stream properties and excess energies [enthalpy and entropy] are ignored as a simplifying assumption for low pressure processes.</span>

<span class="sd">**Parameters**</span>

<span class="sd">    **ID:** [str] ID of the stream. If ID is &#39;&#39;, a default ID will be chosen.</span>

<span class="sd">    **flow:** [tuple] All flow rates corresponding to `species`.</span>

<span class="sd">    **species:** tuple[str] or [Species] Species corresponding to `flow`. If empty, assume same species as class.</span>

<span class="sd">    **units:** [str] The units of the flow rates (only mass, molar, and volumetric flow rates are valid)</span>

<span class="sd">    **phase:** [str] &#39;l&#39; for liquid, &#39;g&#39; for gas</span>

<span class="sd">    **T:** [float] Temperature (K)</span>

<span class="sd">    **P:** [float] Pressure (Pa)</span>

<span class="sd">    ****flow_pairs:** Specie-flow pairs</span>

<span class="sd">**Class Properties**</span>

<span class="sd">    **species** = Species(): [Species] Contains pure component thermodynamic properties for computing overall properties of Stream instances</span>

<span class="sd">    **show_format**: [ShowFormat] Object with attributes that describe how the show method presents units</span>

<span class="sd">**Class Attributes**</span>

<span class="sd">    **_default_ID** = [&#39;d&#39;, 1]: list[str, int] Default starting letter and current number for ID.</span>

<span class="sd">    **units** = {&#39;C&#39;: &#39;kJ/K/hr&#39;, &#39;Cp&#39;: &#39;J/g/K&#39;, &#39;Cpm&#39;: &#39;J/mol/K&#39;, &#39;H&#39;: &#39;kJ/hr&#39;, &#39;S&#39;: &#39;kJ/hr&#39;, &#39;G&#39;: &#39;kJ/hr&#39;, &#39;U&#39;: &#39;kJ/hr&#39;, &#39;A&#39;: &#39;kJ/hr&#39;, &#39;Hf&#39;: &#39;kJ/hr&#39;, &#39;MW&#39;: &#39;g/mol&#39;, &#39;P&#39;: &#39;Pa&#39;, &#39;T&#39;: &#39;K&#39;, &#39;Vm&#39;: &#39;m^3/mol&#39;, &#39;alpha&#39;: &#39;m^2/s&#39;, &#39;k&#39;: &#39;W/m/K&#39;, &#39;mass&#39;: &#39;kg/hr&#39;, &#39;massfrac&#39;: &#39;kg/kg&#39;, &#39;massnet&#39;: &#39;kg/hr&#39;, &#39;mol&#39;: &#39;kmol/hr&#39;, &#39;molfrac&#39;: &#39;kmol/kmol&#39;, &#39;molnet&#39;: &#39;kmol/hr&#39;, &#39;mu&#39;: &#39;Pa*s&#39;, &#39;nu&#39;: &#39;m^2/s&#39;, &#39;rho&#39;: &#39;kg/m^3&#39;, &#39;rhom&#39;: &#39;mol/m^3&#39;, &#39;sigma&#39;: &#39;N/m&#39;, &#39;vol&#39;: &#39;m^3/hr&#39;, &#39;volfrac&#39;: &#39;m^3/m^3&#39;, &#39;volnet&#39;: &#39;m^3/hr&#39;}</span>
<span class="sd">    : *[dict]* Units of measure for material properties. Items in this dictionary cannot be changed.</span>

<span class="sd">**Examples**</span>

<span class="sd">    Before making a stream, set the species using a Species object:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">       &gt;&gt;&gt; # Set Species object</span>
<span class="sd">       &gt;&gt;&gt; Stream.species = Species(&#39;Ethanol&#39;, &#39;Water&#39;) </span>

<span class="sd">    Stream objects may be created a variety of ways:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">       &gt;&gt;&gt; # Create a stream specifying specie and flow rate pairs:</span>
<span class="sd">       &gt;&gt;&gt; s1 = Stream(ID=&#39;s1&#39;, Water=2)</span>
<span class="sd">       &gt;&gt;&gt; s1.show()</span>
<span class="sd">       Stream: s1</span>
<span class="sd">        phase: &#39;l&#39;, T: 298.15 K, P: 101325 Pa</span>
<span class="sd">        flow (kmol/hr): Water  2</span>

<span class="sd">       &gt;&gt;&gt; # Create a stream assuming same specie order as given in specie_IDs:</span>
<span class="sd">       &gt;&gt;&gt; s2 = Stream(ID=&#39;s2&#39;, flow=(1, 2))</span>
<span class="sd">       &gt;&gt;&gt; s2.show()</span>
<span class="sd">       Stream: s2</span>
<span class="sd">        phase: &#39;l&#39;, T: 298.15 K, P: 101325 Pa</span>
<span class="sd">        flow (kmol/hr): Ethanol  1</span>
<span class="sd">                        Water    2</span>

<span class="sd">       &gt;&gt;&gt; # Create a stream passing flow rate units, phase, temperature and pressure:</span>
<span class="sd">       &gt;&gt;&gt; s3 = Stream(ID=&#39;s3&#39;, flow=(0.278, 0.556), units=&#39;mol/s&#39;, phase=&#39;g&#39;, T=400, P=101325)</span>
<span class="sd">       &gt;&gt;&gt; s3.show()</span>
<span class="sd">       Stream: s3</span>
<span class="sd">        phase: &#39;g&#39;, T: 400 K, P: 101325 Pa</span>
<span class="sd">        flow (kmol/hr): Ethanol  1.</span>
<span class="sd">                        Water    2.</span>

<span class="sd">       &gt;&gt;&gt; # The working units do not change</span>
<span class="sd">       &gt;&gt;&gt; s3.mol </span>
<span class="sd">       material_array([1., 2.]) (kmol/hr)</span>

<span class="sd">    .. Warning:: Stream objects do not automatically calculate thermodynamic equilibrium. They simply assume the given phase, temperature and pressure are correct. To find equilibrium, use the VLE or LLE method.</span>

<span class="sd">    .. Note:: All following examples will use the Stream objects created here (s1, s2, and s3) starting from its initial values.</span>

<span class="sd">    Use the `show` method to print all specifications with desired units:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">       &gt;&gt;&gt; # Temperature in degree Celsius</span>
<span class="sd">       &gt;&gt;&gt; s2.show(T=&#39;degC&#39;)</span>
<span class="sd">       Stream: s2 </span>
<span class="sd">        phase: &#39;l&#39;, T: 25. degC, P: 101325 Pa</span>
<span class="sd">        flow (kg/hr): Ethanol  46.1</span>
<span class="sd">                      Water    36</span>
<span class="sd">       </span>
<span class="sd">       &gt;&gt;&gt; # Flow in kg/hr</span>
<span class="sd">       &gt;&gt;&gt; s2.show(flow=&#39;kg/hr&#39;)</span>
<span class="sd">       Stream: s2 </span>
<span class="sd">        phase: &#39;l&#39;, T: 298.15 K, P: 101325 Pa</span>
<span class="sd">        flow (kg/hr): Ethanol  46.1</span>
<span class="sd">                      Water    36</span>

<span class="sd">       &gt;&gt;&gt; # Flow in fractions</span>
<span class="sd">       &gt;&gt;&gt; s2.show(fraction=True)</span>
<span class="sd">       Stream: s2</span>
<span class="sd">        phase: &#39;l&#39;, T: 298.15 K, P: 101325 Pa</span>
<span class="sd">        flow: Ethanol  0.333</span>
<span class="sd">              Water    0.667</span>
<span class="sd">                       3 kmol/hr</span>

<span class="sd">    Flow rates are stored internally as a material_array in the ‘mol’ attribute. A material_array object is a numpy ndarray which issues a RuntimeWarning when a negative or non-finite number is encountered:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">       &gt;&gt;&gt; # Set Water flow rate</span>
<span class="sd">       &gt;&gt;&gt; s2.mol[1] = 18</span>
<span class="sd">       &gt;&gt;&gt; s2.mol</span>
<span class="sd">       material_array([1, 18]) (kmol/hr)</span>
<span class="sd">       </span>
<span class="sd">       &gt;&gt;&gt; # A negative flow issues a RuntimeWarning</span>
<span class="sd">       &gt;&gt;&gt; s2.mol[1] = -1</span>
<span class="sd">       __main__:1: RuntimeWarning:</span>
<span class="sd">       Encountered negative or non-finite value in &#39;material_array&#39; object.</span>
<span class="sd">       </span>
<span class="sd">       &gt;&gt;&gt; # Setting the property sets its values in place</span>
<span class="sd">       &gt;&gt;&gt; s2.mol = [1, 2]</span>
<span class="sd">       &gt;&gt;&gt; s2.mol</span>
<span class="sd">       material_array([1, 2]) (kmol/hr)</span>

<span class="sd">    .. Note::</span>

<span class="sd">       material_array objects are numpy ndarrays which issue a RuntimeWarning when a negative or non-finite number is encountered.</span>

<span class="sd">    Mass and volumetric flow rates are also available as property_arrays of the molar flow rate. As such, they are always up to date with the molar flow rate and altering them also alters the molar flow rate:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">       &gt;&gt;&gt; # Altering mass or volumetric flows alters the molar flow</span>
<span class="sd">       &gt;&gt;&gt; s2.vol</span>
<span class="sd">       property_array([0.059, 0.036]) (m^3/hr)</span>
<span class="sd">       &gt;&gt;&gt; s2.vol[:] = [1, 1]</span>
<span class="sd">       &gt;&gt;&gt; s2.mol</span>
<span class="sd">       material_array([17.06 , 55.343]) (kmol/hr)</span>
<span class="sd">       </span>
<span class="sd">       &gt;&gt;&gt; # Values are always up to date with the molar flow</span>
<span class="sd">       &gt;&gt;&gt; s2.mol[:] = [1, 2]</span>
<span class="sd">       &gt;&gt;&gt; s2.vol</span>
<span class="sd">       property_array([0.059, 0.036]) (m^3/hr)</span>

<span class="sd">    .. Note::</span>

<span class="sd">       property_array objects are significantly slower than material_array objects. This is because flow rate data is internally stored as molar flow rates. Also, property_array objects are arrays of python objects, which add overhead over the C implementation of numpy. Whenever possible, use the material_array to manage flow rates. </span>

<span class="sd">    Some thermodynamic/material properties, including enthalpy and heat capacity, are dependent only on temperature:</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">    </span>
<span class="sd">       &gt;&gt;&gt; # Enthalpy (kJ/hr) and heat capacity (kJ/(kg-K))</span>
<span class="sd">       &gt;&gt;&gt; s2.T = 298.15</span>
<span class="sd">       &gt;&gt;&gt; s2.Cp</span>
<span class="sd">       3.200382054794244</span>
<span class="sd">       &gt;&gt;&gt; s2.H </span>
<span class="sd">       0.0</span>
<span class="sd">       </span>
<span class="sd">       &gt;&gt;&gt; # Change of temperature</span>
<span class="sd">       &gt;&gt;&gt; s2.T = 310</span>
<span class="sd">       &gt;&gt;&gt; s2.H</span>
<span class="sd">       3140.9389548625936</span>
<span class="sd">       &gt;&gt;&gt; s2.Cp</span>
<span class="sd">       3.2590872180092956</span>
<span class="sd">       </span>
<span class="sd">    .. Note:: Thermodynamic energies are relative to 25 degC and 1 atm.</span>
<span class="sd">    </span>
<span class="sd">    Some thermodynamic/material properties, including volume and density, are dependent on both temperature and pressure:</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">    </span>
<span class="sd">       &gt;&gt;&gt; # Volumetric flow rate (m^3/hr) and density (kg/m^3)</span>
<span class="sd">       &gt;&gt;&gt; s1.volnet</span>
<span class="sd">       0.036138079740245625</span>
<span class="sd">       &gt;&gt;&gt; s1.rho</span>
<span class="sd">       997.0247522552814</span>
<span class="sd">      </span>
<span class="sd">       &gt;&gt;&gt; # Change of pressure</span>
<span class="sd">       &gt;&gt;&gt; s1.P *= 4</span>
<span class="sd">       &gt;&gt;&gt; s1.volnet</span>
<span class="sd">       0.036136231155141196</span>
<span class="sd">       &gt;&gt;&gt; s1.rho</span>
<span class="sd">       997.0757560552587</span>
<span class="sd">      </span>
<span class="sd">       &gt;&gt;&gt; # Change of temperature</span>
<span class="sd">       &gt;&gt;&gt; s1.T += 30</span>
<span class="sd">       &gt;&gt;&gt; s1.volnet</span>
<span class="sd">       0.03663597700908213</span>
<span class="sd">       &gt;&gt;&gt; s1.rho</span>
<span class="sd">       983.4747955832584</span>

<span class="sd">    A dictionary of available material properties is available in `Stream.units`. You may also find it useful to use the `help` method to search for a property:</span>
<span class="sd">        </span>
<span class="sd">    .. code-block:: python</span>

<span class="sd">       &gt;&gt;&gt; Stream.help(&#39;conductivity&#39;)</span>
<span class="sd">       Thermal conductivity, k, is dependent on T and P with units, W/m/K, and type, float.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">activity_coefficients</span> <span class="o">=</span> <span class="n">DORTMUND</span>

    <span class="c1"># [dict] Units of measure for material properties (class attribute). Items in this dictionary cannot be changed.</span>
    <span class="n">units</span> <span class="o">=</span> <span class="n">units_of_measure</span>

    <span class="c1"># Utils information regarding properties</span>
    <span class="n">_prop_molar_info</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># ID         # Description               # Dependency # Units      # Type</span>
        <span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">,</span>        <span class="s1">&#39;temperature&#39;</span><span class="p">,</span>              <span class="s1">&#39;&#39;</span><span class="p">,</span>          <span class="s1">&#39;K&#39;</span><span class="p">,</span>         <span class="s1">&#39;float&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span>        <span class="s1">&#39;enthalpy&#39;</span><span class="p">,</span>                 <span class="s1">&#39;T&#39;</span><span class="p">,</span>         <span class="s1">&#39;kJ/hr&#39;</span><span class="p">,</span>     <span class="s1">&#39;float&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">,</span>        <span class="s1">&#39;entropy&#39;</span><span class="p">,</span>                  <span class="s1">&#39;TP&#39;</span><span class="p">,</span>        <span class="s1">&#39;kJ/hr&#39;</span><span class="p">,</span>     <span class="s1">&#39;float&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">,</span>        <span class="s1">&#39;Gibbs free energy&#39;</span><span class="p">,</span>        <span class="s1">&#39;TP&#39;</span><span class="p">,</span>        <span class="s1">&#39;kJ/hr&#39;</span><span class="p">,</span>     <span class="s1">&#39;float&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;U&#39;</span><span class="p">,</span>        <span class="s1">&#39;interal energy&#39;</span><span class="p">,</span>           <span class="s1">&#39;TP&#39;</span><span class="p">,</span>        <span class="s1">&#39;kJ/hr&#39;</span><span class="p">,</span>     <span class="s1">&#39;float&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span>        <span class="s1">&#39;Helmholtz free energy&#39;</span><span class="p">,</span>    <span class="s1">&#39;TP&#39;</span><span class="p">,</span>        <span class="s1">&#39;kJ/hr&#39;</span><span class="p">,</span>     <span class="s1">&#39;float&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;Hf&#39;</span><span class="p">,</span>       <span class="s1">&#39;enthalpy of formation&#39;</span><span class="p">,</span>    <span class="s1">&#39;&#39;</span><span class="p">,</span>          <span class="s1">&#39;kJ/hr&#39;</span><span class="p">,</span>     <span class="s1">&#39;float&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">,</span>        <span class="s1">&#39;pressure&#39;</span><span class="p">,</span>                 <span class="s1">&#39;&#39;</span><span class="p">,</span>          <span class="s1">&#39;Pa&#39;</span><span class="p">,</span>        <span class="s1">&#39;float&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;Cpm&#39;</span><span class="p">,</span>      <span class="s1">&#39;molar heat capacity&#39;</span><span class="p">,</span>      <span class="s1">&#39;T&#39;</span><span class="p">,</span>         <span class="s1">&#39;J/mol/K&#39;</span><span class="p">,</span>   <span class="s1">&#39;float&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;Cp&#39;</span><span class="p">,</span>       <span class="s1">&#39;specific heat capacity&#39;</span><span class="p">,</span>   <span class="s1">&#39;T&#39;</span><span class="p">,</span>         <span class="s1">&#39;J/kg/K&#39;</span><span class="p">,</span>    <span class="s1">&#39;float&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;Vm&#39;</span><span class="p">,</span>       <span class="s1">&#39;molar volume&#39;</span><span class="p">,</span>             <span class="s1">&#39;TP&#39;</span><span class="p">,</span>        <span class="s1">&#39;m^3/mol&#39;</span><span class="p">,</span>   <span class="s1">&#39;float&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">,</span>      <span class="s1">&#39;density&#39;</span><span class="p">,</span>                  <span class="s1">&#39;TP&#39;</span><span class="p">,</span>        <span class="s1">&#39;kg/m^3&#39;</span><span class="p">,</span>    <span class="s1">&#39;float&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;rhom&#39;</span><span class="p">,</span>     <span class="s1">&#39;molar density&#39;</span><span class="p">,</span>            <span class="s1">&#39;TP&#39;</span><span class="p">,</span>        <span class="s1">&#39;mol/m^3&#39;</span><span class="p">,</span>   <span class="s1">&#39;float&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">,</span>       <span class="s1">&#39;kinematic viscosity&#39;</span><span class="p">,</span>      <span class="s1">&#39;TP&#39;</span><span class="p">,</span>        <span class="s1">&#39;m^2/s&#39;</span><span class="p">,</span>     <span class="s1">&#39;float&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;mu&#39;</span><span class="p">,</span>       <span class="s1">&#39;hydraulic viscosity&#39;</span><span class="p">,</span>      <span class="s1">&#39;TP&#39;</span><span class="p">,</span>        <span class="s1">&#39;Pa*s&#39;</span><span class="p">,</span>      <span class="s1">&#39;float&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span>    <span class="s1">&#39;surface tension&#39;</span><span class="p">,</span>          <span class="s1">&#39;T&#39;</span><span class="p">,</span>         <span class="s1">&#39;N/m&#39;</span><span class="p">,</span>       <span class="s1">&#39;float&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>        <span class="s1">&#39;thermal conductivity&#39;</span><span class="p">,</span>     <span class="s1">&#39;TP&#39;</span><span class="p">,</span>        <span class="s1">&#39;W/m/K&#39;</span><span class="p">,</span>     <span class="s1">&#39;float&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span>    <span class="s1">&#39;thermal diffusivity&#39;</span><span class="p">,</span>      <span class="s1">&#39;TP&#39;</span><span class="p">,</span>        <span class="s1">&#39;m^2/s&#39;</span><span class="p">,</span>     <span class="s1">&#39;float&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;Pr&#39;</span><span class="p">,</span>       <span class="s1">&#39;Prantl number&#39;</span><span class="p">,</span>            <span class="s1">&#39;TP&#39;</span><span class="p">,</span>        <span class="s2">&quot;&#39;&#39;&quot;</span><span class="p">,</span>        <span class="s1">&#39;float&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;mass&#39;</span><span class="p">,</span>     <span class="s1">&#39;mass flow rates&#39;</span><span class="p">,</span>          <span class="s1">&#39;&#39;</span><span class="p">,</span>          <span class="s1">&#39;kg/hr&#39;</span><span class="p">,</span>     <span class="s1">&#39;np.array&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;mol&#39;</span><span class="p">,</span>      <span class="s1">&#39;molar flow rates&#39;</span><span class="p">,</span>         <span class="s1">&#39;&#39;</span><span class="p">,</span>          <span class="s1">&#39;kmol/hr&#39;</span><span class="p">,</span>   <span class="s1">&#39;np.array&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;vol&#39;</span><span class="p">,</span>      <span class="s1">&#39;volumetric flow rates&#39;</span><span class="p">,</span>    <span class="s1">&#39;TP&#39;</span><span class="p">,</span>        <span class="s1">&#39;m^3/hr&#39;</span><span class="p">,</span>    <span class="s1">&#39;np.array&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;massnet&#39;</span><span class="p">,</span>  <span class="s1">&#39;net mass flow rate&#39;</span><span class="p">,</span>       <span class="s1">&#39;&#39;</span><span class="p">,</span>          <span class="s1">&#39;kg/hr&#39;</span><span class="p">,</span>     <span class="s1">&#39;float&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;molnet&#39;</span><span class="p">,</span>   <span class="s1">&#39;net molar flow rate&#39;</span><span class="p">,</span>      <span class="s1">&#39;&#39;</span><span class="p">,</span>          <span class="s1">&#39;kmol/hr&#39;</span><span class="p">,</span>   <span class="s1">&#39;float&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;volnet&#39;</span><span class="p">,</span>   <span class="s1">&#39;net volumetric flow rate&#39;</span><span class="p">,</span> <span class="s1">&#39;TP&#39;</span><span class="p">,</span>        <span class="s1">&#39;m^3/hr&#39;</span><span class="p">,</span>    <span class="s1">&#39;float&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;massfrac&#39;</span><span class="p">,</span> <span class="s1">&#39;mass fractions&#39;</span><span class="p">,</span>           <span class="s1">&#39;&#39;</span><span class="p">,</span>          <span class="s1">&#39;kg/kg&#39;</span><span class="p">,</span>     <span class="s1">&#39;np.array&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;molfrac&#39;</span><span class="p">,</span>  <span class="s1">&#39;molar fractions&#39;</span><span class="p">,</span>          <span class="s1">&#39;&#39;</span><span class="p">,</span>          <span class="s1">&#39;kmol/kmol&#39;</span><span class="p">,</span> <span class="s1">&#39;np.array&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;volfrac&#39;</span><span class="p">,</span>  <span class="s1">&#39;volumetric fractions&#39;</span><span class="p">,</span>     <span class="s1">&#39;TP&#39;</span><span class="p">,</span>        <span class="s1">&#39;m^3/m^3&#39;</span><span class="p">,</span>   <span class="s1">&#39;np.array&#39;</span><span class="p">]]</span>

    <span class="c1">### Class attributes for working species ###</span>
    
    <span class="c1">#: UNIFAC parameters cached</span>
    <span class="c1"># {specie_IDs: (chemgroups, rs, qs, group_counts)}</span>
    <span class="n">_cached</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="c1">#: Number of species</span>
    <span class="n">_Nspecies</span> <span class="o">=</span> <span class="mi">0</span>  
    
    <span class="c1">#: Mol indexes</span>
    <span class="n">_index</span> <span class="o">=</span> <span class="p">()</span>
    
    <span class="c1">#: Dictionary to look up index by specie</span>
    <span class="n">_ID_index</span> <span class="o">=</span> <span class="p">{}</span>  
    
    <span class="c1">#: Dictionary to look up specie by index</span>
    <span class="n">_index_ID</span> <span class="o">=</span> <span class="p">{}</span>  
    
    <span class="c1">#: Array of molecular weights</span>
    <span class="n">_MW</span> <span class="o">=</span> <span class="p">()</span>
    
    <span class="c1">#: Species order for mass balance</span>
    <span class="n">_specie_IDs</span> <span class="o">=</span> <span class="p">()</span>

    <span class="c1"># [list] Default starting letter and current number for ID (class attribute)</span>
    <span class="n">_default_ID</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1">#: Default ID</span>
    <span class="n">_ID</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ID</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">flow</span><span class="o">=</span><span class="p">(),</span> <span class="n">species</span><span class="o">=</span><span class="p">(),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;kmol/hr&#39;</span><span class="p">,</span>
                 <span class="n">phase</span><span class="o">=</span><span class="s1">&#39;l&#39;</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">298.15</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mi">101325</span><span class="p">,</span> <span class="o">**</span><span class="n">flow_pairs</span><span class="p">):</span>
        <span class="c1"># Get species ID and set species information</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">Species</span><span class="p">):</span>
            <span class="c1"># Set species as provided</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">species</span>
            <span class="n">specie_IDs</span> <span class="o">=</span> <span class="p">()</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">):</span>
            <span class="n">specie_IDs</span> <span class="o">=</span> <span class="n">species</span>
            <span class="c1"># Copy class species data (in case it changes)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_species</span> <span class="o">=</span> <span class="n">species</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_species</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_specie_IDs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_specie_IDs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_CAS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_CAS</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Nspecies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Nspecies</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ID_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ID_index</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_index_ID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_ID</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_CAS_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_CAS_index</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">_index_CAS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_CAS</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_MW</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MW</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;species must be a Species object, not {type(species).__name__}&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">=</span> <span class="n">ID</span>
        
        <span class="c1">#: Dew point cached</span>
        <span class="c1"># {specie_IDs: (pressure,</span>
        <span class="c1">#               temperature,</span>
        <span class="c1">#               vapor composition,</span>
        <span class="c1">#               liquid composition)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dew_cached</span> <span class="o">=</span> <span class="p">{}</span>
        
        
        <span class="c1">#: Bubble point cached</span>
        <span class="c1"># {specie_IDs: (pressure,</span>
        <span class="c1">#               temperature,</span>
        <span class="c1">#               vapor composition,</span>
        <span class="c1">#               liquid composition)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bubble_cached</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1">#: tuple with source unit ID and outs position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_source</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        
        <span class="c1">#: tuple with sink unit ID and ins position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sink</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        
        <span class="c1">#: [str] &#39;l&#39;(iquid), or &#39;g&#39;(as)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span>
        
        <span class="c1">#: [float] Temperature (K)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>
        
        <span class="c1">#: [str] &#39;l&#39; (liquid), or &#39;g&#39; (gas)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">P</span>  
        
        <span class="c1"># Add specie flow pairs</span>
        <span class="n">specie_IDs</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">flow_pairs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">flow</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">flow_pairs</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        
        <span class="c1"># Match species and flow rates</span>
        <span class="n">l_flow</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span>
        <span class="n">l_species</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">l_species</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">l_flow</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">flow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Nspecies</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">l_species</span> <span class="o">==</span> <span class="n">l_flow</span><span class="p">:</span>
            <span class="n">flow</span> <span class="o">=</span> <span class="n">reorder</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">specie_IDs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_specie_IDs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">l_flow</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Nspecies</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Length of flowrates must be equal to length of species&#39;</span><span class="p">)</span>

        <span class="c1"># Set molar flow rates</span>
        <span class="n">flow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">flow_wt_units</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">units</span><span class="p">)</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="n">flow_wt_units</span><span class="o">.</span><span class="n">dimensionality</span>
        <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="n">mol_flow_dim</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">flow_wt_units</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="s1">&#39;mol&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">magnitude</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mol</span> <span class="o">=</span> <span class="n">material_array</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">dim</span> <span class="o">==</span> <span class="n">mass_flow_dim</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">flow_wt_units</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">mass_units</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MW</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mol</span> <span class="o">=</span> <span class="n">material_array</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">dim</span> <span class="o">==</span> <span class="n">vol_flow_dim</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mol</span> <span class="o">=</span> <span class="n">material_array</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_vol</span><span class="p">(</span><span class="n">flow_wt_units</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">vol_units</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DimensionError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Dimensions for flow units must be in molar, mass or volumetric flow rates, not &#39;</span><span class="si">{dim}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>

        <span class="n">mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mol</span>
        <span class="n">MW</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MW</span>
        
        <span class="c1"># Mass flow rates</span>
        <span class="n">mass</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ID</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">ID</span><span class="p">):</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">MassFlow</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="p">(</span><span class="n">mol</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">MW</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="n">mass</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mass</span> <span class="o">=</span> <span class="n">property_array</span><span class="p">(</span><span class="n">mass</span><span class="p">)</span>
        
        <span class="c1"># Volumetric flow rates    </span>
        <span class="n">vol</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">specie</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">species</span><span class="p">):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">VolumetricFlow</span><span class="p">(</span><span class="n">specie</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">vol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vol</span> <span class="o">=</span> <span class="n">property_array</span><span class="p">(</span><span class="n">vol</span><span class="p">)</span>

    <span class="c1"># Forward pipping</span>
    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Sink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">Stream</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Unsupported operand type(s) for -: &#39;{type(self)}&#39; and &#39;{type(index)}&#39;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">index</span><span class="o">.</span><span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">Stream</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Unsupported operand type(s) for -: &#39;{type(self)}&#39; and &#39;{type(index)}&#39;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">index</span><span class="o">.</span><span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1"># Backward pipping    </span>
    <span class="fm">__pow__</span> <span class="o">=</span> <span class="fm">__sub__</span>
    <span class="fm">__rpow__</span> <span class="o">=</span> <span class="fm">__rsub__</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">species</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;[Species] Contains pure component thermodynamic properties for computing overall properties of Stream instances.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_species</span>

    <span class="nd">@species</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">species</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">species</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;can&#39;t set attribute&quot;</span><span class="p">)</span>
        <span class="c1"># Set Species object and working species</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">Species</span><span class="p">):</span>
            <span class="c1"># Set species</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_species</span> <span class="o">=</span> <span class="n">species</span>
            
            <span class="c1"># ID of all species</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_specie_IDs</span> <span class="o">=</span> <span class="n">IDs</span> <span class="o">=</span> <span class="n">species</span><span class="o">.</span><span class="n">ID</span>
            
            <span class="c1"># CAS of all species</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_CAS</span> <span class="o">=</span> <span class="n">CAS</span> <span class="o">=</span> <span class="n">species</span><span class="o">.</span><span class="n">CAS</span>
            
            <span class="c1"># Number of species</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Nspecies</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">IDs</span><span class="p">)</span>  
            
            <span class="c1"># Indexes of the species (for flow rates)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Nspecies</span><span class="p">))</span>
            
            <span class="c1"># Dictionary of ID to index</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ID_index</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">IDs</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>
            
            <span class="c1"># Dictionary of index to ID</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_index_ID</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">IDs</span><span class="p">))</span>
            
            <span class="c1"># Dictionary of CAS to index</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_CAS_index</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">CAS</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>
            
            <span class="c1"># Dictionary of index to CAS </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_index_CAS</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">CAS</span><span class="p">))</span>
            
            <span class="c1"># Set molecular weights for all species</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_MW</span> <span class="o">=</span> <span class="n">tuple_array</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">get_props</span><span class="p">(</span><span class="n">IDs</span><span class="p">,</span> <span class="s1">&#39;MW&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Must pass an instance of Species&#39;</span><span class="p">)</span>
            
    <span class="n">show_format</span> <span class="o">=</span> <span class="n">metaStream</span><span class="o">.</span><span class="n">show_format</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ID</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Unique identification (str). If set as &#39;&#39;, it will choose a default ID.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span>

    <span class="nd">@ID</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">ID</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ID</span><span class="p">):</span>
        <span class="c1"># Remove old reference to this object</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">ID</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">find</span><span class="o">.</span><span class="n">stream</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ID</span><span class="p">]</span>

        <span class="c1"># Get current default ID</span>
        <span class="n">Stream</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">letter</span><span class="p">,</span> <span class="n">number</span> <span class="o">=</span> <span class="n">Stream</span><span class="o">.</span><span class="n">_default_ID</span>

        <span class="c1"># Make sure given ID is not a default ID</span>
        <span class="k">if</span> <span class="n">ID</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">letter</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ID</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;IDs starting with &#39;</span><span class="si">{letter}</span><span class="s2">&#39; and followed by only digits are reserved for defaults. To use the default ID, set ID as &#39;Default&#39;.&quot;</span><span class="p">)</span>

        <span class="c1"># Select a default ID if requested</span>
        <span class="k">if</span> <span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">Stream</span><span class="o">.</span><span class="n">_default_ID</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">ID</span> <span class="o">=</span> <span class="n">letter</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>

        <span class="c1"># Add ID to find dictionary and set it</span>
        <span class="n">find</span><span class="o">.</span><span class="n">stream</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ID</span> <span class="o">=</span> <span class="n">ID</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">MW</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Molecular weight of all species (array g/mol):     </span>

<span class="sd">        &gt;&gt;&gt; s2.MW </span>
<span class="sd">        [46.06844, 18.01528]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MW</span>

    <span class="c1">### Flow properties ###</span>
    
<div class="viewcode-block" id="Stream.get_index"><a class="viewcode-back" href="../../Stream.html#biosteam.Stream.get_index">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_index</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">IDs</span><span class="p">,</span> <span class="n">CAS</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get flow indeces of specified species.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">             IDs: list[str] or [str] Specie names</span>

<span class="sd">        Example</span>

<span class="sd">        Get indeces by user defined ID:</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; s1.get_index(&#39;Water&#39;)</span>
<span class="sd">        1</span>
<span class="sd">        &gt;&gt;&gt; s1.get_index([&#39;Water&#39;, &#39;Ethanol&#39;])</span>
<span class="sd">        [1, 0]</span>

<span class="sd">        Get indeces by CAS number:</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; s1,get_index(&#39;64-17-5&#39;):</span>
<span class="sd">        0</span>
<span class="sd">        &gt;&gt;&gt; s1,get_index([&#39;64-17-5&#39;, &#39;7732-18-5&#39;]):</span>
<span class="sd">        [0, 1]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">CAS</span><span class="p">:</span>
            <span class="n">index_dict</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_CAS_index</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">index_dict</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_ID_index</span>
        
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">IDs</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">index_dict</span><span class="p">[</span><span class="n">IDs</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">index_dict</span><span class="p">[</span><span class="n">ID</span><span class="p">]</span> <span class="k">for</span> <span class="n">ID</span> <span class="ow">in</span> <span class="n">IDs</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">indices</span></div>
    <span class="n">get_indx</span> <span class="o">=</span> <span class="n">get_index</span> <span class="c1">#: Alias of get_index.</span>
    
    <span class="c1"># Molar flow</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Array of molar flow rates by specie (array kmol/hr):</span>

<span class="sd">        &gt;&gt;&gt; s1.mol</span>
<span class="sd">        material_array([0, 2]) (kmol/hr)</span>
<span class="sd">        &gt;&gt;&gt; s1.mol = [1, 2]</span>
<span class="sd">        &gt;&gt;&gt; s1.mol</span>
<span class="sd">        material_array([1, 2]) (kmol/hr)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mol</span>

    <span class="nd">@mol</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">mol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mol</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Length of flow property ({len(val)} given) must be the same as the number of species (</span><span class="si">{self._Nspecies}</span><span class="s1">)&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">molfrac</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Array of molar fractions (molar fractions).</span>

<span class="sd">        &gt;&gt;&gt; s1.molfrac</span>
<span class="sd">        tuple_array([0., 1.])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get_frac</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mol</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">tuple_array</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">molnet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Net molar flow rate (kmol/hr)</span>

<span class="sd">        &gt;&gt;&gt; s2.molnet</span>
<span class="sd">        3</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mol</span><span class="p">)</span>

    <span class="c1"># Mass flow</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Array of mass flow rates by specie (array kg/hr)</span>

<span class="sd">        &gt;&gt;&gt; s1.mass</span>
<span class="sd">        property_array([ 0.   , 36.031])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mass</span>

    <span class="nd">@mass</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">mass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mass</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">val</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">massfrac</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Array of mass fractions (mass fractions).</span>

<span class="sd">        &gt;&gt;&gt; s1.massfrac</span>
<span class="sd">        tuple_array([0, 1])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get_frac</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mol</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MW</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">tuple_array</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">massnet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Net mass flow rate (kg/hr)</span>

<span class="sd">        &gt;&gt;&gt; s2.massnet</span>
<span class="sd">        82.099</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mass</span><span class="p">)</span>

    <span class="c1"># Volumetric flow</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Array of volumetric flow rates by specie (array m^3/hr). T and P dependent.</span>

<span class="sd">        &gt;&gt;&gt; s2.vol</span>
<span class="sd">        property_array([0.059, 0.036])</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vol</span>

    <span class="nd">@vol</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">vol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vol</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">val</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">volfrac</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Array of volumetric fractions (volumetric fractions). T and P dependent.</span>

<span class="sd">        &gt;&gt;&gt; s2.volfrac</span>
<span class="sd">        tuple_array([0.619, 0.381])</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">volnet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Net volumetric flow rate (m^3/hr). T and P dependent.</span>

<span class="sd">        &gt;&gt;&gt; s2.volnet # a liquid stream</span>
<span class="sd">        0.09475552896916632</span>
<span class="sd">        &gt;&gt;&gt; s3.volnet # a gas stream</span>
<span class="sd">        97.32699378482434</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prop_molar_flownet</span><span class="p">(</span><span class="s1">&#39;Vm&#39;</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span>

    <span class="c1"># Set non-molar flows</span>
<div class="viewcode-block" id="Stream.set_mass"><a class="viewcode-back" href="../../Stream.html#biosteam.Stream.set_mass">[docs]</a>    <span class="k">def</span> <span class="nf">set_mass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mass_flow</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set flow rates by mass in kg/hr.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">             mass_flow: [array_like] Mass flow rates.</span>

<span class="sd">             index: array_like[int] Indeces of species corresponding to mass flow rates.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">           &gt;&gt;&gt; s1.set_mass(20 , index = 1)</span>
<span class="sd">           &gt;&gt;&gt; s1.mass</span>
<span class="sd">           tuple_array([0., 20])</span>
<span class="sd">           &gt;&gt;&gt; # No need to specify indeces when all flow rates are specified</span>
<span class="sd">           &gt;&gt;&gt; s1.set_mass([0, 36.031])</span>
<span class="sd">           &gt;&gt;&gt; s1.mass</span>
<span class="sd">           tuple_array([0, 36.031])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">mass_flow</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MW</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">mass_flow</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MW</span><span class="p">[</span><span class="n">index</span><span class="p">]</span></div>
    
<div class="viewcode-block" id="Stream.set_vol"><a class="viewcode-back" href="../../Stream.html#biosteam.Stream.set_vol">[docs]</a>    <span class="k">def</span> <span class="nf">set_vol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vol_flow</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set flow rates by volume in m^3/hr.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">             vol_flow: [array_like] Volumetric flow rates.</span>

<span class="sd">             index: array_like[int] Indeces of species corresponding to volumetric flow rates.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">           &gt;&gt;&gt; s1.set_vol(20 , index = 1)</span>
<span class="sd">           &gt;&gt;&gt; s1.vol</span>
<span class="sd">           tuple_array([0., 20])</span>
<span class="sd">           &gt;&gt;&gt; # No need to specify indeces when all flow rates are specified</span>
<span class="sd">           &gt;&gt;&gt; s1.set_vol([0, 1])</span>
<span class="sd">           &gt;&gt;&gt; s1.vol</span>
<span class="sd">           tuple_array([0, 1])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vol_flow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vol_flow</span><span class="p">)</span>
        <span class="n">species</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Vms</span> <span class="o">=</span> <span class="n">species</span><span class="o">.</span><span class="n">get_props</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_specie_IDs</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">vol_flow</span> <span class="o">/</span> <span class="n">Vms</span> <span class="o">/</span> <span class="mi">1000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">index_sp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_ID</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">):</span>
                <span class="n">specie_IDs</span> <span class="o">=</span> <span class="p">(</span><span class="n">index_sp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">index</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">specie_IDs</span> <span class="o">=</span> <span class="n">index_sp</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">Vms</span> <span class="o">=</span> <span class="n">species</span><span class="o">.</span><span class="n">get_props</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">vol_flow</span> <span class="o">/</span> <span class="n">Vms</span> <span class="o">/</span> <span class="mi">1000</span></div>

    <span class="c1">### Energy flows ###</span>

    <span class="c1"># Enthalpy</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">H</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enthalpy flow rate (kJ/hr) without formation energies. Only T dependent.</span>

<span class="sd">        &gt;&gt;&gt; s1.H # The stream is at the reference state</span>
<span class="sd">        0.0</span>
<span class="sd">        &gt;&gt;&gt; s1.H = 1000</span>
<span class="sd">        &gt;&gt;&gt; s1.T</span>
<span class="sd">        304.80600901692236</span>
<span class="sd">        &gt;&gt;&gt; s1.H</span>
<span class="sd">        1002.1604769775776</span>

<span class="sd">        .. Note:: The solver reaches a level of tolerance and the new temperature is an approximation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prop_molar_flownet</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>

    <span class="nd">@H</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">H</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">H</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">H</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Cannot set nonzero enthalpy &quot;</span>
                                <span class="o">+</span><span class="n">f</span><span class="s2">&quot;to empty stream &#39;</span><span class="si">{self.ID}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="c1"># First approximation</span>
        <span class="n">T_old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span>
        <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">+=</span> <span class="p">(</span><span class="n">H</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">)</span><span class="o">/</span><span class="n">C</span>

        <span class="c1"># Solve enthalpy by iteration</span>
        <span class="n">it</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">T_old</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">:</span>
            <span class="n">T_old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">+=</span> <span class="p">(</span><span class="n">H</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">)</span><span class="o">/</span><span class="n">C</span>
            <span class="n">it</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">it</span> <span class="o">&gt;</span> <span class="mi">40</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SolverError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Could not solve temperature &quot;</span>
                                 <span class="o">+</span><span class="n">f</span><span class="s2">&quot;for given enthalpy in stream &#39;</span><span class="si">{self.ID}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Hf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Heat of formation flow rate (kJ/hr).</span>

<span class="sd">        &gt;&gt;&gt; s1.Hf</span>
<span class="sd">        -483640.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prop_molar_flownet</span><span class="p">(</span><span class="s1">&#39;Hfm&#39;</span><span class="p">)</span>

    <span class="c1"># Entropy</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">S</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Entropy flow rate (kJ/hr) without formation energies. T and P dependent.</span>

<span class="sd">        &gt;&gt;&gt; s1.S # The stream is at the reference state</span>
<span class="sd">        0.0</span>
<span class="sd">        &gt;&gt;&gt; s1.T = 320</span>
<span class="sd">        &gt;&gt;&gt; s1.S</span>
<span class="sd">        10.642980522582695</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prop_molar_flownet</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">)</span>

    <span class="c1"># Gibbs free energy</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">G</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gibbs free energy flow rate (kJ/hr) without formation energies. T and P dependent.</span>

<span class="sd">        &gt;&gt;&gt; s1.G # The stream is at the reference state</span>
<span class="sd">        0.0</span>
<span class="sd">        &gt;&gt;&gt; s1.T = 320</span>
<span class="sd">        &gt;&gt;&gt; s1.G</span>
<span class="sd">        -117.6450204179555</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span>

    <span class="c1"># Internal energy</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">U</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal energy flow rate (kJ/hr) without formation energies. T and P dependent.</span>

<span class="sd">        &gt;&gt;&gt; s1.U # The stream is at the reference state</span>
<span class="sd">        0.0</span>
<span class="sd">        &gt;&gt;&gt; s1.T = 320</span>
<span class="sd">        &gt;&gt;&gt; s1.U</span>
<span class="sd">        -409.16014979602505</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">volnet</span>

    <span class="c1"># Helmholtz</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">A</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Helmholtz energy flow rate (kJ/hr) without formation energies. T and P dependent.</span>

<span class="sd">        &gt;&gt;&gt; s1.A # The stream is at the reference state</span>
<span class="sd">        0.0</span>
<span class="sd">        &gt;&gt;&gt; s1.T = 320</span>
<span class="sd">        &gt;&gt;&gt; s1.A</span>
<span class="sd">        -3814.9139170224876</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">U</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span>

    <span class="c1"># Capacity flow rate</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">C</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Heat capacity flow rate (kJ/K/hr). T dependent.</span>

<span class="sd">        &gt;&gt;&gt; s2.C</span>
<span class="sd">        262.74816631655267</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prop_molar_flownet</span><span class="p">(</span><span class="s1">&#39;Cpm&#39;</span><span class="p">)</span>

    <span class="c1"># Material properties</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Cp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Specific heat capacity (J/g/K). T dependent.</span>

<span class="sd">        &gt;&gt;&gt; s1.Cp</span>
<span class="sd">        4.180597021827335</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpm</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">molnet</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">massnet</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Cpm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Molar heat capacity (J/mol/K). T dependent.</span>

<span class="sd">        &gt;&gt;&gt; s1.Cpm # (J/mol/K)</span>
<span class="sd">        75.31462591538556</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">molnet</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Vm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Molar volume (m^3/mol). T and P dependent.</span>

<span class="sd">        &gt;&gt;&gt; s1.Vm</span>
<span class="sd">        1.8069039870122814e-05</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prop_molar_mean</span><span class="p">(</span><span class="s1">&#39;Vm&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rho</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Density (kg/m^3). T and P dependent.</span>

<span class="sd">        &gt;&gt;&gt; s1.rho</span>
<span class="sd">        997.0247522552814</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">massnet</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">volnet</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rhom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Molar density (mol/m^3). T and P dependent.</span>

<span class="sd">        &gt;&gt;&gt; s1.rhom</span>
<span class="sd">        55343.283715561534</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">molnet</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_prop_molar_flownet</span><span class="p">(</span><span class="s1">&#39;Vm&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Kinematic viscosity (m^2/s). T and P dependent.</span>

<span class="sd">        &gt;&gt;&gt; s1.nu</span>
<span class="sd">        9.154438858391748e-07</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Hydraulic viscosity (Pa*s). T and P dependent.</span>

<span class="sd">        &gt;&gt;&gt; s1.mu</span>
<span class="sd">        0.0009127202134824155</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Katti, P.K.; Chaudhri, M.M. (1964). &quot;Viscosities of Binary Mixtures of Benzyl Acetate with Dioxane, Aniline, and m-Cresol&quot;. Journal of Chemical and Engineering Data. 9 (1964): 442–443.</span>
        <span class="n">molfrac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">molfrac</span>
        <span class="n">mus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_prop_list</span><span class="p">(</span><span class="s1">&#39;mu&#39;</span><span class="p">))</span>
        <span class="n">Vms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_prop_list</span><span class="p">(</span><span class="s1">&#39;Vm&#39;</span><span class="p">))</span>
        <span class="n">Vm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vm</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">molfrac</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">exp</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">molfrac</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="o">*</span><span class="n">ln</span><span class="p">(</span><span class="n">mus</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="o">*</span><span class="n">Vms</span><span class="p">[</span><span class="n">pos</span><span class="p">])))</span><span class="o">/</span><span class="n">Vm</span> 

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">k</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Thermal conductivity (W/m/k). T and P dependent.</span>

<span class="sd">        &gt;&gt;&gt; s1.k</span>
<span class="sd">        0.5942044328004411</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prop_molar_mean</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Thermal diffusivity (m^2/s). T and P dependent.</span>

<span class="sd">        &gt;&gt;&gt; s1.alpha</span>
<span class="sd">        1.4255801521655763e-07</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prop_molar_mean</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sigma</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Surface tension (N/m). T dependent.</span>

<span class="sd">        &gt;&gt;&gt; s1.sigma</span>
<span class="sd">        0.07205503890847455</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prop_molar_mean</span><span class="p">(</span><span class="s1">&#39;sigma&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Pr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prandtl number (non-dimensional). T and P dependent.</span>

<span class="sd">        &gt;&gt;&gt; s1.Pr</span>
<span class="sd">        6.421553249380879</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prop_molar_mean</span><span class="p">(</span><span class="s1">&#39;Pr&#39;</span><span class="p">)</span>

    <span class="c1"># Other properties</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;tuple with the ID of the unit it exits and the position&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;tuple with the ID of the unit it enters and the position&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sink</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nonzero_species</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return flow indeces and species that have a non-zero flow rate.</span>

<span class="sd">        **Return**</span>

<span class="sd">             **index:** list[float] flow indexes that are not zero</span>

<span class="sd">             **species:** list[str] IDs for species corresponding to index</span>

<span class="sd">        &gt;&gt;&gt; s1.nonzero_species</span>
<span class="sd">        [1], [&#39;Water&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">nonzero_species</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_index_ID</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">)</span>
    
<div class="viewcode-block" id="Stream.prop_quantity"><a class="viewcode-back" href="../../Stream.html#biosteam.Stream.prop_quantity">[docs]</a>    <span class="k">def</span> <span class="nf">prop_quantity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop_ID</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a property as a Quantity object as described in the `pint package &lt;https://pint.readthedocs.io/en/latest/&gt;`__ </span>

<span class="sd">        **Parameters**</span>

<span class="sd">             **prop_ID:** [str] name of the property (e.g. &#39;mol&#39;, &#39;H&#39;, &#39;k&#39; ...)</span>

<span class="sd">        Example:</span>

<span class="sd">        &gt;&gt;&gt; s1.prop_quantity(&#39;Cp&#39;)</span>
<span class="sd">        &lt;Quantity(4.180597021827335, &#39;joule / gram / kelvin&#39;)&gt;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Q_</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop_ID</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="n">prop_ID</span><span class="p">])</span></div>

    <span class="c1"># Sensitivity analysis</span>
    <span class="k">def</span> <span class="nf">_prop_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop_ID</span><span class="p">,</span> <span class="n">var_ID</span><span class="p">,</span> <span class="n">var_vals</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an array of property values at &#39;var_vals&#39;.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">             **prop_ID:** [str] Name of the dependent property (e.g. &#39;rho&#39;, &#39;Cp&#39;, &#39;H&#39;, &#39;volnet&#39; ...)</span>

<span class="sd">             **var_ID:** [str] Name of the independent variable (e.g &#39;T&#39;, &#39;P&#39;, &#39;molnet&#39; ...)</span>

<span class="sd">             **var_vals:** [numpy array] Independent variable values at which to compute the property</span>

<span class="sd">             **index:** [array_like or None] Optional indices if the variable is an array and the given values are a subset of the array.</span>

<span class="sd">        Example</span>

<span class="sd">        &gt;&gt;&gt; s1._prop_table( &#39;H&#39;, &#39;T&#39;, [298.15, 299.15, 300.15, 301.15, 302.15])</span>
<span class="sd">        array([  0.   ,  65.041, 130.231, 195.569, 261.055])</span>

<span class="sd">        &gt;&gt;&gt; s1._prop_table( &#39;rho&#39;, &#39;mol&#39; , [0, 1, 2, 3, 4], index = 0) # vary the amount of Ethanol</span>
<span class="sd">        array([997.025, 866.43 , 835.659, 821.904, 814.109])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">get_var</span><span class="p">():</span>
                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_ID</span><span class="p">)[</span><span class="n">index</span><span class="p">]</span>

            <span class="k">def</span> <span class="nf">set_var</span><span class="p">(</span><span class="n">xf</span><span class="p">):</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_ID</span><span class="p">)[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">xf</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">get_var</span><span class="p">():</span>
                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_ID</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">set_var</span><span class="p">(</span><span class="n">xf</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_ID</span><span class="p">,</span> <span class="n">xf</span><span class="p">)</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">get_var</span><span class="p">()</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_vals</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">var_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">set_var</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop_ID</span><span class="p">)</span>
        <span class="n">set_var</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">y</span>

<div class="viewcode-block" id="Stream.prop_plot"><a class="viewcode-back" href="../../Stream.html#biosteam.Stream.prop_plot">[docs]</a>    <span class="k">def</span> <span class="nf">prop_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop_ID</span><span class="p">,</span> <span class="n">var_ID</span><span class="p">,</span> <span class="n">var_vals</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make a plot of a property vs a variable.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">             **prop_ID:** [str] Name of the property (e.g. &#39;rho&#39;, &#39;Cp&#39;, &#39;H&#39;, &#39;volnet&#39; ...)</span>

<span class="sd">             **var_ID:** [str] Name of the variable (e.g &#39;T&#39;, &#39;P&#39;, &#39;molnet&#39; ...)</span>

<span class="sd">             **var_vals:** [numpy array] Independent variable values at which to compute the property</span>

<span class="sd">             **index:** [array_like or None] Optional indices if the variable is an array</span>

<span class="sd">        Example</span>

<span class="sd">        &gt;&gt;&gt; s1.prop_plot( &#39;H&#39;, &#39;T&#39;, [298.15, 299.15, 300.15, 301.15, 302.15])</span>

<span class="sd">        .. image:: prop_plot.png</span>
<span class="sd">           :scale: 70 %</span>
<span class="sd">           :align: center</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prop_table</span><span class="p">(</span><span class="n">prop_ID</span><span class="p">,</span> <span class="n">var_ID</span><span class="p">,</span> <span class="n">var_vals</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">var_vals</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">var_ID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_ID</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">var_ID</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">var_ID</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">units</span><span class="p">[</span><span class="n">var_ID</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">prop_ID</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">units</span><span class="p">[</span><span class="n">prop_ID</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span></div>

    <span class="c1"># Derivative of a property and sensivity analysis</span>
<div class="viewcode-block" id="Stream.prop_derivative"><a class="viewcode-back" href="../../Stream.html#biosteam.Stream.prop_derivative">[docs]</a>    <span class="k">def</span> <span class="nf">prop_derivative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop_ID</span><span class="p">,</span> <span class="n">var_ID</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the derivative of property &#39;prop_ID&#39; and variable &#39;var_ID&#39;. If the property given by var_ID is an array, use index to specify which element.</span>

<span class="sd">         **Parameters**</span>

<span class="sd">             **prop_ID:** [str] Name of the property (e.g. &#39;rho&#39;, &#39;Cp&#39;, &#39;H&#39;, &#39;volnet&#39; ...)</span>

<span class="sd">             **var_ID:** [str] Name of the variable (e.g &#39;T&#39;, &#39;P&#39;, &#39;molnet&#39; ...)</span>

<span class="sd">             **index:** [array_like or None] Optional indices if the variable is an array</span>

<span class="sd">        Example</span>

<span class="sd">        &gt;&gt;&gt; s1.prop_derivative(&#39;rho&#39;, &#39;T&#39;)</span>
<span class="sd">        -0.4010588564718449</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">get_var</span><span class="p">():</span>
                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_ID</span><span class="p">)[</span><span class="n">index</span><span class="p">]</span>

            <span class="k">def</span> <span class="nf">set_var</span><span class="p">(</span><span class="n">xf</span><span class="p">):</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_ID</span><span class="p">)[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">xf</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">get_var</span><span class="p">():</span>
                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_ID</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">set_var</span><span class="p">(</span><span class="n">xf</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_ID</span><span class="p">,</span> <span class="n">xf</span><span class="p">)</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">get_var</span><span class="p">()</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop_ID</span><span class="p">)</span>
        <span class="n">xf</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">6</span>
        <span class="n">set_var</span><span class="p">(</span><span class="n">xf</span><span class="p">)</span>
        <span class="n">yf</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop_ID</span><span class="p">)</span>
        <span class="n">set_var</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">yf</span><span class="o">-</span><span class="n">y0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">xf</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_prop_derivative_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop_ID</span><span class="p">,</span> <span class="n">var_ID</span><span class="p">,</span> <span class="n">var_vals</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an array of property derivatives at &#39;var_vals&#39; </span>

<span class="sd">        **Parameters**</span>

<span class="sd">             **prop_ID:** [str] Name of the dependent property (e.g. &#39;rho&#39;, &#39;Cp&#39;, &#39;H&#39;, &#39;volnet&#39; ...)</span>

<span class="sd">             **var_ID:** [str] Name of the independent variable (e.g &#39;T&#39;, &#39;P&#39;, &#39;molnet&#39; ...)</span>

<span class="sd">             **var_vals:** [numpy array] Independent variable values at which to compute the property</span>

<span class="sd">             **index:** [array_like or None] Optional indices if the variable is an array</span>

<span class="sd">        Example</span>

<span class="sd">        &gt;&gt;&gt; s1._prop_derivative_table(&#39;rho&#39;, &#39;T&#39;, [298.15, 300.15, 302.15, 304.15, 306.15, 308.15])</span>
<span class="sd">        array([-0.401, -0.408, -0.415, -0.422, -0.429, -0.436])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">get_var</span><span class="p">():</span>
                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_ID</span><span class="p">)[</span><span class="n">index</span><span class="p">]</span>

            <span class="k">def</span> <span class="nf">set_var</span><span class="p">(</span><span class="n">xf</span><span class="p">):</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_ID</span><span class="p">)[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">xf</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">get_var</span><span class="p">():</span>
                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_ID</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">set_var</span><span class="p">(</span><span class="n">xf</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_ID</span><span class="p">,</span> <span class="n">xf</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">Dvar</span><span class="p">(</span><span class="n">x0</span><span class="p">):</span>
            <span class="n">set_var</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop_ID</span><span class="p">)</span>
            <span class="n">xf</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">6</span>
            <span class="n">set_var</span><span class="p">(</span><span class="n">xf</span><span class="p">)</span>
            <span class="n">yf</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop_ID</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">yf</span><span class="o">-</span><span class="n">y0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">xf</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span>
        
        <span class="n">x0</span> <span class="o">=</span> <span class="n">get_var</span><span class="p">()</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_vals</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">var_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Dvar</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="n">set_var</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">y</span>

<div class="viewcode-block" id="Stream.prop_derivative_plot"><a class="viewcode-back" href="../../Stream.html#biosteam.Stream.prop_derivative_plot">[docs]</a>    <span class="k">def</span> <span class="nf">prop_derivative_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop_ID</span><span class="p">,</span> <span class="n">var_ID</span><span class="p">,</span> <span class="n">var_vals</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a property derivative plot.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">             **prop_ID:** [str] Name of the dependent property (e.g. &#39;rho&#39;, &#39;Cp&#39;, &#39;H&#39;, &#39;volnet&#39;)</span>

<span class="sd">             **var_ID:** [str] Name of the independent variable (e.g &#39;T&#39;, &#39;P&#39;, &#39;molnet&#39;)</span>

<span class="sd">             **var_vals:** [numpy array] Independent variable values at which to compute the property</span>

<span class="sd">             **index:** [array_like or None] Optional indices if the variable is an array</span>

<span class="sd">        Example</span>

<span class="sd">        &gt;&gt;&gt; s1.prop_derivative_plot(&#39;rho&#39;, &#39;T&#39;, [298.15, 300.15, 302.15, 304.15, 306.15, 308.15])</span>

<span class="sd">        .. image:: prop_derivative_plot.png</span>
<span class="sd">           :scale: 70 %</span>
<span class="sd">           :align: center</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prop_derivative_table</span><span class="p">(</span><span class="n">prop_ID</span><span class="p">,</span> <span class="n">var_ID</span><span class="p">,</span> <span class="n">var_vals</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">var_vals</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">var_ID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_ID</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">var_ID</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">var_ID</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">units</span><span class="p">[</span><span class="n">var_ID</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;d</span><span class="si">{prop_ID}</span><span class="s1">/d</span><span class="si">{var_ID}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span></div>

    <span class="c1"># General methods for getting ideal mixture properties</span>
    <span class="k">def</span> <span class="nf">_prop_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop_ID</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return component property list.&quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Nspecies</span><span class="p">)</span>
        <span class="n">_species</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_species</span>
        <span class="n">_specie_IDs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_specie_IDs</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span>
        <span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span>
        <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span>
        <span class="n">phase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mol</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">specie</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">_species</span><span class="p">,</span> <span class="n">_specie_IDs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">specie</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">P</span>
                <span class="n">specie</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>
                <span class="n">specie</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span>
                <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">specie</span><span class="p">,</span> <span class="n">prop_ID</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">_prop_molar_flow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop_ID</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return array of component properties * kmol/hr.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prop_list</span><span class="p">(</span><span class="n">prop_ID</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span>

    <span class="k">def</span> <span class="nf">_prop_molar_flownet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop_ID</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return sum of component properties * kmol/hr.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_prop_molar_flow</span><span class="p">(</span><span class="n">prop_ID</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_prop_molar_mean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop_ID</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return molar weighted average property.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prop_molar_flownet</span><span class="p">(</span><span class="n">prop_ID</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">molnet</span>

    <span class="c1"># Specifications</span>
<div class="viewcode-block" id="Stream.like"><a class="viewcode-back" href="../../Stream.html#biosteam.Stream.like">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">like</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">ID</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create either a Stream or MixedStream object just like the given stream, depending on whether multiple phases are present.&quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">stream</span>
        <span class="n">phase</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">phase</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">flow</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">mol</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="n">phase</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">P</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MS</span> <span class="o">=</span> <span class="n">mixed_stream</span><span class="o">.</span><span class="n">MixedStream</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">MS</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">solid_flow</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">solid_mol</span><span class="p">,</span> <span class="n">liquid_flow</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">liquid_mol</span><span class="p">,</span>
                     <span class="n">LIQUID_flow</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">LIQUID_mol</span><span class="p">,</span> <span class="n">vapor_flow</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">vapor_mol</span><span class="p">,</span>
                     <span class="n">T</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">P</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>
    
<div class="viewcode-block" id="Stream.copy_like"><a class="viewcode-back" href="../../Stream.html#biosteam.Stream.copy_like">[docs]</a>    <span class="k">def</span> <span class="nf">copy_like</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copy mol, T, P, and phase of stream to self.</span>

<span class="sd">        &gt;&gt;&gt; s1.copy_like(s3)</span>
<span class="sd">        &gt;&gt;&gt; s1.show()</span>
<span class="sd">        Stream: s1</span>
<span class="sd">         phase: &#39;g&#39;, T: 400.00 K, P: 101325 Pa</span>
<span class="sd">         mol (kmol/hr): [Ethanol, 1]</span>
<span class="sd">                        [Water,   2]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">phase</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">phase</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>    
            <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">mol</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">P</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">T</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enable_phases</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copy_like</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span></div>

<div class="viewcode-block" id="Stream.empty"><a class="viewcode-back" href="../../Stream.html#biosteam.Stream.empty">[docs]</a>    <span class="k">def</span> <span class="nf">empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set net flow rate to zero</span>

<span class="sd">        &gt;&gt;&gt; s1.empty()</span>
<span class="sd">        &gt;&gt;&gt; s1.mol</span>
<span class="sd">        mol([0, 0]) kmol/hr</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="mi">0</span></div>
        
    <span class="k">def</span> <span class="nf">_equilibrium_species</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return IDs and indexes of species in equilibrium.&quot;&quot;&quot;</span>
        <span class="n">specie_IDs</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">_equilibrium_species</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">mol</span><span class="o">!=</span><span class="mi">0</span>
        <span class="n">specie_IDs</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">sp</span> <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">specie_IDs</span><span class="p">,</span> <span class="n">index</span>

    <span class="k">def</span> <span class="nf">_heavy_species</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return IDs and indexes of heavy species not in equilibrium.&quot;&quot;&quot;</span>
        <span class="n">specie_IDs</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">_heavy_species</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">mol</span><span class="o">!=</span><span class="mi">0</span>
        <span class="n">specie_IDs</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">sp</span> <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">specie_IDs</span><span class="p">,</span> <span class="n">index</span>

    <span class="k">def</span> <span class="nf">_light_species</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return IDs and indexes of light species not in equilibrium.&quot;&quot;&quot;</span>
        <span class="n">specie_IDs</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">_light_species</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">mol</span><span class="o">!=</span><span class="mi">0</span>
        <span class="n">specie_IDs</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">sp</span> <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">specie_IDs</span><span class="p">,</span> <span class="n">index</span>

    <span class="c1"># Equilibrium</span>
    <span class="k">def</span> <span class="nf">_default_eq_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">specie_IDs</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return default arguments for equilibrium calculations.&quot;&quot;&quot;</span>
        <span class="c1"># Make sure species and compositions are ok</span>
        <span class="n">bol1</span> <span class="o">=</span> <span class="n">z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">;</span> <span class="n">bol2</span> <span class="o">=</span> <span class="n">specie_IDs</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">bol1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">bol2</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">)</span>
            <span class="n">mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">mol</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="n">bol1</span> <span class="ow">and</span> <span class="n">bol2</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Composition was given with out specie IDs.&#39;</span><span class="p">)</span>
        
        <span class="c1"># Choose species that have UNIFAC groups</span>
        <span class="k">if</span> <span class="n">specie_IDs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Get the molar fraction for those species that are not zero</span>
            <span class="n">specie_IDs</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_equilibrium_species</span><span class="p">()</span>
            <span class="n">mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">mol</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">z</span><span class="o">!=</span><span class="mi">0</span>
            <span class="n">specie_IDs</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">sp</span> <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        
        <span class="c1"># Default to self pressure</span>
        <span class="k">if</span> <span class="n">P</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span>
        <span class="k">return</span> <span class="n">specie_IDs</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">P</span>
    
<div class="viewcode-block" id="Stream.bubble_point"><a class="viewcode-back" href="../../Stream.html#biosteam.Stream.bubble_point">[docs]</a>    <span class="k">def</span> <span class="nf">bubble_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">specie_IDs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Bubble point given x and P. If no parameters are given, assume same composition as self.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            **specie_IDs:** iterable[str] Species corresponding to x.</span>

<span class="sd">            **x:** [array_like] The composition of the liquid phase.</span>

<span class="sd">            **P:** [float] The pressure in Pascals.</span>

<span class="sd">        **Returns**</span>

<span class="sd">            **T_bubble:** [float] The bubble point temperature</span>

<span class="sd">            **y:** [numpy ndarray] The composition of the vapor phase considering only the equilibrium species.</span>
<span class="sd">             </span>
<span class="sd">            **eq_species:** tuple[str] Species in equilibrium.</span>

<span class="sd">        &gt;&gt;&gt; s1.bubble_point(specie_IDs = (&#39;Ethanol&#39;, &#39;Water&#39;),</span>
<span class="sd">        ...                 x = (0.6, 0.4), P = 101325)</span>
<span class="sd">        (352.2820850833474, array([0.703, 0.297]), (&#39;Ethanol&#39;, &#39;Water&#39;))</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If given just one specie, return Tsat</span>
        <span class="k">if</span> <span class="n">specie_IDs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">,</span> <span class="n">specie_IDs</span><span class="p">)</span><span class="o">.</span><span class="n">Tsat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">specie_IDs</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">,</span> <span class="n">specie_IDs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">Tsat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">1</span><span class="p">,)),</span> <span class="n">specie_IDs</span>
        
        <span class="c1"># If just one specie in equilibrium, return Tsat</span>
        <span class="n">specie_IDs</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_eq_args</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">,</span> <span class="n">specie_IDs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">Tsat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">specie_IDs</span>
        
        <span class="c1"># Solve and return bubble point</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bubble_point</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">specie_IDs</span></div>
    
    <span class="k">def</span> <span class="nf">_bubble_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">specie_IDs</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Same as bubble_point but does not return equilibrium species.&quot;&quot;&quot;</span>
        <span class="c1"># Setup functions to calculate vapor pressure and activity coefficients</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_species</span>
        <span class="n">_get_Psat</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">_get_Psat</span>
        <span class="n">act_coef</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">activity_coefficients</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        
        <span class="c1"># Retrive cached info</span>
        <span class="c1"># Even if different composition, use previous bubble point as guess</span>
        <span class="n">cached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bubble_cached</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">)</span> <span class="c1"># c means cached</span>
        <span class="k">if</span> <span class="n">cached</span><span class="p">:</span>
            <span class="n">cP</span><span class="p">,</span> <span class="n">T_bubble</span><span class="p">,</span> <span class="n">y_bubble</span><span class="p">,</span> <span class="n">cx</span> <span class="o">=</span> <span class="n">cached</span>
            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">cx</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">1e-6</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cP</span> <span class="o">-</span> <span class="n">P</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># Return cached data</span>
                <span class="k">return</span> <span class="n">T_bubble</span><span class="p">,</span> <span class="n">y_bubble</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Initial temperature guess</span>
            <span class="n">T_bubble</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">sp</span><span class="o">.</span><span class="n">_get_Tb</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">))</span>

        <span class="c1"># Bubble point given x and P</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">Psat</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">def</span> <span class="nf">bubble_point_error</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
            <span class="k">nonlocal</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">Psat</span>
            <span class="n">gamma</span> <span class="o">=</span> <span class="n">act_coef</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
            <span class="n">Psat</span> <span class="o">=</span> <span class="n">_get_Psat</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">Psat</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">)</span><span class="o">/</span><span class="n">P</span>

        <span class="c1"># Solve and return</span>
        <span class="n">T_bubble</span> <span class="o">=</span> <span class="n">newton</span><span class="p">(</span><span class="n">bubble_point_error</span><span class="p">,</span> <span class="n">T_bubble</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span> <span class="mf">1e-7</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">/=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">y_bubble</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">Psat</span> <span class="o">*</span> <span class="n">gamma</span> <span class="o">/</span> <span class="n">P</span>
        <span class="n">y_bubble</span> <span class="o">/=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">y_bubble</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bubble_cached</span><span class="p">[</span><span class="n">specie_IDs</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">T_bubble</span><span class="p">,</span> <span class="n">y_bubble</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">T_bubble</span><span class="p">,</span> <span class="n">y_bubble</span>

<div class="viewcode-block" id="Stream.dew_point"><a class="viewcode-back" href="../../Stream.html#biosteam.Stream.dew_point">[docs]</a>    <span class="k">def</span> <span class="nf">dew_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">specie_IDs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dew point given y and P.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            **specie_IDs:** iterable[str] Species corresponding to y.</span>

<span class="sd">            **y:** [array_like] The composition of the vapor phase.</span>

<span class="sd">            **P:** [float] The pressure in Pascals.</span>

<span class="sd">        **Returns**</span>

<span class="sd">            **T_dew:** [float] The dew point temperature</span>

<span class="sd">            **x:** [numpy array] The composition of the liquid phase considering only the equilibrium species.</span>
<span class="sd">             </span>
<span class="sd">            **eq_species:** tuple[str] Species in equilibrium.</span>


<span class="sd">        &gt;&gt;&gt; s1.dew_point(specie_IDs = (&#39;Ethanol&#39;, &#39;Water&#39;),</span>
<span class="sd">        ...              y = (0.5, 0.5, P = 101325)</span>
<span class="sd">        (353.7420742149825, array([0.556, 0.444]), (&#39;Ethanol&#39;, &#39;Water&#39;))</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If given just one specie, get Tsat</span>
        <span class="k">if</span> <span class="n">specie_IDs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">,</span> <span class="n">specie_IDs</span><span class="p">)</span><span class="o">.</span><span class="n">Tsat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">specie_IDs</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">,</span> <span class="n">specie_IDs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">Tsat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">1</span><span class="p">,)),</span> <span class="n">specie_IDs</span>
        
        <span class="c1"># If just one specie in equilibrium, return Tsat</span>
        <span class="n">specie_IDs</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_eq_args</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">,</span> <span class="n">specie_IDs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">Tsat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">specie_IDs</span>
        
        <span class="c1"># Solve and return dew point</span>
        <span class="n">y</span><span class="p">,</span> <span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dew_point</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">y</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">specie_IDs</span></div>
    
    <span class="k">def</span> <span class="nf">_dew_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">specie_IDs</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Same as bubble_point but does not return equilibrium species.&quot;&quot;&quot;</span>
        <span class="c1"># Setup functions to calculate vapor pressure and activity coefficients</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_species</span>
        <span class="n">_get_Psat</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">_get_Psat</span>
        <span class="n">act_coef</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">activity_coefficients</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        
        <span class="c1"># Retrive cached info</span>
        <span class="c1"># Even if different composition, use previous bubble point as guess</span>
        <span class="n">cached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dew_cached</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cached</span><span class="p">:</span>
            <span class="n">cP</span><span class="p">,</span> <span class="n">T_dew</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">x_dew</span> <span class="o">=</span> <span class="n">cached</span> <span class="c1"># c means cached</span>
            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">cy</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">1e-6</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cP</span> <span class="o">-</span> <span class="n">P</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># Return cached data</span>
                <span class="k">return</span> <span class="n">T_dew</span><span class="p">,</span> <span class="n">x_dew</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Initial temperature guess</span>
            <span class="n">T_dew</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">_get_Tb</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">))</span> <span class="p">)</span>
            <span class="n">x_dew</span> <span class="o">=</span> <span class="n">y</span>

        <span class="c1"># Error function with constant y and P</span>
        <span class="k">def</span> <span class="nf">dew_point_error</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">nonlocal</span> <span class="n">T_dew</span><span class="p">,</span> <span class="n">x_dew</span>
            <span class="n">gamma</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">Psat</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># Error for dew point temperature, constant x and P</span>
            <span class="k">def</span> <span class="nf">dew_point_error_T</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
                <span class="k">nonlocal</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">Psat</span>
                <span class="n">Psat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">_get_Psat</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
                <span class="n">gamma</span> <span class="o">=</span> <span class="n">act_coef</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
                <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="o">/</span><span class="p">(</span><span class="n">Psat</span><span class="o">*</span><span class="n">gamma</span><span class="p">))</span> <span class="o">*</span> <span class="n">P</span>

            <span class="n">x_dew</span> <span class="o">=</span> <span class="n">x</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">T_dew</span> <span class="o">=</span> <span class="n">newton</span><span class="p">(</span><span class="n">dew_point_error_T</span><span class="p">,</span> <span class="n">T_dew</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span> <span class="mf">1e-7</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_dew</span> <span class="o">-</span> <span class="n">y</span><span class="o">*</span><span class="n">P</span><span class="o">/</span><span class="p">(</span><span class="n">Psat</span><span class="o">*</span><span class="n">gamma</span><span class="p">))</span>

        <span class="c1"># Get min and max splits</span>
        <span class="n">Nspecies</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">)</span>
        <span class="n">min_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nspecies</span><span class="p">)</span>
        <span class="n">max_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Nspecies</span><span class="p">)</span>

        <span class="c1"># Find x by least squares</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">x_dew</span> <span class="o">=</span> <span class="n">least_squares</span><span class="p">(</span><span class="n">dew_point_error</span><span class="p">,</span> <span class="n">x_dew</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="n">min_</span><span class="p">,</span> <span class="n">max_</span><span class="p">),</span> <span class="n">xtol</span><span class="o">=</span> <span class="mf">1e-6</span><span class="p">)</span><span class="o">.</span><span class="n">x</span>
            <span class="n">y</span> <span class="o">/=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">Tmax</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">VaporPressure</span><span class="o">.</span><span class="n">Tmax</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">specie_IDs</span><span class="p">]</span>
            <span class="n">T_dew</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">Tmax</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">x_dew</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_dew_cached</span><span class="p">[</span><span class="n">specie_IDs</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">T_dew</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x_dew</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">T_dew</span><span class="p">,</span> <span class="n">x_dew</span>

    <span class="c1"># Dimensionless number methods</span>
<div class="viewcode-block" id="Stream.Re"><a class="viewcode-back" href="../../Stream.html#biosteam.Stream.Re">[docs]</a>    <span class="k">def</span> <span class="nf">Re</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return Reynolds number.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">             **L:** [float] Characteristic lenght (m)</span>

<span class="sd">             **A:** [float] Cross-sectional area (m^2). If A is None, assume flow through a cylindrical pipe.</span>

<span class="sd">        Example</span>

<span class="sd">        &gt;&gt;&gt; s1.Re(0.2, 0.031416)</span>
<span class="sd">        373.43769007101764</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">volnet</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">volnet</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="s1">&#39;vol&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m^3/s&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span>
        <span class="k">if</span> <span class="n">A</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Assume pipe</span>
            <span class="k">return</span> <span class="mi">4</span><span class="o">*</span><span class="n">volnet</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">L</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">volnet</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="o">*</span><span class="n">A</span><span class="p">)</span></div>

    <span class="c1"># Class methods</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_helplist</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return information related to a property.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">             **prop:** [str] name or description of a property</span>

<span class="sd">        Return</span>

<span class="sd">             **out:** list[str] where elements are:</span>
<span class="sd">                  * **ID:** [str] name of the property</span>

<span class="sd">                  * **Description:** [str] description of the property</span>

<span class="sd">                  * **Dependency:** [str] TP dependency</span>

<span class="sd">                  * **Units:** [str] units of measure</span>

<span class="sd">                  * **Datatype:** [str] type returned by property</span>

<span class="sd">        Example</span>

<span class="sd">        &gt;&gt;&gt; Stream.help(&#39;k&#39;)</span>
<span class="sd">        [&#39;k&#39;, &#39;thermal conductivity&#39;, &#39;TP&#39;, &#39;W/m/K&#39;, &#39;float&#39;]</span>

<span class="sd">        &gt;&gt;&gt; Stream.help(&#39;viscosity&#39;)</span>
<span class="sd">        [[&#39;nu&#39;, &#39;kinematic viscosity&#39;, &#39;TP&#39;, &#39;m^2/s&#39;, &#39;float&#39;],</span>
<span class="sd">         [&#39;mu&#39;, &#39;hydraulic viscosity&#39;, &#39;TP&#39;, &#39;Pa*s&#39;, &#39;float&#39;]]</span>

<span class="sd">        &gt;&gt;&gt; Stream.help(&#39;kmol/hr&#39;)</span>
<span class="sd">        [[&#39;mol&#39;, &#39;molar flow rates&#39;, &#39;&#39;, &#39;kmol/hr&#39;, &#39;np.array&#39;],</span>
<span class="sd">         [&#39;molnet&#39;, &#39;net molar flow rate&#39;, &#39;&#39;, &#39;kmol/hr&#39;, &#39;float&#39;]]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Compare by both ID and description</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># Search for exact matches</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_prop_molar_info</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">prop</span> <span class="o">==</span> <span class="n">l</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
                    <span class="k">return</span> <span class="n">l</span>
            <span class="c1"># If no matches found, search harder</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_prop_molar_info</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">prop</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">l</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                        <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>

<div class="viewcode-block" id="Stream.help"><a class="viewcode-back" href="../../Stream.html#biosteam.Stream.help">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">help</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print information related to a property.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">             **prop:** [str] name or description of a property     </span>

<span class="sd">        Example</span>

<span class="sd">        &gt;&gt;&gt; Stream.help(&#39;rho&#39;)</span>
<span class="sd">        Density, rho, is dependent on T and P with units, kg/m^3, and type, float.</span>
<span class="sd">        &gt;&gt;&gt; Stream.help(&#39;density&#39;)</span>
<span class="sd">        Density, rho, is dependent on T and P with units, kg/m^3, and type, float.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">make_nice</span><span class="p">(</span><span class="n">helplist</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Make the helplist into a nice string&quot;&quot;&quot;</span>

            <span class="c1"># No helplist</span>
            <span class="k">if</span> <span class="n">helplist</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="k">pass</span>

            <span class="c1"># Only one helplist, print a nice string</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">helplist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">propID</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">dependency</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">datatype</span> <span class="o">=</span> <span class="n">helplist</span>
                <span class="k">if</span> <span class="n">dependency</span> <span class="o">==</span> <span class="s1">&#39;TP&#39;</span><span class="p">:</span>
                    <span class="n">dependency</span> <span class="o">=</span> <span class="s1">&#39;is dependent on T and P &#39;</span>
                <span class="k">elif</span> <span class="n">dependency</span> <span class="o">==</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span>
                    <span class="n">dependency</span> <span class="o">=</span> <span class="s1">&#39;is dependent on T &#39;</span>
                <span class="k">elif</span> <span class="n">dependency</span> <span class="o">==</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span>
                    <span class="n">dependency</span> <span class="o">=</span> <span class="s1">&#39;is dependent on P &#39;</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;{description.capitalize()}, </span><span class="si">{propID}</span><span class="s2">, </span><span class="si">{dependency}</span><span class="s2">with units, </span><span class="si">{units}</span><span class="s2">, and type, </span><span class="si">{datatype}</span><span class="s2">.&quot;</span><span class="p">)</span>

            <span class="c1"># Many helplists, print all the nice strings</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">helplist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">helplist</span><span class="p">:</span>
                    <span class="n">make_nice</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unknown error with &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">helplist</span><span class="p">))</span>

        <span class="n">make_nice</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_helplist</span><span class="p">(</span><span class="n">prop</span><span class="p">))</span></div>

<div class="viewcode-block" id="Stream.eqT"><a class="viewcode-back" href="../../Stream.html#biosteam.Stream.eqT">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">eqT</span><span class="p">(</span><span class="n">streams</span><span class="p">,</span> <span class="n">T_guess</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Q_in</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">approximate</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Bring all streams to temperature equilibrium.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            **streams:** [Stream] All streams</span>
<span class="sd">        </span>
<span class="sd">            **T_guess:** [float] Equilibrium temperature guess (K)</span>

<span class="sd">            **Q_in:** [float] Heat addition to streams (kJ/hr)     </span>
<span class="sd">            </span>
<span class="sd">            **approximate:** [bool] If True, approximate energy balance with constant heat capacity</span>

<span class="sd">        **Return**</span>

<span class="sd">             **T:** [float] New temperature (K)</span>

<span class="sd">        &gt;&gt;&gt; Stream.eqT((s1, s2, s3))</span>
<span class="sd">        &gt;&gt;&gt; (s1.T, s2.T, s3.T)</span>
<span class="sd">        (346.06735249999997,  346.06735249999997,  346.06735249999997)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Set up problem</span>
        <span class="n">C</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">C</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">streams</span><span class="p">)</span>
        <span class="n">H_</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">H</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">streams</span><span class="p">)</span> <span class="o">+</span> <span class="n">Q_in</span>
        
        <span class="c1"># Set initial temperature</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">T_guess</span><span class="p">:</span>
            <span class="n">T_guess</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">T</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">streams</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">streams</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">streams</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T_guess</span>
        
        <span class="c1"># Find new T</span>
        <span class="n">H</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">H</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">streams</span><span class="p">)</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">T_guess</span> <span class="o">+</span> <span class="p">(</span><span class="n">H_</span> <span class="o">-</span> <span class="n">H</span><span class="p">)</span><span class="o">/</span><span class="n">C</span>
        
        <span class="c1"># Update</span>
        <span class="n">T_guess</span> <span class="o">=</span> <span class="n">T</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">streams</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T_guess</span>
        <span class="k">if</span> <span class="n">approximate</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="c1"># Solve enthalpy by iteration</span>
        <span class="n">it</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="n">T_guess</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">:</span>
            <span class="c1"># Calculate</span>
            <span class="n">H_</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">H</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">streams</span><span class="p">)</span>
            <span class="n">C</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">C</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">streams</span><span class="p">)</span>
            <span class="n">T</span> <span class="o">=</span> <span class="n">T_guess</span> <span class="o">+</span> <span class="p">(</span><span class="n">H_</span><span class="o">-</span> <span class="n">H</span><span class="p">)</span><span class="o">/</span><span class="n">C</span>
            
            <span class="c1"># Check iteration</span>
            <span class="k">if</span> <span class="n">it</span> <span class="o">&gt;</span> <span class="mi">40</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SolverError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Could not solve temperature.&quot;</span><span class="p">)</span>
            
            <span class="c1"># Update</span>
            <span class="n">T_guess</span> <span class="o">=</span> <span class="n">T</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">streams</span><span class="p">:</span>
                <span class="n">s</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T_guess</span>
            <span class="n">it</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="Stream.sum"><a class="viewcode-back" href="../../Stream.html#biosteam.Stream.sum">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="n">s_sum</span><span class="p">,</span> <span class="n">streams</span><span class="p">,</span> <span class="n">approximate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Mixes streams and sets resulting mass and energy in &#39;s_sum&#39;. Assumes the same pressure as streams[0], and no phase equilibrium. If &#39;s_sum&#39; is a Stream object, it assumes the phase does not change.</span>

<span class="sd">        **Parameters** </span>

<span class="sd">             **s_sum:** [Stream] container for the resulting mixture of streams</span>

<span class="sd">             **streams:** [tuple] Stream objects to be mixed</span>

<span class="sd">             **approximate:** [bool] If True, approximate energy balance with constant heat capacity</span>

<span class="sd">        **Return**</span>

<span class="sd">             **s_sum:** same object as in arguments</span>

<span class="sd">        .. Note:: Ignores contents of s_sum as if it was empty</span>

<span class="sd">        Example</span>

<span class="sd">        &gt;&gt;&gt; s2.T = 340 # Set higher temperature to show energy balance</span>
<span class="sd">        &gt;&gt;&gt; s_sum = Stream.sum(Stream(&#39;s_sum&#39;), s1, s2)</span>
<span class="sd">        &gt;&gt;&gt; s_sum.show()</span>
<span class="sd">        Stream: s_sum</span>
<span class="sd">         phase: &#39;l&#39;, T: 325.32 K, P: 101325 Pa</span>
<span class="sd">         flow (kmol/hr): Ethanol  1</span>
<span class="sd">                         Water    4</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if energy balance is required</span>
        <span class="n">T_init</span> <span class="o">=</span> <span class="n">streams</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">Ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">T</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">streams</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span>
        <span class="n">energy_balance</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">T_init</span> <span class="o">!=</span> <span class="n">Ts</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">energy_balance</span><span class="p">:</span>
            <span class="n">H</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">H</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">streams</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s_sum</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T_init</span>

        <span class="c1"># Copy starting values</span>
        <span class="n">s_sum</span><span class="o">.</span><span class="n">copy_like</span><span class="p">(</span><span class="n">streams</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">streams</span> <span class="o">=</span> <span class="n">streams</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># Mass balance</span>
        <span class="n">MStream</span> <span class="o">=</span> <span class="n">mixed_stream</span><span class="o">.</span><span class="n">MixedStream</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s_sum</span><span class="p">,</span> <span class="n">MStream</span><span class="p">):</span>
            <span class="c1"># For MixedStream objects</span>
            <span class="n">phases_molflow</span> <span class="o">=</span> <span class="n">mixed_stream</span><span class="o">.</span><span class="n">phases_molflow</span>
            <span class="n">solid_mol</span> <span class="o">=</span> <span class="n">s_sum</span><span class="o">.</span><span class="n">solid_mol</span>
            <span class="n">liquid_mol</span> <span class="o">=</span> <span class="n">s_sum</span><span class="o">.</span><span class="n">liquid_mol</span>
            <span class="n">LIQUID_mol</span> <span class="o">=</span> <span class="n">s_sum</span><span class="o">.</span><span class="n">LIQUID_mol</span>
            <span class="n">vapor_mol</span> <span class="o">=</span> <span class="n">s_sum</span><span class="o">.</span><span class="n">vapor_mol</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">streams</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">MStream</span><span class="p">):</span>
                    <span class="n">solid_mol</span> <span class="o">+=</span> <span class="n">s</span><span class="o">.</span><span class="n">solid_mol</span>
                    <span class="n">liquid_mol</span> <span class="o">+=</span> <span class="n">s</span><span class="o">.</span><span class="n">liquid_mol</span>
                    <span class="n">LIQUID_mol</span> <span class="o">+=</span> <span class="n">s</span><span class="o">.</span><span class="n">LIQUID_mol</span>
                    <span class="n">vapor_mol</span> <span class="o">+=</span> <span class="n">s</span><span class="o">.</span><span class="n">vapor_mol</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">Stream</span><span class="p">):</span>
                    <span class="n">phase</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">phase</span>
                    <span class="n">attr</span> <span class="o">=</span> <span class="n">phases_molflow</span><span class="p">[</span><span class="n">phase</span><span class="p">]</span>
                    <span class="n">phase_mol</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">s_sum</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                    <span class="n">phase_mol</span> <span class="o">+=</span> <span class="n">s</span><span class="o">.</span><span class="n">mol</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s_sum</span><span class="p">,</span> <span class="n">Stream</span><span class="p">):</span>
            <span class="c1"># For Stream objects</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">streams</span><span class="p">:</span>
                <span class="n">s_sum</span><span class="o">.</span><span class="n">mol</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">s</span><span class="o">.</span><span class="n">mol</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Must pass a valid Stream object&#39;</span><span class="p">)</span>

        <span class="c1"># Energy Balance</span>
        <span class="k">if</span> <span class="n">energy_balance</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">approximate</span><span class="p">:</span>
                <span class="n">s_sum</span><span class="o">.</span><span class="n">T</span> <span class="o">+=</span> <span class="p">(</span><span class="n">H</span> <span class="o">-</span> <span class="n">s_sum</span><span class="o">.</span><span class="n">H</span><span class="p">)</span><span class="o">/</span><span class="n">s_sum</span><span class="o">.</span><span class="n">C</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s_sum</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="n">H</span>

        <span class="k">return</span> <span class="n">s_sum</span></div>

    <span class="c1"># MixedStream compatibility</span>
<div class="viewcode-block" id="Stream.enable_phases"><a class="viewcode-back" href="../../Stream.html#biosteam.Stream.enable_phases">[docs]</a>    <span class="k">def</span> <span class="nf">enable_phases</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Turn stream into a MixedStream object.&quot;&quot;&quot;</span>
        <span class="n">mS</span> <span class="o">=</span> <span class="n">mixed_stream</span><span class="o">.</span><span class="n">MixedStream</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">mS</span><span class="p">:</span>
            <span class="n">default_phase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="n">mS</span>
            <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_default_phase</span> <span class="o">=</span> <span class="n">default_phase</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mol</span></div>

<div class="viewcode-block" id="Stream.disable_phases"><a class="viewcode-back" href="../../Stream.html#biosteam.Stream.disable_phases">[docs]</a>    <span class="k">def</span> <span class="nf">disable_phases</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phase</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Turn stream into a Stream object.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Stream</span><span class="p">:</span>
            <span class="n">mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="n">Stream</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mol</span> <span class="o">=</span> <span class="n">mol</span></div>

    <span class="k">def</span> <span class="nf">VLE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">specie_IDs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">LNK</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">HNK</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">T</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">V</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Qin</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_phases</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">VLE</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">,</span> <span class="n">LNK</span><span class="p">,</span> <span class="n">HNK</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">Qin</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">LLE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">specie_IDs</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lNK</span><span class="o">=</span><span class="p">(),</span> <span class="n">LNK</span><span class="o">=</span><span class="p">(),</span>
            <span class="n">P</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Qin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">solvents</span><span class="o">=</span><span class="p">(),</span> <span class="n">solvent_split</span><span class="o">=</span><span class="p">()):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_phases</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LLE</span><span class="p">(</span><span class="n">specie_IDs</span><span class="p">,</span> <span class="n">split</span><span class="p">,</span> <span class="n">lNK</span><span class="p">,</span> <span class="n">LNK</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Qin</span><span class="p">,</span>
                 <span class="n">solvents</span><span class="p">,</span> <span class="n">solvent_split</span><span class="p">)</span>

    <span class="c1"># Representation</span>
    <span class="k">def</span> <span class="nf">_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">show_units</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return string with all specifications.&quot;&quot;&quot;</span>
        <span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span>
        <span class="n">T_units</span> <span class="o">=</span> <span class="n">show_units</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
        <span class="n">P_units</span> <span class="o">=</span> <span class="n">show_units</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">)</span>
        <span class="n">flow_units</span> <span class="o">=</span> <span class="n">show_units</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flow&#39;</span><span class="p">)</span>
        <span class="n">fraction</span> <span class="o">=</span> <span class="n">show_units</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fraction&#39;</span><span class="p">)</span>
        <span class="c1">#dim = CS.dim</span>
        
        <span class="c1"># First line</span>
        <span class="n">unit_ID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">unit_ID</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;  from  </span><span class="si">{unit_ID}</span><span class="s1">&#39;</span>
        <span class="n">unit_ID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sink</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">unit_ID</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sink</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sink</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;  to  </span><span class="si">{unit_ID}</span><span class="s1">&#39;</span>
        <span class="n">basic_info</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;{type(self).__name__}: </span><span class="si">{self.ID}{source}{sink}</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># Default units</span>
        <span class="n">show_format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_format</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">T_units</span><span class="p">:</span>
            <span class="n">T_units</span> <span class="o">=</span> <span class="n">show_format</span><span class="o">.</span><span class="n">T</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">P_units</span><span class="p">:</span>
            <span class="n">P_units</span> <span class="o">=</span> <span class="n">show_format</span><span class="o">.</span><span class="n">P</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">flow_units</span><span class="p">:</span>
            <span class="n">flow_units</span> <span class="o">=</span> <span class="n">show_format</span><span class="o">.</span><span class="n">flow</span>
        <span class="k">if</span> <span class="n">fraction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fraction</span> <span class="o">=</span> <span class="n">show_format</span><span class="o">.</span><span class="n">fraction</span>
        
        <span class="c1"># Second line (thermo)</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">units</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">T_units</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">,</span> <span class="n">units</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">P_units</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span>
        <span class="n">basic_info</span> <span class="o">+=</span> <span class="n">f</span><span class="s2">&quot; phase: &#39;</span><span class="si">{self.phase}</span><span class="s2">&#39;, T: </span><span class="si">{T:.5g}</span><span class="s2"> </span><span class="si">{T_units}</span><span class="s2">, P: </span><span class="si">{P:.6g}</span><span class="s2"> </span><span class="si">{P_units}</span><span class="se">\n</span><span class="s2">&quot;</span>
        
        <span class="c1"># Start of third line (flow rates)</span>
        <span class="n">flow_dim</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">flow_units</span><span class="p">)</span><span class="o">.</span><span class="n">dimensionality</span>
        <span class="k">if</span> <span class="n">fraction</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">flow_dim</span> <span class="o">==</span> <span class="n">mol_flow_dim</span><span class="p">:</span>
                <span class="n">flownet</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">molnet</span><span class="p">,</span> <span class="n">units</span><span class="p">[</span><span class="s1">&#39;molnet&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">flow_units</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span>
                <span class="n">flow</span> <span class="o">=</span> <span class="s1">&#39;molfrac&#39;</span>
            <span class="k">elif</span> <span class="n">flow_dim</span> <span class="o">==</span> <span class="n">mass_flow_dim</span><span class="p">:</span>
                <span class="n">flownet</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">massnet</span><span class="p">,</span> <span class="n">units</span><span class="p">[</span><span class="s1">&#39;massnet&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">flow_units</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span>
                <span class="n">flow</span> <span class="o">=</span> <span class="s1">&#39;massfrac&#39;</span>
            <span class="k">elif</span> <span class="n">flow_dim</span> <span class="o">==</span> <span class="n">vol_flow_dim</span><span class="p">:</span>
                <span class="n">flownet</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">volnet</span><span class="p">,</span> <span class="n">units</span><span class="p">[</span><span class="s1">&#39;volnet&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">flow_units</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span>
                <span class="n">flow</span> <span class="o">=</span> <span class="s1">&#39;volfrac&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DimensionError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Dimensions for flow units must be in molar, mass or volumetric flow rates, not &#39;</span><span class="si">{flow_dim}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
            <span class="n">beginning</span> <span class="o">=</span> <span class="s1">&#39; flow: &#39;</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">*</span><span class="si">{flownet:.3g}</span><span class="s1"> </span><span class="si">{flow_units}</span><span class="s1"> &#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">beginning</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39; flow (</span><span class="si">{flow_units}</span><span class="s1">): &#39;</span>
            <span class="n">end</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">flow_dim</span> <span class="o">==</span> <span class="n">mol_flow_dim</span><span class="p">:</span>
                <span class="n">flow</span> <span class="o">=</span> <span class="s1">&#39;mol&#39;</span>
            <span class="k">elif</span> <span class="n">flow_dim</span> <span class="o">==</span> <span class="n">mass_flow_dim</span><span class="p">:</span>
                <span class="n">flow</span> <span class="o">=</span> <span class="s1">&#39;mass&#39;</span>
            <span class="k">elif</span> <span class="n">flow_dim</span> <span class="o">==</span> <span class="n">vol_flow_dim</span><span class="p">:</span>
                <span class="n">flow</span> <span class="o">=</span> <span class="s1">&#39;vol&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DimensionError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Dimensions for flow units must be in molar, mass or volumetric flow rates, not &#39;</span><span class="si">{flow_dim}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
        <span class="c1"># Remaining lines (all flow rates)</span>
        <span class="n">new_line_spaces</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">beginning</span><span class="p">)</span> <span class="o">*</span> <span class="s1">&#39; &#39;</span>
        <span class="n">nonzero</span><span class="p">,</span> <span class="n">species</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nonzero_species</span>
        <span class="k">if</span> <span class="s1">&#39;frac&#39;</span> <span class="ow">in</span> <span class="n">flow</span><span class="p">:</span>
            <span class="n">flow</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">)[</span><span class="n">nonzero</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flow</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">)[</span><span class="n">nonzero</span><span class="p">],</span> <span class="n">units</span><span class="p">[</span><span class="n">flow</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">flow_units</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span>
        <span class="n">len_</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nonzero</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">len_</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">basic_info</span> <span class="o">+</span> <span class="s1">&#39; flows:  0&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flowrates</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">lengths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span> <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">species</span><span class="p">]</span>
            <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">len_</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">spaces</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxlen</span> <span class="o">-</span> <span class="n">lengths</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">flowrates</span> <span class="o">+=</span> <span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">spaces</span> <span class="o">+</span> \
                    <span class="n">f</span><span class="s1">&#39; </span><span class="si">{flow[i]:.3g}</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">new_line_spaces</span>
            <span class="n">spaces</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxlen</span> <span class="o">-</span> <span class="n">lengths</span><span class="p">[</span><span class="n">len_</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">flowrates</span> <span class="o">+=</span> <span class="n">species</span><span class="p">[</span><span class="n">len_</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">spaces</span> <span class="o">+</span> <span class="n">f</span><span class="s1">&#39; </span><span class="si">{flow[len_-1]:.3g}</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">basic_info</span> <span class="o">+</span> <span class="n">beginning</span> <span class="o">+</span> <span class="n">flowrates</span> <span class="o">+</span> <span class="n">end</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">new_line_spaces</span> <span class="o">+</span> <span class="s1">&#39;net&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="n">maxlen</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="s1">&#39;  &#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Stream.show"><a class="viewcode-back" href="../../Stream.html#biosteam.Stream.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">show_units</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print all specifications.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">(</span><span class="o">**</span><span class="n">show_units</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span></div>


<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">mixed_stream</span>


</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">BioSTEAM 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Yoel Cortes-Pena and Guest Group.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.4.
    </div>
  </body>
</html>