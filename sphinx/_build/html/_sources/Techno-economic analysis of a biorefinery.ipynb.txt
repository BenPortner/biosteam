{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Techno-economic analysis of a biorefinery"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Perform cash flow analysis"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Create a TEA object from a system:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "TEA: lipid_cane_system\n",
      " NPV: 2.18e+08 USD at 15.0% IRR\n",
      " ROI: 0.326 1/yr\n",
      " PBP: 2.55 yr\n"
     ]
    }
   ],
   "source": [
    "import biosteam as bst\n",
    "import lipidcane as lc\n",
    "\n",
    "lc.lipidcane_sys.simulate()\n",
    "lipidcane_tea = bst.TEA(lc.lipidcane_sys)\n",
    "lipidcane_tea.show() # Print TEA summary at current options"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "TEA objects have a long list of options for cash flow analysis:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "{'Lang factor': 3,\n",
       " 'Operating days': 330,\n",
       " 'IRR': 0.15,\n",
       " 'Wage': 50000.0,\n",
       " 'Year': None,\n",
       " 'Employees': 50,\n",
       " 'Fringe benefits': 0.4,\n",
       " 'Income tax': 0.35,\n",
       " 'Property tax': 0.001,\n",
       " 'Property insurance': 0.005,\n",
       " 'Duration': 20,\n",
       " 'Supplies': 0.2,\n",
       " 'Maintenance': 0.01,\n",
       " 'Administration': 0.005,\n",
       " 'Working capital': 0.05,\n",
       " 'Startup': 0,\n",
       " 'Land': 0,\n",
       " 'Royalties': 0,\n",
       " 'Contingency': 0.18,\n",
       " 'Depreciation': 'MACRS7',\n",
       " 'Startup schedule': (0.4, 0.6),\n",
       " 'Other recurring costs': 0,\n",
       " 'Other fixed capital': 0}"
      ]
     },
     "execution_count": 2,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "lipidcane_tea.options"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Update options and retrieve results from cash flow analysis:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Units</th>\n",
       "      <th>Value</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>Depreciable capital</th>\n",
       "      <td>USD</td>\n",
       "      <td>1.77e+08</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Fixed capital investment</th>\n",
       "      <td>USD</td>\n",
       "      <td>1.77e+08</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Working capital</th>\n",
       "      <td>USD</td>\n",
       "      <td>8.86e+06</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Total capital investment</th>\n",
       "      <td>USD</td>\n",
       "      <td>1.86e+08</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Depreciation</th>\n",
       "      <td>USD/yr</td>\n",
       "      <td>8.86e+06</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Utility cost</th>\n",
       "      <td>USD/yr</td>\n",
       "      <td>-1.85e+07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Material cost</th>\n",
       "      <td>USD/yr</td>\n",
       "      <td>6.2e+07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Sales</th>\n",
       "      <td>USD/yr</td>\n",
       "      <td>1.1e+08</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Labor</th>\n",
       "      <td>USD/yr</td>\n",
       "      <td>2.5e+06</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Annual operating cost</th>\n",
       "      <td>USD/yr</td>\n",
       "      <td>6e+07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Net present value</th>\n",
       "      <td>USD</td>\n",
       "      <td>3.95e+07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Return on investment</th>\n",
       "      <td>1/yr</td>\n",
       "      <td>0.175</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Pay back period</th>\n",
       "      <td>yr</td>\n",
       "      <td>4.29</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                           Units     Value\n",
       "Depreciable capital          USD  1.77e+08\n",
       "Fixed capital investment     USD  1.77e+08\n",
       "Working capital              USD  8.86e+06\n",
       "Total capital investment     USD  1.86e+08\n",
       "Depreciation              USD/yr  8.86e+06\n",
       "Utility cost              USD/yr -1.85e+07\n",
       "Material cost             USD/yr   6.2e+07\n",
       "Sales                     USD/yr   1.1e+08\n",
       "Labor                     USD/yr   2.5e+06\n",
       "Annual operating cost     USD/yr     6e+07\n",
       "Net present value            USD  3.95e+07\n",
       "Return on investment        1/yr     0.175\n",
       "Pay back period               yr      4.29"
      ]
     },
     "execution_count": 3,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "options = {'IRR': 0.175,\n",
    "           'Lang factor': 3.00,\n",
    "           'Operating days': 200,\n",
    "           'Year': 2020,\n",
    "           'Employees': 50,\n",
    "           'Administration': 0.005,\n",
    "           'Duration': 20}\n",
    "lipidcane_tea.options.update(options)\n",
    "lipidcane_tea.results()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Retrieve complete cashflow analysis as a DataFrame object:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Depreciable capital</th>\n",
       "      <th>Depreciation</th>\n",
       "      <th>Fixed capital</th>\n",
       "      <th>Working capital</th>\n",
       "      <th>Annual operating cost (excl. depr.)</th>\n",
       "      <th>Sales</th>\n",
       "      <th>Net earnings</th>\n",
       "      <th>Cash flow</th>\n",
       "      <th>Discounted cash flow</th>\n",
       "      <th>Cumulative cash flow</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2020</th>\n",
       "      <td>7.09e+07</td>\n",
       "      <td>0</td>\n",
       "      <td>7.09e+07</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>-7.09e+07</td>\n",
       "      <td>-7.09e+07</td>\n",
       "      <td>-7.09e+07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021</th>\n",
       "      <td>1.06e+08</td>\n",
       "      <td>0</td>\n",
       "      <td>1.06e+08</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>-1.06e+08</td>\n",
       "      <td>-9.05e+07</td>\n",
       "      <td>-1.61e+08</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022</th>\n",
       "      <td>0</td>\n",
       "      <td>2.53e+07</td>\n",
       "      <td>0</td>\n",
       "      <td>8.86e+06</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>2.18e+07</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>2.77e+07</td>\n",
       "      <td>-1.34e+08</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2023</th>\n",
       "      <td>0</td>\n",
       "      <td>4.34e+07</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>1e+07</td>\n",
       "      <td>5.34e+07</td>\n",
       "      <td>3.29e+07</td>\n",
       "      <td>-1.01e+08</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2024</th>\n",
       "      <td>0</td>\n",
       "      <td>3.1e+07</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>1.81e+07</td>\n",
       "      <td>4.91e+07</td>\n",
       "      <td>2.58e+07</td>\n",
       "      <td>-7.5e+07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2025</th>\n",
       "      <td>0</td>\n",
       "      <td>2.21e+07</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>2.39e+07</td>\n",
       "      <td>4.6e+07</td>\n",
       "      <td>2.05e+07</td>\n",
       "      <td>-5.44e+07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2026</th>\n",
       "      <td>0</td>\n",
       "      <td>1.58e+07</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>2.8e+07</td>\n",
       "      <td>4.38e+07</td>\n",
       "      <td>1.66e+07</td>\n",
       "      <td>-3.78e+07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2027</th>\n",
       "      <td>0</td>\n",
       "      <td>1.58e+07</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>2.8e+07</td>\n",
       "      <td>4.38e+07</td>\n",
       "      <td>1.42e+07</td>\n",
       "      <td>-2.36e+07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2028</th>\n",
       "      <td>0</td>\n",
       "      <td>1.58e+07</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>2.8e+07</td>\n",
       "      <td>4.38e+07</td>\n",
       "      <td>1.21e+07</td>\n",
       "      <td>-1.16e+07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2029</th>\n",
       "      <td>0</td>\n",
       "      <td>7.9e+06</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>3.31e+07</td>\n",
       "      <td>4.1e+07</td>\n",
       "      <td>9.61e+06</td>\n",
       "      <td>-1.96e+06</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2030</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>7.63e+06</td>\n",
       "      <td>5.67e+06</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2031</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>6.49e+06</td>\n",
       "      <td>1.22e+07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2032</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>5.52e+06</td>\n",
       "      <td>1.77e+07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2033</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>4.7e+06</td>\n",
       "      <td>2.24e+07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2034</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>4e+06</td>\n",
       "      <td>2.64e+07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2035</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>3.41e+06</td>\n",
       "      <td>2.98e+07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2036</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>2.9e+06</td>\n",
       "      <td>3.27e+07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2037</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>2.47e+06</td>\n",
       "      <td>3.52e+07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2038</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>2.1e+06</td>\n",
       "      <td>3.73e+07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2039</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>-8.86e+06</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>4.71e+07</td>\n",
       "      <td>2.2e+06</td>\n",
       "      <td>3.95e+07</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "      Depreciable capital  Depreciation  Fixed capital  Working capital  \\\n",
       "2020             7.09e+07             0       7.09e+07                0   \n",
       "2021             1.06e+08             0       1.06e+08                0   \n",
       "2022                    0      2.53e+07              0         8.86e+06   \n",
       "2023                    0      4.34e+07              0                0   \n",
       "2024                    0       3.1e+07              0                0   \n",
       "2025                    0      2.21e+07              0                0   \n",
       "2026                    0      1.58e+07              0                0   \n",
       "2027                    0      1.58e+07              0                0   \n",
       "2028                    0      1.58e+07              0                0   \n",
       "2029                    0       7.9e+06              0                0   \n",
       "2030                    0             0              0                0   \n",
       "2031                    0             0              0                0   \n",
       "2032                    0             0              0                0   \n",
       "2033                    0             0              0                0   \n",
       "2034                    0             0              0                0   \n",
       "2035                    0             0              0                0   \n",
       "2036                    0             0              0                0   \n",
       "2037                    0             0              0                0   \n",
       "2038                    0             0              0                0   \n",
       "2039                    0             0              0        -8.86e+06   \n",
       "\n",
       "      Annual operating cost (excl. depr.)   Sales  Net earnings  Cash flow  \\\n",
       "2020                                   0        0             0  -7.09e+07   \n",
       "2021                                   0        0             0  -1.06e+08   \n",
       "2022                            5.12e+07  1.1e+08      2.18e+07   3.83e+07   \n",
       "2023                            5.12e+07  1.1e+08         1e+07   5.34e+07   \n",
       "2024                            5.12e+07  1.1e+08      1.81e+07   4.91e+07   \n",
       "2025                            5.12e+07  1.1e+08      2.39e+07    4.6e+07   \n",
       "2026                            5.12e+07  1.1e+08       2.8e+07   4.38e+07   \n",
       "2027                            5.12e+07  1.1e+08       2.8e+07   4.38e+07   \n",
       "2028                            5.12e+07  1.1e+08       2.8e+07   4.38e+07   \n",
       "2029                            5.12e+07  1.1e+08      3.31e+07    4.1e+07   \n",
       "2030                            5.12e+07  1.1e+08      3.83e+07   3.83e+07   \n",
       "2031                            5.12e+07  1.1e+08      3.83e+07   3.83e+07   \n",
       "2032                            5.12e+07  1.1e+08      3.83e+07   3.83e+07   \n",
       "2033                            5.12e+07  1.1e+08      3.83e+07   3.83e+07   \n",
       "2034                            5.12e+07  1.1e+08      3.83e+07   3.83e+07   \n",
       "2035                            5.12e+07  1.1e+08      3.83e+07   3.83e+07   \n",
       "2036                            5.12e+07  1.1e+08      3.83e+07   3.83e+07   \n",
       "2037                            5.12e+07  1.1e+08      3.83e+07   3.83e+07   \n",
       "2038                            5.12e+07  1.1e+08      3.83e+07   3.83e+07   \n",
       "2039                            5.12e+07  1.1e+08      3.83e+07   4.71e+07   \n",
       "\n",
       "      Discounted cash flow  Cumulative cash flow  \n",
       "2020             -7.09e+07             -7.09e+07  \n",
       "2021             -9.05e+07             -1.61e+08  \n",
       "2022              2.77e+07             -1.34e+08  \n",
       "2023              3.29e+07             -1.01e+08  \n",
       "2024              2.58e+07              -7.5e+07  \n",
       "2025              2.05e+07             -5.44e+07  \n",
       "2026              1.66e+07             -3.78e+07  \n",
       "2027              1.42e+07             -2.36e+07  \n",
       "2028              1.21e+07             -1.16e+07  \n",
       "2029              9.61e+06             -1.96e+06  \n",
       "2030              7.63e+06              5.67e+06  \n",
       "2031              6.49e+06              1.22e+07  \n",
       "2032              5.52e+06              1.77e+07  \n",
       "2033               4.7e+06              2.24e+07  \n",
       "2034                 4e+06              2.64e+07  \n",
       "2035              3.41e+06              2.98e+07  \n",
       "2036               2.9e+06              3.27e+07  \n",
       "2037              2.47e+06              3.52e+07  \n",
       "2038               2.1e+06              3.73e+07  \n",
       "2039               2.2e+06              3.95e+07  "
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "lipidcane_tea.get_cashflow()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Find production cost, price, and IRR"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Find production cost:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([25128633.021, 34902818.506])"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "lipidcane_tea.production_cost(bst.find('Ethanol'), bst.find('Biodiesel'))# USD/yr"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Solve for the price of a stream at the break even point:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.04280288947446607"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "feed = bst.find('Lipid cane')\n",
    "lipidcane_tea.solve_price(feed) # USD/kg"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Solve for the IRR at the break even point:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "TEA: lipid_cane_system\n",
      " NPV: 11 USD at 22.2% IRR\n",
      " ROI: 0.175 1/yr\n",
      " PBP: 4.29 yr\n"
     ]
    }
   ],
   "source": [
    "lipidcane_tea.options['IRR'] = lipidcane_tea.solve_IRR()\n",
    "lipidcane_tea.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Note that the cashflow table is always created up to date:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Depreciable capital</th>\n",
       "      <th>Depreciation</th>\n",
       "      <th>Fixed capital</th>\n",
       "      <th>Working capital</th>\n",
       "      <th>Annual operating cost (excl. depr.)</th>\n",
       "      <th>Sales</th>\n",
       "      <th>Net earnings</th>\n",
       "      <th>Cash flow</th>\n",
       "      <th>Discounted cash flow</th>\n",
       "      <th>Cumulative cash flow</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2020</th>\n",
       "      <td>7.09e+07</td>\n",
       "      <td>0</td>\n",
       "      <td>7.09e+07</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>-7.09e+07</td>\n",
       "      <td>-7.09e+07</td>\n",
       "      <td>-7.09e+07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2021</th>\n",
       "      <td>1.06e+08</td>\n",
       "      <td>0</td>\n",
       "      <td>1.06e+08</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>-1.06e+08</td>\n",
       "      <td>-8.7e+07</td>\n",
       "      <td>-1.58e+08</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2022</th>\n",
       "      <td>0</td>\n",
       "      <td>2.53e+07</td>\n",
       "      <td>0</td>\n",
       "      <td>8.86e+06</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>2.18e+07</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>2.56e+07</td>\n",
       "      <td>-1.32e+08</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2023</th>\n",
       "      <td>0</td>\n",
       "      <td>4.34e+07</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>1e+07</td>\n",
       "      <td>5.34e+07</td>\n",
       "      <td>2.93e+07</td>\n",
       "      <td>-1.03e+08</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2024</th>\n",
       "      <td>0</td>\n",
       "      <td>3.1e+07</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>1.81e+07</td>\n",
       "      <td>4.91e+07</td>\n",
       "      <td>2.2e+07</td>\n",
       "      <td>-8.1e+07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2025</th>\n",
       "      <td>0</td>\n",
       "      <td>2.21e+07</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>2.39e+07</td>\n",
       "      <td>4.6e+07</td>\n",
       "      <td>1.69e+07</td>\n",
       "      <td>-6.41e+07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2026</th>\n",
       "      <td>0</td>\n",
       "      <td>1.58e+07</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>2.8e+07</td>\n",
       "      <td>4.38e+07</td>\n",
       "      <td>1.31e+07</td>\n",
       "      <td>-5.1e+07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2027</th>\n",
       "      <td>0</td>\n",
       "      <td>1.58e+07</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>2.8e+07</td>\n",
       "      <td>4.38e+07</td>\n",
       "      <td>1.08e+07</td>\n",
       "      <td>-4.02e+07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2028</th>\n",
       "      <td>0</td>\n",
       "      <td>1.58e+07</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>2.8e+07</td>\n",
       "      <td>4.38e+07</td>\n",
       "      <td>8.8e+06</td>\n",
       "      <td>-3.14e+07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2029</th>\n",
       "      <td>0</td>\n",
       "      <td>7.9e+06</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>3.31e+07</td>\n",
       "      <td>4.1e+07</td>\n",
       "      <td>6.74e+06</td>\n",
       "      <td>-2.47e+07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2030</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>5.14e+06</td>\n",
       "      <td>-1.95e+07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2031</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>4.21e+06</td>\n",
       "      <td>-1.53e+07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2032</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>3.44e+06</td>\n",
       "      <td>-1.19e+07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2033</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>2.82e+06</td>\n",
       "      <td>-9.07e+06</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2034</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>2.31e+06</td>\n",
       "      <td>-6.77e+06</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2035</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>1.89e+06</td>\n",
       "      <td>-4.88e+06</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2036</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>1.54e+06</td>\n",
       "      <td>-3.34e+06</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2037</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>1.26e+06</td>\n",
       "      <td>-2.08e+06</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2038</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>1.03e+06</td>\n",
       "      <td>-1.04e+06</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2039</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>-8.86e+06</td>\n",
       "      <td>5.12e+07</td>\n",
       "      <td>1.1e+08</td>\n",
       "      <td>3.83e+07</td>\n",
       "      <td>4.71e+07</td>\n",
       "      <td>1.04e+06</td>\n",
       "      <td>11</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "      Depreciable capital  Depreciation  Fixed capital  Working capital  \\\n",
       "2020             7.09e+07             0       7.09e+07                0   \n",
       "2021             1.06e+08             0       1.06e+08                0   \n",
       "2022                    0      2.53e+07              0         8.86e+06   \n",
       "2023                    0      4.34e+07              0                0   \n",
       "2024                    0       3.1e+07              0                0   \n",
       "2025                    0      2.21e+07              0                0   \n",
       "2026                    0      1.58e+07              0                0   \n",
       "2027                    0      1.58e+07              0                0   \n",
       "2028                    0      1.58e+07              0                0   \n",
       "2029                    0       7.9e+06              0                0   \n",
       "2030                    0             0              0                0   \n",
       "2031                    0             0              0                0   \n",
       "2032                    0             0              0                0   \n",
       "2033                    0             0              0                0   \n",
       "2034                    0             0              0                0   \n",
       "2035                    0             0              0                0   \n",
       "2036                    0             0              0                0   \n",
       "2037                    0             0              0                0   \n",
       "2038                    0             0              0                0   \n",
       "2039                    0             0              0        -8.86e+06   \n",
       "\n",
       "      Annual operating cost (excl. depr.)   Sales  Net earnings  Cash flow  \\\n",
       "2020                                   0        0             0  -7.09e+07   \n",
       "2021                                   0        0             0  -1.06e+08   \n",
       "2022                            5.12e+07  1.1e+08      2.18e+07   3.83e+07   \n",
       "2023                            5.12e+07  1.1e+08         1e+07   5.34e+07   \n",
       "2024                            5.12e+07  1.1e+08      1.81e+07   4.91e+07   \n",
       "2025                            5.12e+07  1.1e+08      2.39e+07    4.6e+07   \n",
       "2026                            5.12e+07  1.1e+08       2.8e+07   4.38e+07   \n",
       "2027                            5.12e+07  1.1e+08       2.8e+07   4.38e+07   \n",
       "2028                            5.12e+07  1.1e+08       2.8e+07   4.38e+07   \n",
       "2029                            5.12e+07  1.1e+08      3.31e+07    4.1e+07   \n",
       "2030                            5.12e+07  1.1e+08      3.83e+07   3.83e+07   \n",
       "2031                            5.12e+07  1.1e+08      3.83e+07   3.83e+07   \n",
       "2032                            5.12e+07  1.1e+08      3.83e+07   3.83e+07   \n",
       "2033                            5.12e+07  1.1e+08      3.83e+07   3.83e+07   \n",
       "2034                            5.12e+07  1.1e+08      3.83e+07   3.83e+07   \n",
       "2035                            5.12e+07  1.1e+08      3.83e+07   3.83e+07   \n",
       "2036                            5.12e+07  1.1e+08      3.83e+07   3.83e+07   \n",
       "2037                            5.12e+07  1.1e+08      3.83e+07   3.83e+07   \n",
       "2038                            5.12e+07  1.1e+08      3.83e+07   3.83e+07   \n",
       "2039                            5.12e+07  1.1e+08      3.83e+07   4.71e+07   \n",
       "\n",
       "      Discounted cash flow  Cumulative cash flow  \n",
       "2020             -7.09e+07             -7.09e+07  \n",
       "2021              -8.7e+07             -1.58e+08  \n",
       "2022              2.56e+07             -1.32e+08  \n",
       "2023              2.93e+07             -1.03e+08  \n",
       "2024               2.2e+07              -8.1e+07  \n",
       "2025              1.69e+07             -6.41e+07  \n",
       "2026              1.31e+07              -5.1e+07  \n",
       "2027              1.08e+07             -4.02e+07  \n",
       "2028               8.8e+06             -3.14e+07  \n",
       "2029              6.74e+06             -2.47e+07  \n",
       "2030              5.14e+06             -1.95e+07  \n",
       "2031              4.21e+06             -1.53e+07  \n",
       "2032              3.44e+06             -1.19e+07  \n",
       "2033              2.82e+06             -9.07e+06  \n",
       "2034              2.31e+06             -6.77e+06  \n",
       "2035              1.89e+06             -4.88e+06  \n",
       "2036              1.54e+06             -3.34e+06  \n",
       "2037              1.26e+06             -2.08e+06  \n",
       "2038              1.03e+06             -1.04e+06  \n",
       "2039              1.04e+06                    11  "
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "lipidcane_tea.get_cashflow()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### System report"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Save stream tables, utility requirements, itemized costs, TEA results, and a cash flow table:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [],
   "source": [
    "lc.lipidcane_sys.save_report('Lipidcane report.xlsx') # Try this on your computer and open excel"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.6.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
