

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>biosteam.units._distillation &mdash; BioSTEAM 0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> BioSTEAM
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Installation.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/Getting started.html">3. Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/Creating a Unit.html">4. Creating a Unit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/Managing flowsheets.html">5. Managing flowsheets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/Using -pipe- notation.html">6. Using -pipe- notation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/Unit operation results.html">7. Unit operation results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/Biorefineries.html">8. Bioferineries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/Techno-economic analysis.html">9. Techno-economic analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/Inheriting from Unit.html">10. Inheriting from Unit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/Unit decorators.html">11. Unit decorators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/Monte Carlo.html">12. Monte Carlo</a></li>
</ul>
<p class="caption"><span class="caption-text">BioSTEAM API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Unit.html">Unit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../PowerUtility.html">PowerUtility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../HeatUtility.html">HeatUtility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../System.html">System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../TEA.html">TEA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../CombinedTEA.html">CombinedTEA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Flowsheet.html">find</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../units/units.html">units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../evaluation/evaluation.html">evaluation</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer's guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../developer's guide/Contributing to BioSTEAM.html">Contributing to BioSTEAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer's guide/Code of conduct.html">Code of conduct</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">BioSTEAM</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>biosteam.units._distillation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for biosteam.units._distillation</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Thu Aug 23 19:33:20 2018</span>

<span class="sd">@author: yoelr</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">ceil</span>
<span class="kn">import</span> <span class="nn">thermosteam</span> <span class="k">as</span> <span class="nn">tmo</span>
<span class="kn">from</span> <span class="nn">.design_tools.specification_factors</span> <span class="kn">import</span>  <span class="p">(</span>
    <span class="n">distillation_column_material_factors</span><span class="p">,</span>
    <span class="n">tray_material_factor_functions</span><span class="p">,</span>
    <span class="n">distillation_tray_type_factor</span><span class="p">,</span>
    <span class="n">material_densities_lb_per_in3</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">.design_tools.column_design</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">compute_tower_height</span><span class="p">,</span>
    <span class="n">compute_tower_diameter</span><span class="p">,</span>
    <span class="n">compute_tower_weight</span><span class="p">,</span>
    <span class="n">compute_tower_wall_thickness</span><span class="p">,</span>
    <span class="n">compute_flow_parameter</span><span class="p">,</span>
    <span class="n">compute_max_vapor_velocity</span><span class="p">,</span>
    <span class="n">compute_max_capacity_parameter</span><span class="p">,</span>
    <span class="n">compute_downcomer_area_fraction</span><span class="p">,</span>
    <span class="n">compute_murphree_stage_efficiency</span><span class="p">,</span>
    <span class="n">compute_purchase_cost_of_trays</span><span class="p">,</span>
    <span class="n">compute_purchase_cost_of_tower</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">Unit</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">brentq</span>
<span class="kn">from</span> <span class="nn">._hx</span> <span class="kn">import</span> <span class="n">HXutility</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Distillation&#39;</span><span class="p">,)</span>

<span class="k">def</span> <span class="nf">compute_stages_McCabeThiele</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">operating_line</span><span class="p">,</span>
                                <span class="n">x_stages</span><span class="p">,</span> <span class="n">y_stages</span><span class="p">,</span> <span class="n">T_stages</span><span class="p">,</span>
                                <span class="n">x_limit</span><span class="p">,</span> <span class="n">solve_Ty</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the specifications at every stage of the of the operating line before</span>
<span class="sd">    the maximum liquid molar fraction. Append the light key liquid molar</span>
<span class="sd">    fraction, light key vapor molar fraction, and stage temperatures to</span>
<span class="sd">    x_stages, y_stages and T_stages respectively.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    P : float</span>
<span class="sd">        Pressure [Pa].</span>
<span class="sd">    operating_line : function</span>
<span class="sd">                     Should return the liquid molar fraction of the light</span>
<span class="sd">                     key given its vapor molar fraction.</span>
<span class="sd">    x_stages : list</span>
<span class="sd">               Liquid molar compositions at each stage. Last element</span>
<span class="sd">               should be the starting point for the next stage.</span>
<span class="sd">    y_stages : list</span>
<span class="sd">               Vapor molar compositions at each stage. Last element </span>
<span class="sd">               should be the starting point for the next stage.</span>
<span class="sd">    x_limit : float</span>
<span class="sd">              Maximum value of liquid composition before algorithm stops.</span>
<span class="sd">    T_stages : list</span>
<span class="sd">               Temperature at each stage.</span>
<span class="sd">    solve_Ty : function</span>
<span class="sd">               Should return T and y given x.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">yi</span> <span class="o">=</span> <span class="n">y_stages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">x_stages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">while</span> <span class="n">xi</span> <span class="o">&lt;</span> <span class="n">x_limit</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;cannot meet specifications! stages &gt; 100&#39;</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># Go Up</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">xi</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">xi</span><span class="p">))</span>
        <span class="n">T</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">solve_Ty</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>
        <span class="n">yi</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y_stages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yi</span><span class="p">)</span>
        <span class="n">T_stages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
        <span class="c1"># Go Right</span>
        <span class="n">xi</span> <span class="o">=</span> <span class="n">operating_line</span><span class="p">(</span><span class="n">yi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xi</span> <span class="o">&gt;</span> <span class="n">x_limit</span><span class="p">:</span>
            <span class="n">xi</span> <span class="o">=</span> <span class="n">x_limit</span>
        <span class="n">x_stages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>

<span class="c1"># %% Distillation</span>

<div class="viewcode-block" id="Distillation"><a class="viewcode-back" href="../../../units/Distillation.html#biosteam.units.Distillation">[docs]</a><span class="k">class</span> <span class="nc">Distillation</span><span class="p">(</span><span class="n">Unit</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a Distillation column that assumes all light and heavy non keys</span>
<span class="sd">    separate to the top and bottoms product respectively. McCabe-Thiele</span>
<span class="sd">    analysis is used to find both the number of stages and the reflux ratio</span>
<span class="sd">    given a ratio of actual reflux to minimum reflux [1]_. This assumption</span>
<span class="sd">    is good for both binary distillation of highly polar compounds and</span>
<span class="sd">    ternary distillation assuming complete separation of light non-keys</span>
<span class="sd">    and heavy non-keys with large differences in boiling points. Preliminary</span>
<span class="sd">    analysis showed that the theoretical number of stages using this method</span>
<span class="sd">    on Methanol/Glycerol/Water systems is off by less than +-1 stage. Other</span>
<span class="sd">    methods, such as the Fenske-Underwood-Gilliland method, are more suitable</span>
<span class="sd">    for hydrocarbons. The Murphree efficiency is based on the modified</span>
<span class="sd">    O&#39;Connell correlation [2]_. The diameter is based on tray separation</span>
<span class="sd">    and flooding velocity [1, 3]_. Purchase costs are based on correlations</span>
<span class="sd">    compiled by Warren et. al. [5]_.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ins : streams</span>
<span class="sd">        Inlet fluids to be mixed into the feed stage.</span>
<span class="sd">    outs : stream sequence</span>
<span class="sd">        * [0] Distillate</span>
<span class="sd">        * [1] Bottoms product</span>
<span class="sd">    LHK : tuple[str]</span>
<span class="sd">        Light and heavy keys.</span>
<span class="sd">    y_top : float</span>
<span class="sd">        Molar fraction of light key in the distillate.</span>
<span class="sd">    x_bot : float</span>
<span class="sd">        Molar fraction of light key in the bottoms.</span>
<span class="sd">    k : float</span>
<span class="sd">        Ratio of reflux to minimum reflux.</span>
<span class="sd">    P=101325 : float</span>
<span class="sd">        Operating pressure [Pa].</span>
<span class="sd">    vessel_material : str, optional</span>
<span class="sd">        Vessel construction material. Defaults to &#39;Carbon steel&#39;.</span>
<span class="sd">    tray_material : str, optional</span>
<span class="sd">        Tray construction material. Defaults to &#39;Carbon steel&#39;.</span>
<span class="sd">    tray_type=&#39;Sieve&#39; : &#39;Sieve&#39;, &#39;Valve&#39;, or &#39;Bubble cap&#39;</span>
<span class="sd">        Tray type.</span>
<span class="sd">    tray_spacing=450 : float</span>
<span class="sd">        Typically between 152 to 915 mm.</span>
<span class="sd">    stage_efficiency=None : </span>
<span class="sd">        User enforced stage efficiency. If None, stage efficiency is</span>
<span class="sd">        calculated by the O&#39;Connell correlation [2]_.</span>
<span class="sd">    velocity_fraction=0.8 : float</span>
<span class="sd">        Fraction of actual velocity to maximum velocity allowable before flooding.</span>
<span class="sd">    foaming_factor=1.0 : float</span>
<span class="sd">        Must be between 0 to 1.</span>
<span class="sd">    open_tray_area_fraction=0.1 : float</span>
<span class="sd">        Fraction of open area to active area of a tray.</span>
<span class="sd">    downcomer_area_fraction=None : float</span>
<span class="sd">        Enforced fraction of downcomer area to net (total) area of a tray.</span>
<span class="sd">        If None, estimate ratio based on Oliver&#39;s estimation [1]_.</span>
<span class="sd">    is_divided=False : bool</span>
<span class="sd">        True if the stripper and rectifier are two separate columns.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] J.D. Seader, E.J. Henley, D.K. Roper. (2011)</span>
<span class="sd">        Separation Process Principles 3rd Edition. John Wiley &amp; Sons, Inc. </span>

<span class="sd">    .. [2] M. Duss, R. Taylor. (2018)</span>
<span class="sd">        Predict Distillation Tray Efficiency. AICHE </span>
<span class="sd">    </span>
<span class="sd">    .. [3] Green, D. W. Distillation. In Perry’s Chemical Engineers’</span>
<span class="sd">        674 Handbook, 9 ed.; McGraw-Hill Education, 2018.</span>

<span class="sd">    .. [4] Mulet, A., A.B. Corripio, and L.B.Evans. (1981b).</span>
<span class="sd">        Estimate Costs of Distillation and Absorption Towers via Correlations.</span>
<span class="sd">        Chem. Eng., 88(26), 77–82.</span>

<span class="sd">    .. [5] Seider, W. D., Lewin,  D. R., Seader, J. D., Widagdo, S., Gani, R.,</span>
<span class="sd">        &amp; Ng, M. K. (2017). Product and Process Design Principles. Wiley.</span>
<span class="sd">        Cost Accounting and Capital Cost Estimation (Chapter 16)</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Binary distillation assuming 100% separation on non-keys:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from biosteam.units import Distillation</span>
<span class="sd">    &gt;&gt;&gt; from thermosteam import Stream, Chemicals, settings</span>
<span class="sd">    &gt;&gt;&gt; chemicals = Chemicals([&#39;Water&#39;, &#39;Methanol&#39;, &#39;Glycerol&#39;])</span>
<span class="sd">    &gt;&gt;&gt; settings.set_thermo(chemicals)</span>
<span class="sd">    &gt;&gt;&gt; feed = Stream(&#39;feed&#39;, flow=(80, 100, 25))</span>
<span class="sd">    &gt;&gt;&gt; bp = feed.bubble_point_at_P()</span>
<span class="sd">    &gt;&gt;&gt; feed.T = bp.T # Feed at bubble point T</span>
<span class="sd">    &gt;&gt;&gt; D1 = Distillation(&#39;D1&#39;, ins=feed,</span>
<span class="sd">    ...                   outs=(&#39;distillate&#39;, &#39;bottoms_product&#39;),</span>
<span class="sd">    ...                   LHK=(&#39;Methanol&#39;, &#39;Water&#39;),</span>
<span class="sd">    ...                   y_top=0.99, x_bot=0.01, k=2,</span>
<span class="sd">    ...                   is_divided=True)</span>
<span class="sd">    &gt;&gt;&gt; D1.simulate()</span>
<span class="sd">    &gt;&gt;&gt; # See all results</span>
<span class="sd">    &gt;&gt;&gt; D1.show(T=&#39;degC&#39;, P=&#39;atm&#39;, composition=True)</span>
<span class="sd">    Distillation: D1</span>
<span class="sd">    ins...</span>
<span class="sd">    [0] feed</span>
<span class="sd">        phase: &#39;l&#39;, T: 76.129 degC, P: 1 atm</span>
<span class="sd">        composition: Water     0.39</span>
<span class="sd">                     Methanol  0.488</span>
<span class="sd">                     Glycerol  0.122</span>
<span class="sd">                     --------  205 kmol/hr</span>
<span class="sd">    outs...</span>
<span class="sd">    [0] distillate</span>
<span class="sd">        phase: &#39;g&#39;, T: 64.91 degC, P: 1 atm</span>
<span class="sd">        composition: Water     0.01</span>
<span class="sd">                     Methanol  0.99</span>
<span class="sd">                     --------  100 kmol/hr</span>
<span class="sd">    [1] bottoms_product</span>
<span class="sd">        phase: &#39;l&#39;, T: 100.06 degC, P: 1 atm</span>
<span class="sd">        composition: Water     0.754</span>
<span class="sd">                     Methanol  0.00761</span>
<span class="sd">                     Glycerol  0.239</span>
<span class="sd">                     --------  105 kmol/hr</span>
<span class="sd">    &gt;&gt;&gt; D1.results()</span>
<span class="sd">    Distillation                                    Units        D1</span>
<span class="sd">    Cooling water       Duty                        kJ/hr -5.11e+06</span>
<span class="sd">                        Flow                      kmol/hr  3.49e+03</span>
<span class="sd">                        Cost                       USD/hr      1.71</span>
<span class="sd">    Low pressure steam  Duty                        kJ/hr  9.49e+06</span>
<span class="sd">                        Flow                      kmol/hr       244</span>
<span class="sd">                        Cost                       USD/hr      58.1</span>
<span class="sd">    Design              Theoretical feed stage                    9</span>
<span class="sd">                        Theoretical stages                       13</span>
<span class="sd">                        Minimum reflux              Ratio     0.687</span>
<span class="sd">                        Reflux                      Ratio      1.37</span>
<span class="sd">                        Rectifier stages                         15</span>
<span class="sd">                        Stripper stages                          13</span>
<span class="sd">                        Rectifier height               ft      34.7</span>
<span class="sd">                        Stripper height                ft      31.7</span>
<span class="sd">                        Rectifier diameter             ft      3.93</span>
<span class="sd">                        Stripper diameter              ft      3.36</span>
<span class="sd">                        Rectifier wall thickness       in      0.25</span>
<span class="sd">                        Stripper wall thickness        in      0.25</span>
<span class="sd">                        Rectifier weight               lb  4.79e+03</span>
<span class="sd">                        Stripper weight                lb  3.74e+03</span>
<span class="sd">    Purchase cost       Rectifier trays               USD   1.5e+04</span>
<span class="sd">                        Stripper trays                USD  1.28e+04</span>
<span class="sd">                        Rectifier tower               USD  7.62e+04</span>
<span class="sd">                        Stripper tower                USD  6.53e+04</span>
<span class="sd">                        Condenser                     USD  2.02e+04</span>
<span class="sd">                        Boiler                        USD  4.27e+03</span>
<span class="sd">    Total purchase cost                               USD  1.94e+05</span>
<span class="sd">    Utility cost                                   USD/hr      59.8</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;Distillation&#39;</span>
    <span class="n">_N_heat_utilities</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_units</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Minimum reflux&#39;</span><span class="p">:</span> <span class="s1">&#39;Ratio&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Reflux&#39;</span><span class="p">:</span> <span class="s1">&#39;Ratio&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Rectifier height&#39;</span><span class="p">:</span> <span class="s1">&#39;ft&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Rectifier diameter&#39;</span><span class="p">:</span> <span class="s1">&#39;ft&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Rectifier wall thickness&#39;</span><span class="p">:</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Rectifier weight&#39;</span><span class="p">:</span> <span class="s1">&#39;lb&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Stripper height&#39;</span><span class="p">:</span> <span class="s1">&#39;ft&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Stripper diameter&#39;</span><span class="p">:</span> <span class="s1">&#39;ft&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Stripper wall thickness&#39;</span><span class="p">:</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Stripper weight&#39;</span><span class="p">:</span> <span class="s1">&#39;lb&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Height&#39;</span><span class="p">:</span> <span class="s1">&#39;ft&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Diameter&#39;</span><span class="p">:</span> <span class="s1">&#39;ft&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Wall thickness&#39;</span><span class="p">:</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Weight&#39;</span><span class="p">:</span> <span class="s1">&#39;lb&#39;</span><span class="p">}</span>
    <span class="c1"># Bare module factor</span>
    <span class="n">BM</span> <span class="o">=</span> <span class="mf">4.3</span>
    
    <span class="c1"># [dict] Bounds for results</span>
    <span class="n">_bounds</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Diameter&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">24.</span><span class="p">),</span>
               <span class="s1">&#39;Height&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">27.</span><span class="p">,</span> <span class="mf">170.</span><span class="p">),</span>
               <span class="s1">&#39;Weight&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">9000.</span><span class="p">,</span> <span class="mf">2.5e6</span><span class="p">)}</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ID</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outs</span><span class="o">=</span><span class="p">(),</span> <span class="n">thermo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">P</span><span class="o">=</span><span class="mi">101325</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">LHK</span><span class="p">,</span> <span class="n">y_top</span><span class="p">,</span> <span class="n">x_bot</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span>
                <span class="n">vessel_material</span><span class="o">=</span><span class="s1">&#39;Carbon steel&#39;</span><span class="p">,</span>
                <span class="n">tray_material</span><span class="o">=</span><span class="s1">&#39;Carbon steel&#39;</span><span class="p">,</span>
                <span class="n">tray_type</span><span class="o">=</span><span class="s1">&#39;Sieve&#39;</span><span class="p">,</span>
                <span class="n">tray_spacing</span><span class="o">=</span><span class="mi">450</span><span class="p">,</span>
                <span class="n">stage_efficiency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">velocity_fraction</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                <span class="n">foaming_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="n">open_tray_area_fraction</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                <span class="n">downcomer_area_fraction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">is_divided</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">Unit</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ID</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">outs</span><span class="p">,</span> <span class="n">thermo</span><span class="p">)</span>
        
        <span class="c1"># Operation specifications</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">P</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LHK</span> <span class="o">=</span> <span class="n">LHK</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_top</span> <span class="o">=</span> <span class="n">y_top</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_bot</span> <span class="o">=</span> <span class="n">x_bot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        
        <span class="c1"># Construction specifications</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vessel_material</span> <span class="o">=</span> <span class="n">vessel_material</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tray_type</span> <span class="o">=</span> <span class="n">tray_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tray_material</span> <span class="o">=</span> <span class="n">tray_material</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tray_spacing</span> <span class="o">=</span> <span class="n">tray_spacing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage_efficiency</span> <span class="o">=</span> <span class="n">stage_efficiency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">velocity_fraction</span> <span class="o">=</span> <span class="n">velocity_fraction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">foaming_factor</span> <span class="o">=</span> <span class="n">foaming_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open_tray_area_fraction</span> <span class="o">=</span> <span class="n">open_tray_area_fraction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">downcomer_area_fraction</span> <span class="o">=</span> <span class="n">downcomer_area_fraction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_divided</span> <span class="o">=</span> <span class="n">is_divided</span>
        
        <span class="c1"># Setup components</span>
        <span class="n">thermo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thermo</span>
        <span class="c1">#: [HXutility] Condenser.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">condenser</span> <span class="o">=</span> <span class="n">HXutility</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">ins</span><span class="o">=</span><span class="n">tmo</span><span class="o">.</span><span class="n">Stream</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">thermo</span><span class="o">=</span><span class="n">thermo</span><span class="p">),</span>
                                   <span class="n">outs</span><span class="o">=</span><span class="n">tmo</span><span class="o">.</span><span class="n">MultiStream</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">thermo</span><span class="o">=</span><span class="n">thermo</span><span class="p">),</span>
                                   <span class="n">thermo</span><span class="o">=</span><span class="n">thermo</span><span class="p">)</span>
        <span class="c1">#: [HXutility] Boiler.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boiler</span> <span class="o">=</span> <span class="n">HXutility</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">ins</span><span class="o">=</span><span class="n">tmo</span><span class="o">.</span><span class="n">Stream</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">thermo</span><span class="o">=</span><span class="n">thermo</span><span class="p">),</span>
                                <span class="n">outs</span><span class="o">=</span><span class="n">tmo</span><span class="o">.</span><span class="n">MultiStream</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">thermo</span><span class="o">=</span><span class="n">thermo</span><span class="p">),</span>
                                <span class="n">thermo</span><span class="o">=</span><span class="n">thermo</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heat_utilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">condenser</span><span class="o">.</span><span class="n">heat_utilities</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">boiler</span><span class="o">.</span><span class="n">heat_utilities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_McCabeThiele_args</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">condensate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">condenser</span><span class="o">.</span><span class="n">outs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;l&#39;</span><span class="p">]</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boilup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">boiler</span><span class="o">.</span><span class="n">outs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;g&#39;</span><span class="p">]</span>    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bottoms_produt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">boiler</span><span class="o">.</span><span class="n">outs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;l&#39;</span><span class="p">]</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">distillate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">condenser</span><span class="o">.</span><span class="n">outs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;g&#39;</span><span class="p">]</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">LHK</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;tuple[str, str] Light and heavy keys.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_LHK</span>
    <span class="nd">@LHK</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">LHK</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">LHK</span><span class="p">):</span>
        <span class="c1"># Set light non-key and heavy non-key indices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_LHK</span> <span class="o">=</span> <span class="n">LHK</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">LHK</span><span class="p">)</span>
        <span class="n">intermediate_volatile_chemicals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">chemicals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chemicals</span>
        <span class="n">LHK_chemicals</span> <span class="o">=</span> <span class="n">LK_chemical</span><span class="p">,</span> <span class="n">HK_chemical</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chemicals</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">LHK</span><span class="p">)</span>
        <span class="n">Tb_light</span> <span class="o">=</span> <span class="n">LK_chemical</span><span class="o">.</span><span class="n">Tb</span>
        <span class="n">Tb_heavy</span> <span class="o">=</span> <span class="n">HK_chemical</span><span class="o">.</span><span class="n">Tb</span>
        <span class="n">LNK</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">HNK</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">Tb_light</span> <span class="o">&gt;</span> <span class="n">Tb_heavy</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;light key must be lighter than heavy key&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">chemical</span> <span class="ow">in</span> <span class="n">chemicals</span><span class="p">:</span>
            <span class="n">Tb</span> <span class="o">=</span> <span class="n">chemical</span><span class="o">.</span><span class="n">Tb</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">Tb</span><span class="p">:</span>
                <span class="n">HNK</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chemical</span><span class="o">.</span><span class="n">ID</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">Tb</span> <span class="o">&lt;</span> <span class="n">Tb_light</span><span class="p">:</span>
                <span class="n">LNK</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chemical</span><span class="o">.</span><span class="n">ID</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">Tb</span> <span class="o">&gt;</span> <span class="n">Tb_heavy</span><span class="p">:</span>
                <span class="n">HNK</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chemical</span><span class="o">.</span><span class="n">ID</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">chemical</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">LHK_chemicals</span><span class="p">:</span>
                <span class="n">intermediate_volatile_chemicals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chemical</span><span class="o">.</span><span class="n">ID</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_LNK</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">LNK</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_HNK</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">HNK</span><span class="p">)</span>
        <span class="n">get_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chemicals</span><span class="o">.</span><span class="n">get_index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_LHK_index</span> <span class="o">=</span> <span class="n">get_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_LHK</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_LNK_index</span> <span class="o">=</span> <span class="n">get_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_LNK</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_HNK_index</span> <span class="o">=</span> <span class="n">get_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_HNK</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_intermediate_volatile_chemicals</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">intermediate_volatile_chemicals</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y_top</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Light key composition of at the distillate.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_top</span>
    <span class="nd">@y_top</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">y_top</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y_top</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_top</span> <span class="o">=</span> <span class="n">y_top</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">y_top</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">y_top</span><span class="p">])</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x_bot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Light key composition at the bottoms product.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_bot</span>
    <span class="nd">@x_bot</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">x_bot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_bot</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_bot</span> <span class="o">=</span> <span class="n">x_bot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x_bot</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">x_bot</span><span class="p">])</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tray_spacing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TS</span>
    <span class="nd">@tray_spacing</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">tray_spacing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TS</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tray spacing (225-600 mm).&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_TS</span> <span class="o">=</span> <span class="n">TS</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">stage_efficiency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enforced user defined stage efficiency.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_E_eff</span>
    <span class="nd">@stage_efficiency</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">stage_efficiency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E_eff</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_E_eff</span> <span class="o">=</span> <span class="n">E_eff</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">velocity_fraction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fraction of actual velocity to maximum velocity allowable before flooding.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f</span>
    <span class="nd">@velocity_fraction</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">velocity_fraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_f</span> <span class="o">=</span> <span class="n">f</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">foaming_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Foaming factor (0 to 1).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_F_F</span>
    <span class="nd">@foaming_factor</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">foaming_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">F_F</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">F_F</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;foaming_factor must be between 0 and 1, (</span><span class="si">{F_F}</span><span class="s2"> given).&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_F_F</span> <span class="o">=</span> <span class="n">F_F</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">open_tray_area_fraction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fraction of open area, A_h, to active area, A_a.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A_ha</span>
    <span class="nd">@open_tray_area_fraction</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">open_tray_area_fraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A_ha</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_A_ha</span> <span class="o">=</span> <span class="n">A_ha</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">downcomer_area_fraction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enforced fraction of downcomer area to net (total) area.</span>
<span class="sd">        If None, the fraction is estimated based on heuristics.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A_dn</span>
    <span class="nd">@downcomer_area_fraction</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">downcomer_area_fraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A_dn</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_A_dn</span> <span class="o">=</span> <span class="n">A_dn</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tray_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Default &#39;Sieve&#39;&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tray_type</span>
    <span class="nd">@tray_type</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">tray_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tray_type</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tray_type</span> <span class="ow">in</span> <span class="n">distillation_tray_type_factor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tray_type</span> <span class="o">=</span> <span class="n">tray_type</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_F_TT</span> <span class="o">=</span> <span class="n">distillation_tray_type_factor</span><span class="p">[</span><span class="n">tray_type</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;tray type must be one of the following: &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;{&#39;, &#39;.join(distillation_tray_type_factor)}&quot;</span><span class="p">)</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tray_material</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Default &#39;Carbon steel&#39;&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tray_material</span>
    <span class="nd">@tray_material</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">tray_material</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tray_material</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tray_material</span> <span class="ow">in</span> <span class="n">tray_material_factor_functions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tray_material</span> <span class="o">=</span> <span class="n">tray_material</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_F_TM_function</span> <span class="o">=</span> <span class="n">tray_material_factor_functions</span><span class="p">[</span><span class="n">tray_material</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;tray material must be one of the following: &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;{&#39;, &#39;.join(tray_material_factor_functions)}&quot;</span><span class="p">)</span>
        

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vessel_material</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Default &#39;Carbon steel&#39;&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vessel_material</span>
    <span class="nd">@vessel_material</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">vessel_material</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vessel_material</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">vessel_material</span> <span class="ow">in</span> <span class="n">distillation_column_material_factors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vessel_material</span> <span class="o">=</span> <span class="n">vessel_material</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_F_VM</span> <span class="o">=</span> <span class="n">distillation_column_material_factors</span><span class="p">[</span><span class="n">vessel_material</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;vessel material must be one of the following: &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;{&#39;, &#39;.join(distillation_column_material_factors)}&quot;</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_divided</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;[bool] True if the stripper and rectifier are two separate columns.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_divided</span>
    <span class="nd">@is_divided</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">is_divided</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_divided</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_divided</span> <span class="o">=</span> <span class="n">is_divided</span>
    
    <span class="k">def</span> <span class="nf">_check_mass_balance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">LHK</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_LHK</span>
        <span class="n">intermediate_chemicals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_intermediate_volatile_chemicals</span>
        <span class="n">intemediates_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chemicals</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="n">intermediate_chemicals</span><span class="p">)</span>
        <span class="n">intermediate_flows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol_in</span><span class="p">[</span><span class="n">intemediates_index</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">flow</span><span class="p">,</span> <span class="n">chemical</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">intermediate_flows</span><span class="p">,</span> <span class="n">intermediate_chemicals</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">flow</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;intermediate volatile chemical,&quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{chemical}</span><span class="s2">&#39;, between light and heavy &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;key, {&#39;, &#39;.join(LHK)}&quot;</span><span class="p">)</span>
        <span class="n">distillate</span><span class="p">,</span> <span class="n">bottoms_product</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span>
        <span class="n">LHK</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_LHK</span>
        <span class="n">LHK_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_LHK_index</span>
        <span class="n">LK_distillate</span><span class="p">,</span> <span class="n">HK_distillate</span> <span class="o">=</span> <span class="n">distillate</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">LHK_index</span><span class="p">]</span>
        <span class="n">LK_bottoms</span><span class="p">,</span> <span class="n">HK_bottoms</span> <span class="o">=</span> <span class="n">bottoms_product</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">LHK_index</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">LK_distillate</span> <span class="ow">and</span> <span class="n">LK_bottoms</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;Light key composition is infeasible&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">HK_distillate</span> <span class="ow">and</span> <span class="n">HK_bottoms</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;heavy key composition is infeasible&quot;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_run_mass_balance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Get all important flow rates (both light and heavy keys and non-keys)</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol_in</span>
        <span class="n">LHK_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_LHK_index</span>
        <span class="n">HNK_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_HNK_index</span>
        <span class="n">LNK_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_LNK_index</span>
        <span class="n">LHK_mol</span> <span class="o">=</span> <span class="n">mol</span><span class="p">[</span><span class="n">LHK_index</span><span class="p">]</span>
        <span class="n">HNK_mol</span> <span class="o">=</span> <span class="n">mol</span><span class="p">[</span><span class="n">HNK_index</span><span class="p">]</span>
        <span class="n">LNK_mol</span> <span class="o">=</span> <span class="n">mol</span><span class="p">[</span><span class="n">LNK_index</span><span class="p">]</span>

        <span class="c1"># Set light and heavy keys by lever rule</span>
        <span class="n">light</span><span class="p">,</span> <span class="n">heavy</span> <span class="o">=</span> <span class="n">LHK_mol</span>
        <span class="n">F_mol_LHK</span> <span class="o">=</span> <span class="n">light</span> <span class="o">+</span> <span class="n">heavy</span>
        <span class="n">zf</span> <span class="o">=</span> <span class="n">light</span><span class="o">/</span><span class="n">F_mol_LHK</span>
        <span class="n">distillate_fraction</span> <span class="o">=</span> <span class="p">(</span><span class="n">zf</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x_bot</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_top</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x_bot</span><span class="p">)</span>
        <span class="n">F_mol_LHK_distillate</span> <span class="o">=</span> <span class="n">F_mol_LHK</span> <span class="o">*</span> <span class="n">distillate_fraction</span>

        <span class="c1"># Set outlet streams</span>
        <span class="n">distillate</span><span class="p">,</span> <span class="n">bottoms_product</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span>
        <span class="n">distillate_LHK_mol</span> <span class="o">=</span> <span class="n">F_mol_LHK_distillate</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span>
        <span class="n">distillate</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">LHK_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">distillate_LHK_mol</span>
        <span class="n">bottoms_product</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">LHK_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">LHK_mol</span> <span class="o">-</span> <span class="n">distillate_LHK_mol</span>
        <span class="n">distillate</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">LNK_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">LNK_mol</span>
        <span class="n">bottoms_product</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">HNK_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">HNK_mol</span>
        
        <span class="k">if</span> <span class="n">tmo</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_mass_balance</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_mass_balance</span><span class="p">()</span>
        <span class="n">distillate</span><span class="p">,</span> <span class="n">bottoms_product</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span>
        <span class="n">distillate</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span>
        <span class="n">bottoms_product</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="s1">&#39;l&#39;</span>
        <span class="n">distillate</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">bottoms_product</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_condensate_dew_point</span> <span class="o">=</span> <span class="n">dp</span> <span class="o">=</span> <span class="n">distillate</span><span class="o">.</span><span class="n">dew_point_at_P</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_boilup_bubble_point</span> <span class="o">=</span> <span class="n">bp</span> <span class="o">=</span> <span class="n">bottoms_product</span><span class="o">.</span><span class="n">bubble_point_at_P</span><span class="p">()</span>
        <span class="n">bottoms_product</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">bp</span><span class="o">.</span><span class="n">T</span>
        <span class="n">distillate</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">T</span>

    <span class="k">def</span> <span class="nf">_run_McCabeThiele</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">distillate</span><span class="p">,</span> <span class="n">bottoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span>
        <span class="n">chemicals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chemicals</span>
        <span class="n">LHK</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_LHK</span>
        <span class="n">LHK_index</span> <span class="o">=</span> <span class="n">chemicals</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="n">LHK</span><span class="p">)</span>

        <span class="c1"># Feed light key mol fraction</span>
        <span class="n">liq_mol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">chemicals</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">vap_mol</span> <span class="o">=</span> <span class="n">liq_mol</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ins</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">tmo</span><span class="o">.</span><span class="n">MultiStream</span><span class="p">):</span>
                <span class="n">liq_mol</span> <span class="o">+=</span> <span class="n">s</span><span class="o">.</span><span class="n">imol</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">]</span>
                <span class="n">vap_mol</span> <span class="o">+=</span> <span class="n">s</span><span class="o">.</span><span class="n">imol</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">s</span><span class="o">.</span><span class="n">phase</span> <span class="o">==</span> <span class="s1">&#39;g&#39;</span><span class="p">:</span>
                <span class="n">vap_mol</span> <span class="o">+=</span> <span class="n">s</span><span class="o">.</span><span class="n">mol</span>
            <span class="k">elif</span> <span class="n">s</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span>
                <span class="n">liq_mol</span> <span class="o">+=</span> <span class="n">s</span><span class="o">.</span><span class="n">mol</span>
            <span class="k">elif</span> <span class="n">s</span><span class="o">.</span><span class="n">phase</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;invalid phase encountered in {repr(s)}&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_feed_liqmol</span> <span class="o">=</span> <span class="n">liq_mol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_feed_vapmol</span> <span class="o">=</span> <span class="n">vap_mol</span>
        <span class="n">LHK_mol</span> <span class="o">=</span> <span class="n">liq_mol</span><span class="p">[</span><span class="n">LHK_index</span><span class="p">]</span> <span class="o">+</span> <span class="n">vap_mol</span><span class="p">[</span><span class="n">LHK_index</span><span class="p">]</span>
        <span class="n">F_mol_LHK</span> <span class="o">=</span> <span class="n">LHK_mol</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">zf</span> <span class="o">=</span> <span class="n">LHK_mol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">F_mol_LHK</span>
        
        <span class="c1"># Get feed quality</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">liq_mol</span><span class="p">[</span><span class="n">LHK_index</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="n">F_mol_LHK</span>
        
        <span class="c1"># Main arguments</span>
        <span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span>
        <span class="n">y_top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_top</span>
        <span class="n">x_bot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_bot</span>
        
        <span class="c1"># Cache</span>
        <span class="n">old_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_McCabeThiele_args</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">P</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">y_top</span><span class="p">,</span> <span class="n">x_bot</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">zf</span><span class="p">])</span>
        <span class="n">tol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">50</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">],</span> <span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">old_args</span> <span class="o">-</span> <span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span> <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_McCabeThiele_args</span> <span class="o">=</span> <span class="n">args</span>
        
        <span class="c1"># Get R_min and the q_line </span>
        <span class="k">if</span> <span class="n">q</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1e-5</span>
        <span class="n">q_line</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">q</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">zf</span><span class="o">/</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_q_line_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">,</span> <span class="n">zf</span><span class="o">=</span><span class="n">zf</span><span class="p">)</span>
        
        <span class="n">solve_Ty</span> <span class="o">=</span> <span class="n">bottoms</span><span class="o">.</span><span class="n">get_bubble_point</span><span class="p">(</span><span class="n">LHK</span><span class="p">)</span><span class="o">.</span><span class="n">solve_Ty</span>
        <span class="n">Rmin_intersection</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">q_line</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">solve_Ty</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="p">)),</span> <span class="n">P</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">x_Rmin</span> <span class="o">=</span> <span class="n">brentq</span><span class="p">(</span><span class="n">Rmin_intersection</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">y_Rmin</span> <span class="o">=</span> <span class="n">q_line</span><span class="p">(</span><span class="n">x_Rmin</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_Rmin</span><span class="o">-</span><span class="n">y_top</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x_Rmin</span><span class="o">-</span><span class="n">y_top</span><span class="p">)</span>
        <span class="n">Rmin</span> <span class="o">=</span> <span class="n">m</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">m</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Rmin</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">R</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="o">*</span><span class="n">k</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">R</span> <span class="o">=</span> <span class="n">Rmin</span><span class="o">*</span><span class="n">k</span>

        <span class="c1"># Rectifying section: Inntersects q_line with slope given by R/(R+1)</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="n">R</span><span class="o">/</span><span class="p">(</span><span class="n">R</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">b1</span> <span class="o">=</span> <span class="n">y_top</span><span class="o">-</span><span class="n">m1</span><span class="o">*</span><span class="n">y_top</span>
        <span class="n">rs</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">b1</span><span class="p">)</span><span class="o">/</span><span class="n">m1</span> <span class="c1"># -&gt; x</span>
        
        <span class="c1"># y_m is the solution to lambda y: y - q_line(rs(y))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_m</span> <span class="o">=</span> <span class="n">y_m</span> <span class="o">=</span> <span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">m1</span><span class="o">*</span><span class="n">zf</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="n">m1</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_m</span> <span class="o">=</span> <span class="n">x_m</span> <span class="o">=</span> <span class="n">rs</span><span class="p">(</span><span class="n">y_m</span><span class="p">)</span>
        
        <span class="c1"># Stripping section: Intersects Rectifying section and q_line and beggins at bottoms liquid composition</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_bot</span><span class="o">-</span><span class="n">y_m</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x_bot</span><span class="o">-</span><span class="n">x_m</span><span class="p">)</span>
        <span class="n">b2</span> <span class="o">=</span> <span class="n">y_m</span><span class="o">-</span><span class="n">m2</span><span class="o">*</span><span class="n">x_m</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">b2</span><span class="p">)</span><span class="o">/</span><span class="n">m2</span> <span class="c1"># -&gt; x        </span>
        
        <span class="c1"># Data for staircase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_stages</span> <span class="o">=</span> <span class="n">x_stages</span> <span class="o">=</span> <span class="p">[</span><span class="n">x_bot</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_stages</span> <span class="o">=</span> <span class="n">y_stages</span> <span class="o">=</span> <span class="p">[</span><span class="n">x_bot</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_T_stages</span> <span class="o">=</span> <span class="n">T_stages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">compute_stages_McCabeThiele</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="n">x_stages</span><span class="p">,</span> <span class="n">y_stages</span><span class="p">,</span> <span class="n">T_stages</span><span class="p">,</span> <span class="n">x_m</span><span class="p">,</span> <span class="n">solve_Ty</span><span class="p">)</span>
        <span class="n">yi</span> <span class="o">=</span> <span class="n">y_stages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">xi</span> <span class="o">=</span> <span class="n">rs</span><span class="p">(</span><span class="n">yi</span><span class="p">)</span>
        <span class="n">x_stages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">xi</span> <span class="k">if</span> <span class="n">xi</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">0.99999</span>
        <span class="n">compute_stages_McCabeThiele</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="n">x_stages</span><span class="p">,</span> <span class="n">y_stages</span><span class="p">,</span> <span class="n">T_stages</span><span class="p">,</span> <span class="n">y_top</span><span class="p">,</span> <span class="n">solve_Ty</span><span class="p">)</span>
        
        <span class="c1"># Find feed stage</span>
        <span class="n">N_stages</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_stages</span><span class="p">)</span>
        <span class="n">feed_stage</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="n">N_stages</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_stages</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">y_stages</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">y_m</span> <span class="o">&lt;</span> <span class="n">y_stages</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">feed_stage</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
        
        <span class="c1"># Results</span>
        <span class="n">Design</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">design_results</span>
        <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Theoretical feed stage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">N_stages</span> <span class="o">-</span> <span class="n">feed_stage</span>
        <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Theoretical stages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">N_stages</span>
        <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Minimum reflux&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Rmin</span>
        <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Reflux&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span>
        
    <span class="k">def</span> <span class="nf">_run_condenser_and_boiler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">distillate</span><span class="p">,</span> <span class="n">bottoms_product</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span>
        <span class="n">condenser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">condenser</span>
        <span class="n">boiler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boiler</span>
        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">design_results</span><span class="p">[</span><span class="s1">&#39;Reflux&#39;</span><span class="p">]</span>
        
        <span class="c1"># Set condenser conditions</span>
        <span class="n">condenser</span><span class="o">.</span><span class="n">outs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imol</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">distillate</span><span class="o">.</span><span class="n">mol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_F_mol_distillate</span> <span class="o">=</span> <span class="n">F_mol_distillate</span> <span class="o">=</span> <span class="n">distillate</span><span class="o">.</span><span class="n">F_mol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_F_mol_condensate</span> <span class="o">=</span> <span class="n">F_mol_condensate</span> <span class="o">=</span> <span class="n">R</span> <span class="o">*</span> <span class="n">F_mol_distillate</span>
        <span class="n">dp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_condensate_dew_point</span>
        <span class="n">condensate_x_mol</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">x</span>
        <span class="n">condensate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">condensate</span>
        <span class="n">condensate</span><span class="o">.</span><span class="n">imol</span><span class="p">[</span><span class="n">dp</span><span class="o">.</span><span class="n">IDs</span><span class="p">]</span> <span class="o">=</span> <span class="n">condensate_x_mol</span> <span class="o">*</span> <span class="n">F_mol_condensate</span>
        <span class="n">condensate</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">T</span>
        <span class="n">condensate</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">P</span>
        <span class="n">vap</span> <span class="o">=</span> <span class="n">condenser</span><span class="o">.</span><span class="n">ins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">vap</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">distillate</span><span class="o">.</span><span class="n">mol</span> <span class="o">+</span> <span class="n">condensate</span><span class="o">.</span><span class="n">mol</span>
        <span class="n">vap</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">distillate</span><span class="o">.</span><span class="n">T</span>
        <span class="n">vap</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">distillate</span><span class="o">.</span><span class="n">P</span>
        
        <span class="c1"># Set boiler conditions</span>
        <span class="n">boiler</span><span class="o">.</span><span class="n">outs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imol</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bottoms_product</span><span class="o">.</span><span class="n">mol</span>
        <span class="n">F_vap_feed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feed_vapmol</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_F_mol_boilup</span> <span class="o">=</span> <span class="n">F_mol_boilup</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">F_mol_distillate</span> <span class="o">-</span> <span class="n">F_vap_feed</span>
        <span class="n">bp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boilup_bubble_point</span>
        <span class="n">boilup_flow</span> <span class="o">=</span> <span class="n">bp</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">F_mol_boilup</span>
        <span class="n">boilup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boilup</span>
        <span class="n">boilup</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">bp</span><span class="o">.</span><span class="n">T</span>
        <span class="n">boilup</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">bp</span><span class="o">.</span><span class="n">P</span>
        <span class="n">boilup</span><span class="o">.</span><span class="n">imol</span><span class="p">[</span><span class="n">bp</span><span class="o">.</span><span class="n">IDs</span><span class="p">]</span> <span class="o">=</span> <span class="n">boilup_flow</span>
        <span class="n">liq</span> <span class="o">=</span> <span class="n">boiler</span><span class="o">.</span><span class="n">ins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">liq</span><span class="o">.</span><span class="n">mol</span> <span class="o">=</span> <span class="n">bottoms_product</span><span class="o">.</span><span class="n">mol</span> <span class="o">+</span> <span class="n">boilup</span><span class="o">.</span><span class="n">mol</span>
        
    <span class="k">def</span> <span class="nf">_simulate_condenser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">condenser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">condenser</span>
        <span class="n">condenser</span><span class="o">.</span><span class="n">_design</span><span class="p">()</span>
        <span class="n">condenser</span><span class="o">.</span><span class="n">_cost</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">_simulate_boiler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">boiler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boiler</span>
        <span class="n">boiler</span><span class="o">.</span><span class="n">_design</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H_out</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">H_in</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">condenser</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span>
        <span class="n">boiler</span><span class="o">.</span><span class="n">_cost</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">_simulate_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="c1"># Cost condenser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_simulate_condenser</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">purchase_costs</span><span class="p">[</span><span class="s1">&#39;Condenser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">condenser</span><span class="o">.</span><span class="n">purchase_costs</span><span class="p">[</span><span class="s1">&#39;Heat exchanger&#39;</span><span class="p">]</span>
        
        <span class="c1"># Cost boiler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_simulate_boiler</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">purchase_costs</span><span class="p">[</span><span class="s1">&#39;Boiler&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boiler</span><span class="o">.</span><span class="n">purchase_costs</span><span class="p">[</span><span class="s1">&#39;Heat exchanger&#39;</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">_compute_N_stages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a tuple with the actual number of stages for the rectifier and the stripper.&quot;&quot;&quot;</span>
        <span class="n">vap</span><span class="p">,</span> <span class="n">liq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span>
        <span class="n">Design</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">design_results</span>
        <span class="n">x_stages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_stages</span>
        <span class="n">y_stages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_stages</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Reflux&#39;</span><span class="p">]</span>
        <span class="n">N_stages</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Theoretical stages&#39;</span><span class="p">]</span>
        <span class="n">feed_stage</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Theoretical feed stage&#39;</span><span class="p">]</span>
        <span class="n">E_eff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage_efficiency</span>
        <span class="k">if</span> <span class="n">E_eff</span><span class="p">:</span>
            <span class="n">E_rectifier</span> <span class="o">=</span> <span class="n">E_stripper</span> <span class="o">=</span> <span class="n">E_eff</span>
        <span class="k">else</span><span class="p">:</span>    
            <span class="c1"># Calculate Murphree Efficiency for rectifying section</span>
            <span class="n">condensate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">condensate</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="n">condensate</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;mu&#39;</span><span class="p">,</span> <span class="s1">&#39;mPa*s&#39;</span><span class="p">)</span>
            <span class="n">K_light</span> <span class="o">=</span> <span class="n">y_stages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">x_stages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> 
            <span class="n">K_heavy</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">y_stages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x_stages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">K_light</span><span class="o">/</span><span class="n">K_heavy</span>
            <span class="n">F_mol_distillate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_F_mol_distillate</span>
            <span class="n">L_Rmol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_F_mol_condensate</span>
            <span class="n">V_Rmol</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">F_mol_distillate</span>
            <span class="n">E_rectifier</span> <span class="o">=</span> <span class="n">compute_murphree_stage_efficiency</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">L_Rmol</span><span class="p">,</span> <span class="n">V_Rmol</span><span class="p">)</span>
            
            <span class="c1"># Calculate Murphree Efficiency for stripping section</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="n">liq</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;mu&#39;</span><span class="p">,</span> <span class="s1">&#39;mPa*s&#39;</span><span class="p">)</span>
            <span class="n">V_Smol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_F_mol_boilup</span>
            <span class="n">L_Smol</span> <span class="o">=</span> <span class="n">R</span><span class="o">*</span><span class="n">F_mol_distillate</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_feed_liqmol</span><span class="p">)</span> 
            <span class="n">K_light</span> <span class="o">=</span> <span class="n">y_stages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">x_stages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
            <span class="n">K_heavy</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">y_stages</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x_stages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">K_light</span><span class="o">/</span><span class="n">K_heavy</span>
            <span class="n">E_stripper</span> <span class="o">=</span> <span class="n">compute_murphree_stage_efficiency</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">L_Smol</span><span class="p">,</span> <span class="n">V_Smol</span><span class="p">)</span>
            
        <span class="c1"># Calculate actual number of stages</span>
        <span class="n">mid_stage</span> <span class="o">=</span> <span class="n">feed_stage</span> <span class="o">-</span> <span class="mf">0.5</span>
        <span class="n">N_rectifier</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">mid_stage</span><span class="o">/</span><span class="n">E_rectifier</span><span class="p">)</span>
        <span class="n">N_stripper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">N_stages</span><span class="o">-</span><span class="n">mid_stage</span><span class="p">)</span><span class="o">/</span><span class="n">E_stripper</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">N_rectifier</span><span class="p">,</span> <span class="n">N_stripper</span>
        
    <span class="k">def</span> <span class="nf">_design</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_McCabeThiele</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_condenser_and_boiler</span><span class="p">()</span>
        <span class="n">distillate</span><span class="p">,</span> <span class="n">bottoms_product</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span>
        <span class="n">Design</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">design_results</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Reflux&#39;</span><span class="p">]</span>
        <span class="n">Rstages</span><span class="p">,</span> <span class="n">Sstages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_N_stages</span><span class="p">()</span>
        <span class="n">is_divided</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_divided</span>
        <span class="n">TS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TS</span>
        
        <span class="c1">### Get diameter of rectifying section based on top plate ###</span>
        
        <span class="n">condensate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">condensate</span>
        <span class="n">rho_L</span> <span class="o">=</span> <span class="n">condensate</span><span class="o">.</span><span class="n">rho</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">condensate</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span> <span class="s1">&#39;dyn/cm&#39;</span><span class="p">)</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">condensate</span><span class="o">.</span><span class="n">F_mass</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">L</span><span class="o">*</span><span class="p">(</span><span class="n">R</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">R</span>
        <span class="n">vap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">condenser</span><span class="o">.</span><span class="n">ins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">V_vol</span> <span class="o">=</span> <span class="n">vap</span><span class="o">.</span><span class="n">get_total_flow</span><span class="p">(</span><span class="s1">&#39;m^3/s&#39;</span><span class="p">)</span>
        <span class="n">rho_V</span> <span class="o">=</span> <span class="n">distillate</span><span class="o">.</span><span class="n">rho</span>
        <span class="n">F_LV</span> <span class="o">=</span> <span class="n">compute_flow_parameter</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">rho_V</span><span class="p">,</span> <span class="n">rho_L</span><span class="p">)</span>
        <span class="n">C_sbf</span> <span class="o">=</span> <span class="n">compute_max_capacity_parameter</span><span class="p">(</span><span class="n">TS</span><span class="p">,</span> <span class="n">F_LV</span><span class="p">)</span>
        <span class="n">F_F</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_F_F</span>
        <span class="n">A_ha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A_ha</span>
        <span class="n">U_f</span> <span class="o">=</span> <span class="n">compute_max_vapor_velocity</span><span class="p">(</span><span class="n">C_sbf</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">rho_L</span><span class="p">,</span> <span class="n">rho_V</span><span class="p">,</span> <span class="n">F_F</span><span class="p">,</span> <span class="n">A_ha</span><span class="p">)</span>
        <span class="n">A_dn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A_dn</span>
        <span class="k">if</span> <span class="n">A_dn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">_A_dn</span> <span class="o">=</span> <span class="n">A_dn</span> <span class="o">=</span> <span class="n">compute_downcomer_area_fraction</span><span class="p">(</span><span class="n">F_LV</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f</span>
        <span class="n">R_diameter</span> <span class="o">=</span> <span class="n">compute_tower_diameter</span><span class="p">(</span><span class="n">V_vol</span><span class="p">,</span> <span class="n">U_f</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">A_dn</span><span class="p">)</span> <span class="o">*</span> <span class="mf">3.28</span>
        
        <span class="c1">### Get diameter of stripping section based on feed plate ###</span>
        <span class="n">rho_L</span> <span class="o">=</span> <span class="n">bottoms_product</span><span class="o">.</span><span class="n">rho</span>
        <span class="n">boilup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boilup</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">boilup</span><span class="o">.</span><span class="n">F_mass</span>
        <span class="n">V_vol</span> <span class="o">=</span> <span class="n">boilup</span><span class="o">.</span><span class="n">get_total_flow</span><span class="p">(</span><span class="s1">&#39;m^3/s&#39;</span><span class="p">)</span>
        <span class="n">rho_V</span> <span class="o">=</span> <span class="n">boilup</span><span class="o">.</span><span class="n">rho</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">bottoms_product</span><span class="o">.</span><span class="n">F_mass</span> <span class="c1"># To get liquid going down</span>
        <span class="n">F_LV</span> <span class="o">=</span> <span class="n">compute_flow_parameter</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">rho_V</span><span class="p">,</span> <span class="n">rho_L</span><span class="p">)</span>
        <span class="n">C_sbf</span> <span class="o">=</span> <span class="n">compute_max_capacity_parameter</span><span class="p">(</span><span class="n">TS</span><span class="p">,</span> <span class="n">F_LV</span><span class="p">)</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">condensate</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span> <span class="s1">&#39;dyn/cm&#39;</span><span class="p">)</span>
        <span class="n">U_f</span> <span class="o">=</span> <span class="n">compute_max_vapor_velocity</span><span class="p">(</span><span class="n">C_sbf</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">rho_L</span><span class="p">,</span> <span class="n">rho_V</span><span class="p">,</span> <span class="n">F_F</span><span class="p">,</span> <span class="n">A_ha</span><span class="p">)</span>
        <span class="n">A_dn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A_dn</span>
        <span class="k">if</span> <span class="n">A_dn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">A_dn</span> <span class="o">=</span> <span class="n">compute_downcomer_area_fraction</span><span class="p">(</span><span class="n">F_LV</span><span class="p">)</span>
        <span class="n">S_diameter</span> <span class="o">=</span> <span class="n">compute_tower_diameter</span><span class="p">(</span><span class="n">V_vol</span><span class="p">,</span> <span class="n">U_f</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">A_dn</span><span class="p">)</span> <span class="o">*</span> <span class="mf">3.28</span>
        <span class="n">Po</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">*</span> <span class="mf">0.000145078</span> <span class="c1"># to psi</span>
        <span class="n">rho_M</span> <span class="o">=</span> <span class="n">material_densities_lb_per_in3</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vessel_material</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">is_divided</span><span class="p">:</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Rectifier stages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Rstages</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Stripper stages&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">Sstages</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Rectifier height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">H_R</span> <span class="o">=</span> <span class="n">compute_tower_height</span><span class="p">(</span><span class="n">TS</span><span class="p">,</span> <span class="n">Rstages</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">3.28</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Stripper height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">H_S</span> <span class="o">=</span> <span class="n">compute_tower_height</span><span class="p">(</span><span class="n">TS</span><span class="p">,</span> <span class="n">Sstages</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">3.28</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Rectifier diameter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">R_diameter</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Stripper diameter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">S_diameter</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Rectifier wall thickness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tv</span> <span class="o">=</span> <span class="n">compute_tower_wall_thickness</span><span class="p">(</span><span class="n">Po</span><span class="p">,</span> <span class="n">R_diameter</span><span class="p">,</span> <span class="n">H_R</span><span class="p">)</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Stripper wall thickness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tv</span> <span class="o">=</span> <span class="n">compute_tower_wall_thickness</span><span class="p">(</span><span class="n">Po</span><span class="p">,</span> <span class="n">S_diameter</span><span class="p">,</span> <span class="n">H_S</span><span class="p">)</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Rectifier weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compute_tower_weight</span><span class="p">(</span><span class="n">R_diameter</span><span class="p">,</span> <span class="n">H_R</span><span class="p">,</span> <span class="n">tv</span><span class="p">,</span> <span class="n">rho_M</span><span class="p">)</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Stripper weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compute_tower_weight</span><span class="p">(</span><span class="n">S_diameter</span><span class="p">,</span> <span class="n">H_S</span><span class="p">,</span> <span class="n">tv</span><span class="p">,</span> <span class="n">rho_M</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Actual stages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Rstages</span> <span class="o">+</span> <span class="n">Sstages</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">H</span> <span class="o">=</span> <span class="n">compute_tower_height</span><span class="p">(</span><span class="n">TS</span><span class="p">,</span> <span class="n">Rstages</span><span class="o">+</span><span class="n">Sstages</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">3.28</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Diameter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Di</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="n">R_diameter</span><span class="p">,</span> <span class="n">S_diameter</span><span class="p">))</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Wall thickness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tv</span> <span class="o">=</span> <span class="n">compute_tower_wall_thickness</span><span class="p">(</span><span class="n">Po</span><span class="p">,</span> <span class="n">Di</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
            <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compute_tower_weight</span><span class="p">(</span><span class="n">Di</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">tv</span><span class="p">,</span> <span class="n">rho_M</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Design</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">design_results</span>
        <span class="n">Cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">purchase_costs</span>
        <span class="n">F_TT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_F_TT</span>
        <span class="n">F_VM</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_F_VM</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_divided</span><span class="p">:</span>
            <span class="c1"># Number of trays assuming a partial condenser</span>
            <span class="n">N_RT</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Rectifier stages&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">Di_R</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Rectifier diameter&#39;</span><span class="p">]</span>
            <span class="n">F_TM</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_F_TM_function</span><span class="p">(</span><span class="n">Di_R</span><span class="p">)</span>
            <span class="n">Cost</span><span class="p">[</span><span class="s1">&#39;Rectifier trays&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compute_purchase_cost_of_trays</span><span class="p">(</span><span class="n">N_RT</span><span class="p">,</span> <span class="n">Di_R</span><span class="p">,</span> <span class="n">F_TT</span><span class="p">,</span> <span class="n">F_TM</span><span class="p">)</span>
            <span class="n">N_ST</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Stripper stages&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">Di_S</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Stripper diameter&#39;</span><span class="p">]</span>
            <span class="n">F_TM</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_F_TM_function</span><span class="p">(</span><span class="n">Di_R</span><span class="p">)</span>
            <span class="n">Cost</span><span class="p">[</span><span class="s1">&#39;Stripper trays&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compute_purchase_cost_of_trays</span><span class="p">(</span><span class="n">N_ST</span><span class="p">,</span> <span class="n">Di_S</span><span class="p">,</span> <span class="n">F_TT</span><span class="p">,</span> <span class="n">F_TM</span><span class="p">)</span>
            
            <span class="c1"># Cost vessel assuming T &lt; 800 F</span>
            <span class="n">W_R</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Rectifier weight&#39;</span><span class="p">]</span> <span class="c1"># in lb</span>
            <span class="n">H_R</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Rectifier height&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">3.28</span> <span class="c1"># in ft</span>
            <span class="n">Cost</span><span class="p">[</span><span class="s1">&#39;Rectifier tower&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compute_purchase_cost_of_tower</span><span class="p">(</span><span class="n">Di_R</span><span class="p">,</span> <span class="n">H_R</span><span class="p">,</span> <span class="n">W_R</span><span class="p">,</span> <span class="n">F_VM</span><span class="p">)</span>
            <span class="n">W_S</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Stripper weight&#39;</span><span class="p">]</span> <span class="c1"># in lb</span>
            <span class="n">H_S</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Stripper height&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">3.28</span> <span class="c1"># in ft</span>
            <span class="n">Cost</span><span class="p">[</span><span class="s1">&#39;Stripper tower&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compute_purchase_cost_of_tower</span><span class="p">(</span><span class="n">Di_S</span><span class="p">,</span> <span class="n">H_S</span><span class="p">,</span> <span class="n">W_S</span><span class="p">,</span> <span class="n">F_VM</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Cost trays assuming a partial condenser</span>
            <span class="n">N_T</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Actual stages&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">Di</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Diameter&#39;</span><span class="p">]</span>
            <span class="n">F_TM</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_F_TM_function</span><span class="p">(</span><span class="n">Di</span><span class="p">)</span>
            <span class="n">Cost</span><span class="p">[</span><span class="s1">&#39;Trays&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compute_purchase_cost_of_trays</span><span class="p">(</span><span class="n">N_T</span><span class="p">,</span> <span class="n">Di</span><span class="p">,</span> <span class="n">F_TT</span><span class="p">,</span> <span class="n">F_TM</span><span class="p">)</span>
            
            <span class="c1"># Cost vessel assuming T &lt; 800 F</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Weight&#39;</span><span class="p">]</span> <span class="c1"># in lb</span>
            <span class="n">L</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Height&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">3.28</span> <span class="c1"># in ft</span>
            <span class="n">Cost</span><span class="p">[</span><span class="s1">&#39;Tower&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compute_purchase_cost_of_tower</span><span class="p">(</span><span class="n">Di</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">F_VM</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_simulate_components</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">_plot_stages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot stages, graphical aid line, and equilibrium curve. The plot does not include operating lines nor a legend.&quot;&quot;&quot;</span>
        <span class="n">vap</span><span class="p">,</span> <span class="n">liq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;x_stages&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_design</span><span class="p">()</span>
        <span class="n">x_stages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_stages</span>
        <span class="n">y_stages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_stages</span>
        <span class="n">LHK</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LHK</span>
        <span class="n">LK</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LHK</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span>
        
        <span class="c1"># Equilibrium data</span>
        <span class="n">x_eq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">y_eq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="n">bp</span> <span class="o">=</span> <span class="n">vap</span><span class="o">.</span><span class="n">get_bubble_point</span><span class="p">(</span><span class="n">IDs</span><span class="o">=</span><span class="n">LHK</span><span class="p">)</span>
        <span class="n">solve_Ty</span> <span class="o">=</span> <span class="n">bp</span><span class="o">.</span><span class="n">solve_Ty</span>
        <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">x_eq</span><span class="p">:</span>
            <span class="n">T</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">solve_Ty</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xi</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">xi</span><span class="p">]),</span> <span class="n">P</span><span class="p">)</span>
            <span class="n">y_eq</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
            
        <span class="c1"># Set-up graph</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x (&#39;</span> <span class="o">+</span> <span class="n">LK</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y (&#39;</span> <span class="o">+</span> <span class="n">LK</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        
        <span class="c1"># Plot stages</span>
        <span class="n">x_stairs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_stages</span><span class="p">:</span>
            <span class="n">x_stairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">x_stairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            
        <span class="n">y_stairs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">y_stages</span><span class="p">:</span>
            <span class="n">y_stairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="n">y_stairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">x_stairs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">x_stairs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_stairs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_stairs</span><span class="p">,</span> <span class="n">y_stairs</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
        
        <span class="c1"># Graphical aid line</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        
        <span class="c1"># Vapor equilibrium graph</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_eq</span><span class="p">,</span> <span class="n">y_eq</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    
<div class="viewcode-block" id="Distillation.plot_stages"><a class="viewcode-back" href="../../../units/Distillation.html#biosteam.units.Distillation.plot_stages">[docs]</a>    <span class="k">def</span> <span class="nf">plot_stages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot the McCabe Thiele Diagram.&quot;&quot;&quot;</span>
        <span class="c1"># Plot stages, graphical aid and equilibrium curve</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plot_stages</span><span class="p">()</span>
        <span class="n">vap</span><span class="p">,</span> <span class="n">liq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span>
        <span class="n">Design</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">design_results</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_x_stages&#39;</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_design</span><span class="p">()</span>
        <span class="n">q_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_q_line_args</span>
        <span class="n">zf</span> <span class="o">=</span> <span class="n">q_args</span><span class="p">[</span><span class="s1">&#39;zf&#39;</span><span class="p">]</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q_args</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">]</span>
        <span class="n">q_line</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">q</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">zf</span><span class="o">/</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">y_top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_top</span>
        <span class="n">x_bot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_bot</span>
        <span class="n">stages</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Theoretical stages&#39;</span><span class="p">]</span>
        <span class="n">Rmin</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Minimum reflux&#39;</span><span class="p">]</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Reflux&#39;</span><span class="p">]</span>
        <span class="n">feed_stage</span> <span class="o">=</span> <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Theoretical feed stage&#39;</span><span class="p">]</span>
        
        <span class="c1"># q_line</span>
        <span class="n">intersect2</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">-</span> <span class="n">q_line</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x_m2</span> <span class="o">=</span> <span class="n">brentq</span><span class="p">(</span><span class="n">intersect2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># Graph q-line, Rectifying and Stripping section</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_m</span><span class="p">,</span> <span class="n">x_m2</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_m</span><span class="p">,</span> <span class="n">x_m2</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_m</span><span class="p">,</span> <span class="n">y_top</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_m</span><span class="p">,</span> <span class="n">y_top</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x_bot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_m</span><span class="p">],</span> <span class="p">[</span><span class="n">x_bot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_m</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;Stages: </span><span class="si">{stages}</span><span class="s1">, Feed: </span><span class="si">{feed_stage}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;Graphical aid&#39;</span><span class="p">,</span> <span class="s1">&#39;eq-line&#39;</span><span class="p">,</span> <span class="s1">&#39;q-line&#39;</span><span class="p">,</span> <span class="s1">&#39;ROL&#39;</span><span class="p">,</span> <span class="s1">&#39;SOL&#39;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;McCabe Thiele Diagram (Rmin = </span><span class="si">{Rmin:.2f}</span><span class="s1">, R = </span><span class="si">{R:.2f}</span><span class="s1">)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">plt</span></div></div>

<span class="n">edge_out</span> <span class="o">=</span> <span class="n">Distillation</span><span class="o">.</span><span class="n">_graphics</span><span class="o">.</span><span class="n">edge_out</span>
<span class="n">edge_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;tailport&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;n&#39;</span>
<span class="n">edge_out</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;tailport&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span>
<span class="n">node</span> <span class="o">=</span> <span class="n">Distillation</span><span class="o">.</span><span class="n">_graphics</span><span class="o">.</span><span class="n">node</span>
<span class="n">node</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
<span class="n">node</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1.2&#39;</span>
<span class="k">del</span> <span class="n">edge_out</span><span class="p">,</span> <span class="n">node</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Yoel Cortes-Pena and Jeremy Guest

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>