

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>biosteam._tea &mdash; BioSTEAM 0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'0.1',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> BioSTEAM
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Getting started.html">1. Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MixedStream objects and thermodynamic equilibrium.html">2. MixedStream objects and thermodynamic equilibrium</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Creating a Unit.html">3. Creating a Unit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Unit operation examples.html">4. Unit operation examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Find unit operations and manage flowsheets.html">5. Find unit operations and manage flowsheets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Using -pipe- notation.html">6. Using -pipe- notation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Techno-economic analysis of a biorefinery.html">7. Techno-economic analysis of a biorefinery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Inheriting from Unit.html">8. Inheriting from Unit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Unit decorators.html">9. Unit decorators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Stoichiometric reactions.html">10. Stoichiometric reactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Advanced simulation.html">11. Advanced simulation</a></li>
</ul>
<p class="caption"><span class="caption-text">BioSTEAM API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Species.html">Species</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Stream.html">Stream</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MixedStream.html">MixedStream</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Unit.html">Unit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PowerUtility.html">PowerUtility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../HeatUtility.html">HeatUtility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../System.html">System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../TEA.html">TEA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Flowsheet.html">find</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../compounds.html">compounds</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../units.html">units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../inspect.html">inspect</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reaction.html">reaction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../evaluation.html">evaluation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">BioSTEAM</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>biosteam._tea</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for biosteam._tea</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Mon Feb  4 19:38:37 2019</span>

<span class="sd">@author: Guest Group</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">._utils</span> <span class="k">import</span> <span class="n">wegstein_secant</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">copy</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;TEA&#39;</span><span class="p">,)</span>

<span class="n">_DataFrame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
<span class="n">_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span>

<span class="c1"># TODO: Add &#39;SL&#39;, &#39;DB&#39;, &#39;DDB&#39;, &#39;SYD&#39;, &#39;ACRS&#39; and &#39;MACRS&#39; functions to generate depreciation data</span>

<span class="c1"># %% Depreciation data</span>

<span class="n">_MACRS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;MACRS5&#39;</span><span class="p">:</span>  <span class="n">_array</span><span class="p">([</span><span class="o">.</span><span class="mi">2000</span><span class="p">,</span> <span class="o">.</span><span class="mi">3200</span><span class="p">,</span> <span class="o">.</span><span class="mi">1920</span><span class="p">,</span>
                             <span class="o">.</span><span class="mi">1152</span><span class="p">,</span> <span class="o">.</span><span class="mi">1152</span><span class="p">,</span> <span class="o">.</span><span class="mi">0576</span><span class="p">]),</span>
          
          <span class="s1">&#39;MACRS7&#39;</span><span class="p">:</span>  <span class="n">_array</span><span class="p">([</span><span class="o">.</span><span class="mi">1429</span><span class="p">,</span> <span class="o">.</span><span class="mi">2449</span><span class="p">,</span> <span class="o">.</span><span class="mi">1749</span><span class="p">,</span>
                             <span class="o">.</span><span class="mi">1249</span><span class="p">,</span> <span class="o">.</span><span class="mi">0893</span><span class="p">,</span> <span class="o">.</span><span class="mi">0892</span><span class="p">,</span>
                             <span class="o">.</span><span class="mi">0893</span><span class="p">,</span> <span class="o">.</span><span class="mi">0446</span><span class="p">]),</span>
          
          <span class="s1">&#39;MACRS10&#39;</span><span class="p">:</span> <span class="n">_array</span><span class="p">([</span><span class="o">.</span><span class="mi">1000</span><span class="p">,</span> <span class="o">.</span><span class="mi">1800</span><span class="p">,</span> <span class="o">.</span><span class="mi">1440</span><span class="p">,</span>
                             <span class="o">.</span><span class="mi">1152</span><span class="p">,</span> <span class="o">.</span><span class="mi">0922</span><span class="p">,</span> <span class="o">.</span><span class="mi">0737</span><span class="p">,</span>
                             <span class="o">.</span><span class="mi">0655</span><span class="p">,</span> <span class="o">.</span><span class="mi">0655</span><span class="p">,</span> <span class="o">.</span><span class="mi">0656</span><span class="p">,</span>
                             <span class="o">.</span><span class="mi">0655</span><span class="p">,</span> <span class="o">.</span><span class="mi">0328</span><span class="p">]),</span>

          <span class="s1">&#39;MACRS15&#39;</span><span class="p">:</span> <span class="n">_array</span><span class="p">([</span><span class="o">.</span><span class="mi">0500</span><span class="p">,</span> <span class="o">.</span><span class="mi">0950</span><span class="p">,</span> <span class="o">.</span><span class="mi">0855</span><span class="p">,</span>
                             <span class="o">.</span><span class="mi">0770</span><span class="p">,</span> <span class="o">.</span><span class="mi">0693</span><span class="p">,</span> <span class="o">.</span><span class="mi">0623</span><span class="p">,</span>
                             <span class="o">.</span><span class="mi">0590</span><span class="p">,</span> <span class="o">.</span><span class="mi">0590</span><span class="p">,</span> <span class="o">.</span><span class="mi">0591</span><span class="p">,</span>
                             <span class="o">.</span><span class="mi">0590</span><span class="p">,</span> <span class="o">.</span><span class="mi">0591</span><span class="p">,</span> <span class="o">.</span><span class="mi">0590</span><span class="p">,</span>
                             <span class="o">.</span><span class="mi">0591</span><span class="p">,</span> <span class="o">.</span><span class="mi">0590</span><span class="p">,</span> <span class="o">.</span><span class="mi">0591</span><span class="p">,</span>
                             <span class="o">.</span><span class="mi">0295</span><span class="p">])}</span>


<span class="c1"># %% Cash flow and results info</span>

<span class="n">_cashflow_columns</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Depreciable capital&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Depreciation&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Fixed capital&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Working capital&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Annual operating cost (excl. depr.)&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Sales&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Net earnings&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Cash flow&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Discounted cash flow&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Cumulative cash flow&#39;</span><span class="p">)</span>


<span class="c1"># %% Techno-Economic Analysis</span>

<div class="viewcode-block" id="TEA"><a class="viewcode-back" href="../../TEA.html#biosteam.TEA">[docs]</a><span class="k">class</span> <span class="nc">TEA</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Create a TEA object that can perform cash flow analysis on a System object.</span>
<span class="sd">    </span>
<span class="sd">        **Parameters**</span>
<span class="sd">        </span>
<span class="sd">            **system:** [System] Should contain feed and product streams.</span>
<span class="sd">            </span>
<span class="sd">        **Examples**</span>
<span class="sd">        </span>
<span class="sd">            :doc:`Techno-economic analysis of a biorefinery` </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;system&#39;</span><span class="p">,</span> <span class="s1">&#39;_cached&#39;</span><span class="p">,</span> <span class="s1">&#39;_cashflow&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;_options&#39;</span><span class="p">,</span> <span class="s1">&#39;_IRR_guess&#39;</span><span class="p">,</span> <span class="s1">&#39;_cost_guess&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;_costarr&#39;</span><span class="p">,</span> <span class="s1">&#39;_units&#39;</span><span class="p">)</span>
    
    <span class="c1">#: Default cash flow options</span>
    <span class="n">_default</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Lang factor&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                <span class="s1">&#39;Operating days&#39;</span><span class="p">:</span> <span class="mi">330</span><span class="p">,</span>
                <span class="s1">&#39;IRR&#39;</span><span class="p">:</span> <span class="mf">0.15</span><span class="p">,</span>
                <span class="s1">&#39;Wage&#39;</span><span class="p">:</span> <span class="mf">5e4</span><span class="p">,</span>
                <span class="s1">&#39;Year&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;Employees&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
                <span class="s1">&#39;Fringe benefits&#39;</span><span class="p">:</span> <span class="mf">0.40</span><span class="p">,</span>
                <span class="s1">&#39;Income tax&#39;</span><span class="p">:</span> <span class="mf">0.35</span><span class="p">,</span>
                <span class="s1">&#39;Property tax&#39;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span>
                <span class="s1">&#39;Property insurance&#39;</span><span class="p">:</span> <span class="mf">0.005</span><span class="p">,</span>
                <span class="s1">&#39;Duration&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
                <span class="s1">&#39;Supplies&#39;</span><span class="p">:</span> <span class="mf">0.20</span><span class="p">,</span>
                <span class="s1">&#39;Maintenance&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span>
                <span class="s1">&#39;Administration&#39;</span><span class="p">:</span> <span class="mf">0.005</span><span class="p">,</span>
                <span class="s1">&#39;Working capital&#39;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
                <span class="s1">&#39;Startup&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;Land&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;Royalties&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;Contingency&#39;</span><span class="p">:</span> <span class="mf">0.18</span><span class="p">,</span>
                <span class="s1">&#39;Depreciation&#39;</span><span class="p">:</span> <span class="s1">&#39;MACRS7&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Startup schedule&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span>
                <span class="s1">&#39;Other recurring costs&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;Other fixed capital&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        [dict] Options for cash flow analysis [-]:</span>
<span class="sd">            * **Lang factor:** Lang factor for getting fixed capital investment from total purchase cost. If no lang factor, estimate capital investment using bare module factors.</span>
<span class="sd">            * **Operating days:** (day).</span>
<span class="sd">            * **IRR:** Internal rate of return (fraction).</span>
<span class="sd">            * **Wage:** Wage per employee (USD/yr).</span>
<span class="sd">            * **Year:** Start year of venture.</span>
<span class="sd">            * **Employees:** Number of employees.</span>
<span class="sd">            * **Fringe benefits:** Cost of fringe benefits as a fraction of labor cost.</span>
<span class="sd">            * **Income tax:** Combined federal and state income tax rate (fraction).</span>
<span class="sd">            * **Property tax:** Fee as a fraction of fixed capital investment.</span>
<span class="sd">            * **Property insurance:** Fee as a fraction of fixed capital investment.</span>
<span class="sd">            * **Duration:** Duration of venture (years).</span>
<span class="sd">            * **Supplies:** Yearly fee as a fraction of labor costs.</span>
<span class="sd">            * **Maintenance:** Yearly fee as a fraction of fixed capital investment.</span>
<span class="sd">            * **Administration:** Yearly fee as a fraction of fixed capital investment.</span>
<span class="sd">            * **Working capital:** Fee as a fraction of fixed capital investment.</span>
<span class="sd">            * **Startup:** Cost of start up as a fraction of depreciable capital.</span>
<span class="sd">            * **Land:** Cost of land as a fraction of depreciable capital.</span>
<span class="sd">            * **Royalties:** Cost of royalties as a fraction of depreciable capital.</span>
<span class="sd">            * **Depreciation:** &#39;MACRS&#39; + number of years (e.g. &#39;MACRS7&#39;).</span>
<span class="sd">            * **Startup schedule:** tuple of startup investment fractions per year, starting from year 0. For example, for 50% capital investment in year 0 and 50% investment in year 1: (0.5, 0.5).</span>
<span class="sd">            * **Contingency:** Cost as a fraction of direct permanent invesment.</span>
<span class="sd">            * **Other recurring costs:** Any additional recurring costs per year of operation.</span>
<span class="sd">            * **Other fixed capital:** Any additional investment not accounted for.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">system</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system</span> <span class="o">=</span> <span class="n">system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_options</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_default</span><span class="p">)</span>
        
        <span class="c1"># [dict] Cached values from &#39;_init&#39; methods:</span>
        <span class="c1">#  {operating_days: flowrate_factor,</span>
        <span class="c1">#   year_duration: (duration_array, cashflow_data),</span>
        <span class="c1">#   depreciation_schedule: (start, Depreciation, D_len, schedule)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cached</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1">#: Guess IRR for solve_IRR method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_IRR_guess</span> <span class="o">=</span> <span class="mf">0.15</span>
        
        <span class="c1">#: Guess stream cost for solve_price method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cost_guess</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="n">units</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">_costunits</span>
        
        <span class="c1">#: list[Unit] All unit operations considered</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="o">=</span> <span class="n">units</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_costarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">units</span><span class="p">),</span> <span class="mi">2</span><span class="p">])</span>
        
        <span class="n">system</span><span class="o">.</span><span class="n">_TEA</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">utility_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Total utility cost (USD/hr).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">u</span><span class="o">.</span><span class="n">utility_cost</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="p">])</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">purchase_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Total purchase cost (USD).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">u</span><span class="o">.</span><span class="n">purchase_cost</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="p">])</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">intallation_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Total installation cost (USD).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">u</span><span class="o">.</span><span class="n">installation_cost</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="p">])</span>

<div class="viewcode-block" id="TEA.get_cashflow"><a class="viewcode-back" href="../../TEA.html#biosteam.TEA.get_cashflow">[docs]</a>    <span class="k">def</span> <span class="nf">get_cashflow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return DataFrame of the cash flow analysis.&quot;&quot;&quot;</span>
        <span class="n">flow_factor</span><span class="p">,</span> <span class="n">cashflow_info</span><span class="p">,</span> <span class="n">depreciation_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cached_data</span><span class="p">()</span>
        <span class="n">cashflow_data</span><span class="p">,</span> <span class="n">duration_array</span> <span class="o">=</span> <span class="n">cashflow_info</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_parameters</span><span class="p">(</span><span class="n">flow_factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calc_cashflow</span><span class="p">(</span><span class="n">cashflow_data</span><span class="p">,</span>
                            <span class="n">parameters</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span>
                            <span class="n">depreciation_data</span><span class="p">)</span>
        <span class="n">CF</span><span class="p">,</span> <span class="n">DCF</span><span class="p">,</span> <span class="n">CPV</span> <span class="o">=</span> <span class="n">cashflow_data</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span>
        <span class="n">DCF</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">CF</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;IRR&#39;</span><span class="p">])</span><span class="o">**</span><span class="n">duration_array</span>
        <span class="n">CPV</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">DCF</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cashflow</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a dictionary of summarized results of cash flow analysis.&quot;&quot;&quot;</span>
        <span class="n">flow_factor</span><span class="p">,</span> <span class="n">cashflow_info</span><span class="p">,</span> <span class="n">depreciation_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cached_data</span><span class="p">()</span>
        <span class="n">cashflow_data</span><span class="p">,</span> <span class="n">duration_array</span> <span class="o">=</span> <span class="n">cashflow_info</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_parameters</span><span class="p">(</span><span class="n">flow_factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calc_cashflow</span><span class="p">(</span><span class="n">cashflow_data</span><span class="p">,</span>
                            <span class="n">parameters</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span>
                            <span class="n">depreciation_data</span><span class="p">)</span>
        <span class="n">NPV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_NPV</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;IRR&#39;</span><span class="p">],</span>
                             <span class="n">cashflow_data</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span>
                             <span class="n">duration_array</span><span class="p">)</span>
        <span class="n">DC</span><span class="p">,</span> <span class="n">FCI</span><span class="p">,</span> <span class="n">WC</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">tax</span><span class="p">,</span> <span class="n">UC</span><span class="p">,</span> <span class="n">MC</span><span class="p">,</span> <span class="n">L</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">FCI</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;Duration&#39;</span><span class="p">]</span>
        <span class="n">AOC</span> <span class="o">=</span> <span class="n">C</span> <span class="o">+</span> <span class="n">D</span>
        <span class="n">TCI</span> <span class="o">=</span> <span class="n">FCI</span> <span class="o">+</span> <span class="n">WC</span>
        <span class="n">net_earnings</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">tax</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">S</span><span class="o">-</span><span class="n">AOC</span><span class="p">)</span>
        <span class="n">ROI</span> <span class="o">=</span> <span class="n">net_earnings</span><span class="o">/</span><span class="n">TCI</span>
        <span class="n">PBP</span> <span class="o">=</span> <span class="n">FCI</span><span class="o">/</span><span class="p">(</span><span class="n">net_earnings</span> <span class="o">+</span> <span class="n">D</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Depreciable capital&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DC</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Fixed capital investment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FCI</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Working capital&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">WC</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Total capital investment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TCI</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Depreciation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Utility cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">UC</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Material cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MC</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Sales&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Labor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Annual operating cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">AOC</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Net present value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NPV</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Return on investment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ROI</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Pay back period&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PBP</span>
        <span class="k">return</span> <span class="n">r</span>

<div class="viewcode-block" id="TEA.results"><a class="viewcode-back" href="../../TEA.html#biosteam.TEA.results">[docs]</a>    <span class="k">def</span> <span class="nf">results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_units</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return results of techno-economic analysis as a DataFrame object if `with_units` is True or as a Series otherwise.&quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">()</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">addkey</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">append</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">addval</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">append</span>
        <span class="k">if</span> <span class="n">with_units</span><span class="p">:</span>
            <span class="n">results_units</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Pay back period&#39;</span><span class="p">:</span> <span class="s1">&#39;yr&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;Return on investment&#39;</span><span class="p">:</span> <span class="s1">&#39;1/yr&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;Net present value&#39;</span><span class="p">:</span> <span class="s1">&#39;USD&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;Depreciable capital&#39;</span><span class="p">:</span> <span class="s1">&#39;USD&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;Fixed capital investment&#39;</span><span class="p">:</span> <span class="s1">&#39;USD&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;Total capital investment&#39;</span><span class="p">:</span> <span class="s1">&#39;USD&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;Depreciation&#39;</span><span class="p">:</span> <span class="s1">&#39;USD/yr&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;Annual operating cost&#39;</span><span class="p">:</span> <span class="s1">&#39;USD/yr&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;Working capital&#39;</span><span class="p">:</span> <span class="s1">&#39;USD&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;Utility cost&#39;</span><span class="p">:</span> <span class="s1">&#39;USD/yr&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;Material cost&#39;</span><span class="p">:</span> <span class="s1">&#39;USD/yr&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;Sales&#39;</span><span class="p">:</span> <span class="s1">&#39;USD/yr&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;Labor&#39;</span><span class="p">:</span> <span class="s1">&#39;USD/yr&#39;</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">ki</span><span class="p">,</span> <span class="n">vi</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">addkey</span><span class="p">(</span><span class="n">ki</span><span class="p">)</span>
                <span class="n">addval</span><span class="p">((</span><span class="n">results_units</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ki</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">vi</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Units&#39;</span><span class="p">,</span> <span class="s1">&#39;Value&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">r</span><span class="p">)</span></div>

<div class="viewcode-block" id="TEA.NPV"><a class="viewcode-back" href="../../TEA.html#biosteam.TEA.NPV">[docs]</a>    <span class="k">def</span> <span class="nf">NPV</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate NPV by cash flow analysis.&quot;&quot;&quot;</span>
        <span class="n">flow_factor</span><span class="p">,</span> <span class="n">cashflow_info</span><span class="p">,</span> <span class="n">depreciation_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cached_data</span><span class="p">()</span>
        <span class="n">cashflow_data</span><span class="p">,</span> <span class="n">duration_array</span> <span class="o">=</span> <span class="n">cashflow_info</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_parameters</span><span class="p">(</span><span class="n">flow_factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calc_cashflow</span><span class="p">(</span><span class="n">cashflow_data</span><span class="p">,</span>
                            <span class="n">parameters</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span>
                            <span class="n">depreciation_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_NPV</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;IRR&#39;</span><span class="p">],</span>
                              <span class="n">cashflow_data</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span>
                              <span class="n">duration_array</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="TEA.production_cost"><a class="viewcode-back" href="../../TEA.html#biosteam.TEA.production_cost">[docs]</a>    <span class="k">def</span> <span class="nf">production_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">products</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return production cost of products.</span>
<span class="sd">        </span>
<span class="sd">        **Parameters**</span>
<span class="sd">        </span>
<span class="sd">            ***products:** [Stream] Main products of the system</span>
<span class="sd">        </span>
<span class="sd">        .. Note::</span>
<span class="sd">           If there is more than one main product, The production cost is proportionally allocated to each of the main products with respect to their marketing values. The marketing value of each product is determined by the annual production multiplied by its selling price.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span>
        <span class="n">sysfeeds</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">feeds</span>
        <span class="n">sysproducts</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">products</span>
        <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span>
        <span class="n">flow_factor</span> <span class="o">=</span> <span class="mi">24</span><span class="o">*</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;Operating days&#39;</span><span class="p">]</span>
        <span class="c1"># DPI_: Direct permanent investment (USD)</span>
        <span class="c1"># DC_: Depreciable capital (USD)</span>
        <span class="c1"># UC_: utility cost (USD/hr)</span>
        <span class="n">costarr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_costarr</span>
        <span class="n">F_lang</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Lang factor&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">F_lang</span><span class="p">:</span>
            <span class="n">costarr</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">u</span><span class="o">.</span><span class="n">purchase_cost</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">utility_cost</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="p">]</span>
            <span class="n">DC_</span><span class="p">,</span> <span class="n">UC_</span> <span class="o">=</span> <span class="n">costarr</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> 
            <span class="n">DC_</span> <span class="o">*=</span>  <span class="n">F_lang</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">costarr</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">u</span><span class="o">.</span><span class="n">installation_cost</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">utility_cost</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="p">]</span>
            <span class="n">DPI_</span><span class="p">,</span> <span class="n">UC_</span> <span class="o">=</span> <span class="n">costarr</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> 
            <span class="n">DC_</span> <span class="o">=</span> <span class="n">DPI_</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Contingency&#39;</span><span class="p">])</span>
        <span class="n">FC_</span> <span class="o">=</span> <span class="n">DC_</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Startup&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Land&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Royalties&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Other fixed capital&#39;</span><span class="p">]</span>
        <span class="n">MC_</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Material cost USD/hr</span>
        <span class="n">CP_</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Coproducts USD/hr</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sysfeeds</span><span class="p">:</span>
            <span class="n">price</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">price</span>
            <span class="k">if</span> <span class="n">price</span><span class="p">:</span> <span class="n">MC_</span> <span class="o">+=</span> <span class="n">price</span><span class="o">*</span><span class="n">s</span><span class="o">.</span><span class="n">massnet</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sysproducts</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">products</span><span class="p">:</span>
                <span class="n">price</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">price</span>
                <span class="k">if</span> <span class="n">price</span><span class="p">:</span> <span class="n">CP_</span> <span class="o">+=</span> <span class="n">price</span><span class="o">*</span><span class="n">s</span><span class="o">.</span><span class="n">massnet</span>
        <span class="c1"># Multiply by flow_factor for USD/yr</span>
        <span class="n">UC_</span> <span class="o">*=</span> <span class="n">flow_factor</span>
        <span class="n">MC_</span> <span class="o">*=</span> <span class="n">flow_factor</span>
        <span class="n">CP_</span> <span class="o">*=</span> <span class="n">flow_factor</span>
        <span class="n">fb</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Fringe benefits&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Supplies&#39;</span><span class="p">]</span>
        <span class="n">f</span> <span class="o">=</span>  <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;Maintenance&#39;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Administration&#39;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Property tax&#39;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Property insurance&#39;</span><span class="p">])</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">DC_</span><span class="o">/</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;Duration&#39;</span><span class="p">]</span> <span class="c1"># Depreciation</span>
        <span class="n">L_</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Wage&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;Employees&#39;</span><span class="p">]</span>
        <span class="n">total_operating_cost</span> <span class="o">=</span> <span class="n">UC_</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">fb</span><span class="p">)</span><span class="o">*</span><span class="n">L_</span> <span class="o">+</span> <span class="n">MC_</span> <span class="o">+</span> <span class="n">f</span><span class="o">*</span><span class="n">FC_</span> <span class="o">+</span> <span class="n">d</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Other recurring costs&#39;</span><span class="p">]</span>
        <span class="n">market_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">cost</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">products</span><span class="p">])</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">market_values</span><span class="o">/</span><span class="n">market_values</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">production_cost</span> <span class="o">=</span> <span class="n">weights</span><span class="o">*</span><span class="n">total_operating_cost</span>
        <span class="k">return</span> <span class="n">production_cost</span></div>
    
    <span class="k">def</span> <span class="nf">_get_cached_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return cached data.</span>
<span class="sd">        </span>
<span class="sd">        **Return:** [tuple] including:</span>
<span class="sd">        </span>
<span class="sd">            **flow_factor:** [float] Factor to convert flow rate from kg/hr to kg/yr of operation.</span>
<span class="sd">            </span>
<span class="sd">            **cashflow_info:** [tuple] including:</span>
<span class="sd">                * cashflow_data: Cash flow data table</span>
<span class="sd">                * duration_array: Range from 1 to the end of the project length</span>
<span class="sd">        </span>
<span class="sd">            **depreciation_data:** [tuple] including:</span>
<span class="sd">                * start: Index of year when operation starts</span>
<span class="sd">                * Depreciation: Array of depreciation as a fraction of fixed cost</span>
<span class="sd">                * D_len: Lenght of depreciation</span>
<span class="sd">                * index_startup: Year index and fixed capital investment fractions</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Keys for cached data</span>
        <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span>
        <span class="n">cached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached</span>
        
        <span class="c1"># Get and update cached data</span>
        <span class="n">operating_days</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Operating days&#39;</span><span class="p">]</span>
        <span class="n">flow_factor</span> <span class="o">=</span> <span class="n">cached</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">operating_days</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">flow_factor</span><span class="p">:</span>
            <span class="n">cached</span><span class="p">[</span><span class="n">operating_days</span><span class="p">]</span> <span class="o">=</span> <span class="n">flow_factor</span> <span class="o">=</span> <span class="mi">24</span><span class="o">*</span><span class="n">operating_days</span>
        
        <span class="n">year_duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">],</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Duration&#39;</span><span class="p">])</span>
        <span class="n">cashflow_info</span> <span class="o">=</span> <span class="n">cached</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">year_duration</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cashflow_info</span><span class="p">:</span>
            <span class="n">year</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">year_duration</span>
            <span class="n">index</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">year</span> <span class="o">+</span> <span class="n">duration</span><span class="p">))</span> <span class="k">if</span> <span class="n">year</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">duration</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
            <span class="n">cashflow_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cashflow</span> <span class="o">=</span> <span class="n">_DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">_cashflow_columns</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">duration_array</span> <span class="o">=</span> <span class="n">_array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">duration</span><span class="p">))</span>
            <span class="n">cached</span><span class="p">[</span><span class="n">year_duration</span><span class="p">]</span> <span class="o">=</span> <span class="n">cashflow_info</span> <span class="o">=</span> <span class="p">(</span><span class="n">cashflow_data</span><span class="p">,</span> <span class="n">duration_array</span><span class="p">)</span>
        
        <span class="n">depreciation_schedule</span> <span class="o">=</span> <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;Depreciation&#39;</span><span class="p">],</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Startup schedule&#39;</span><span class="p">])</span>
        <span class="n">depreciation_data</span> <span class="o">=</span> <span class="n">cached</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">depreciation_schedule</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">depreciation_data</span><span class="p">:</span>
            <span class="n">depreciation</span><span class="p">,</span> <span class="n">schedule</span> <span class="o">=</span> <span class="n">depreciation_schedule</span>
            <span class="n">Depreciation</span> <span class="o">=</span> <span class="n">_MACRS</span><span class="p">[</span><span class="n">depreciation</span><span class="p">]</span>
            <span class="n">start</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">schedule</span><span class="p">)</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">Depreciation</span><span class="p">)</span>
            <span class="n">schedule</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">schedule</span><span class="p">)</span>
            <span class="n">depreciation_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span>
                                 <span class="n">Depreciation</span><span class="p">,</span>
                                 <span class="n">end</span><span class="p">,</span>
                                 <span class="n">schedule</span><span class="p">)</span>
            <span class="n">cached</span><span class="p">[</span><span class="n">depreciation_schedule</span><span class="p">]</span> <span class="o">=</span> <span class="n">depreciation_data</span>
        
        <span class="k">return</span> <span class="n">flow_factor</span><span class="p">,</span> <span class="n">cashflow_info</span><span class="p">,</span> <span class="n">depreciation_data</span>
    
    <span class="k">def</span> <span class="nf">_calc_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow_factor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return elementary cash flow parameters.&quot;&quot;&quot;</span>
        <span class="c1"># Cash flow parameters (USD or USD/yr)</span>
        <span class="c1"># DC_: Depreciable capital</span>
        <span class="c1"># FC_: Fixed capital</span>
        <span class="c1"># WC_: Working capital</span>
        <span class="c1"># UC_: Utility cost</span>
        <span class="c1"># MC_: Material cost</span>
        <span class="c1"># S_: Sales</span>
        <span class="c1"># L_: Labor cost</span>
        <span class="c1"># C_: Annual operating cost (excluding depreciation)</span>
        
        <span class="n">system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span>
        <span class="n">feeds</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">feeds</span>
        <span class="n">products</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">products</span>
        <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span>
        <span class="c1"># DC_: Depreciable capital (USD)</span>
        <span class="c1"># UC_: utility cost (USD/hr)</span>
        <span class="n">costarr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_costarr</span>
        <span class="n">F_lang</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Lang factor&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">F_lang</span><span class="p">:</span>
            <span class="n">costarr</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">u</span><span class="o">.</span><span class="n">purchase_cost</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">utility_cost</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="p">]</span>
            <span class="n">DC_</span><span class="p">,</span> <span class="n">UC_</span> <span class="o">=</span> <span class="n">costarr</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> 
            <span class="n">DC_</span> <span class="o">*=</span>  <span class="n">F_lang</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">costarr</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">u</span><span class="o">.</span><span class="n">installation_cost</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">utility_cost</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="p">]</span>
            <span class="n">DPI_</span><span class="p">,</span> <span class="n">UC_</span> <span class="o">=</span> <span class="n">costarr</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> 
            <span class="n">DC_</span> <span class="o">=</span> <span class="n">DPI_</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Contingency&#39;</span><span class="p">])</span>
        <span class="n">FC_</span> <span class="o">=</span> <span class="n">DC_</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Startup&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Land&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Royalties&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Other fixed capital&#39;</span><span class="p">]</span>
        <span class="n">MC_</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Material cost USD/hr</span>
        <span class="n">S_</span>  <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Sales USD/hr</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">feeds</span><span class="p">:</span>
            <span class="n">price</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">price</span>
            <span class="k">if</span> <span class="n">price</span><span class="p">:</span> <span class="n">MC_</span> <span class="o">+=</span> <span class="n">price</span><span class="o">*</span><span class="n">s</span><span class="o">.</span><span class="n">massnet</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">products</span><span class="p">:</span>
            <span class="n">price</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">price</span>
            <span class="k">if</span> <span class="n">price</span><span class="p">:</span> <span class="n">S_</span> <span class="o">+=</span> <span class="n">price</span><span class="o">*</span><span class="n">s</span><span class="o">.</span><span class="n">massnet</span>
        <span class="c1"># Multiply by flow_factor for USD/yr</span>
        <span class="n">UC_</span> <span class="o">*=</span> <span class="n">flow_factor</span>
        <span class="n">MC_</span> <span class="o">*=</span> <span class="n">flow_factor</span>
        <span class="n">S_</span> <span class="o">*=</span> <span class="n">flow_factor</span>
        <span class="n">FC_</span> <span class="o">=</span> <span class="n">DC_</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Startup&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Land&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Royalties&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Other fixed capital&#39;</span><span class="p">]</span>
        <span class="n">fb</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Fringe benefits&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Supplies&#39;</span><span class="p">]</span>
        <span class="n">f</span> <span class="o">=</span>  <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;Maintenance&#39;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Administration&#39;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Property tax&#39;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Property insurance&#39;</span><span class="p">])</span>
        <span class="n">WC_</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Working capital&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">FC_</span>
        <span class="n">L_</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Wage&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;Employees&#39;</span><span class="p">]</span>
        <span class="n">C_</span> <span class="o">=</span> <span class="n">UC_</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">fb</span><span class="p">)</span><span class="o">*</span><span class="n">L_</span> <span class="o">+</span> <span class="n">MC_</span> <span class="o">+</span> <span class="n">f</span><span class="o">*</span><span class="n">FC_</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Other recurring costs&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">DC_</span><span class="p">,</span> <span class="n">FC_</span><span class="p">,</span> <span class="n">WC_</span><span class="p">,</span> <span class="n">S_</span><span class="p">,</span> <span class="n">C_</span><span class="p">,</span> <span class="n">o</span><span class="p">[</span><span class="s1">&#39;Income tax&#39;</span><span class="p">],</span> <span class="n">UC_</span><span class="p">,</span> <span class="n">MC_</span><span class="p">,</span> <span class="n">L_</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_calc_cashflow</span><span class="p">(</span><span class="n">cashflow_data</span><span class="p">,</span>
                       <span class="n">parameters</span><span class="p">,</span>
                       <span class="n">depreciation_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Perform cash flow analysis and return net present value.&quot;&quot;&quot;</span>
        <span class="c1"># Cash flow data and parameters</span>
        <span class="c1"># C_DC: Depreciable capital</span>
        <span class="c1"># C_FC: Fixed capital</span>
        <span class="c1"># C_WC: Working capital</span>
        <span class="c1"># D: Depreciation</span>
        <span class="c1"># C: Annual operating cost (excluding depreciation)</span>
        <span class="c1"># S: Sales</span>
        <span class="c1"># NE: Net earnings</span>
        <span class="c1"># CF: Cash flow</span>
        <span class="c1"># DCF: Discounted cash flow</span>
        <span class="c1"># CPV: Cumulative present value</span>
        <span class="n">C_DC</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">C_FC</span><span class="p">,</span> <span class="n">C_WC</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">NE</span><span class="p">,</span> <span class="n">CF</span><span class="p">,</span> <span class="n">DCF</span><span class="p">,</span> <span class="n">CPV</span> <span class="o">=</span> <span class="n">cashflow_data</span>
        <span class="n">DC_</span><span class="p">,</span> <span class="n">FC_</span><span class="p">,</span> <span class="n">WC_</span><span class="p">,</span> <span class="n">S_</span><span class="p">,</span> <span class="n">C_</span><span class="p">,</span> <span class="n">tax</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">Depreciation</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">schedule</span> <span class="o">=</span> <span class="n">depreciation_data</span>
        
        <span class="c1"># Calculate</span>
        <span class="n">D</span><span class="p">[:]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">C_DC</span><span class="p">[:</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="n">DC_</span><span class="o">*</span><span class="n">schedule</span>
        <span class="n">C_FC</span><span class="p">[:</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="n">FC_</span><span class="o">*</span><span class="n">schedule</span>
        <span class="n">D</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="n">DC_</span><span class="o">*</span><span class="n">Depreciation</span>
        <span class="n">C_WC</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="n">WC_</span>
        <span class="n">C_WC</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">WC_</span>
        <span class="n">C</span><span class="p">[</span><span class="n">start</span><span class="p">:]</span> <span class="o">=</span> <span class="n">C_</span>
        <span class="n">S</span><span class="p">[</span><span class="n">start</span><span class="p">:]</span> <span class="o">=</span> <span class="n">S_</span>
        <span class="n">NE</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span> <span class="o">-</span> <span class="n">C</span> <span class="o">-</span> <span class="n">D</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">tax</span><span class="p">)</span>
        <span class="n">CF</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">NE</span> <span class="o">+</span> <span class="n">D</span><span class="p">)</span> <span class="o">-</span> <span class="n">C_FC</span> <span class="o">-</span> <span class="n">C_WC</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_calc_NPV</span><span class="p">(</span><span class="n">IRR</span><span class="p">,</span> <span class="n">CF</span><span class="p">,</span> <span class="n">duration_array</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return NPV at given IRR and cashflow data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">CF</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">IRR</span><span class="p">)</span><span class="o">**</span><span class="n">duration_array</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<div class="viewcode-block" id="TEA.solve_IRR"><a class="viewcode-back" href="../../TEA.html#biosteam.TEA.solve_IRR">[docs]</a>    <span class="k">def</span> <span class="nf">solve_IRR</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the IRR at the break even point (NPV = 0) through cash flow analysis.&quot;&quot;&quot;</span>
        <span class="c1"># Calculate cashflow table</span>
        <span class="n">flow_factor</span><span class="p">,</span> <span class="n">cashflow_info</span><span class="p">,</span> <span class="n">depreciation_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cached_data</span><span class="p">()</span>
        <span class="n">cashflow_data</span><span class="p">,</span> <span class="n">duration_array</span> <span class="o">=</span> <span class="n">cashflow_info</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_parameters</span><span class="p">(</span><span class="n">flow_factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calc_cashflow</span><span class="p">(</span><span class="n">cashflow_data</span><span class="p">,</span>
                            <span class="n">parameters</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span>
                            <span class="n">depreciation_data</span><span class="p">)</span>
        <span class="c1"># Solve</span>
        <span class="n">IRR</span> <span class="o">=</span> <span class="n">wegstein_secant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_calc_NPV</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_IRR_guess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_IRR_guess</span><span class="o">+</span><span class="mf">1e-6</span><span class="p">,</span>
                              <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">cashflow_data</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span> <span class="n">duration_array</span><span class="p">),</span>
                              <span class="n">xtol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span>
                              <span class="n">maxiter</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_IRR_guess</span> <span class="o">=</span> <span class="n">IRR</span> <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;</span> <span class="n">IRR</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="mf">0.15</span>
        <span class="k">return</span> <span class="n">IRR</span></div>
    
<div class="viewcode-block" id="TEA.solve_price"><a class="viewcode-back" href="../../TEA.html#biosteam.TEA.solve_price">[docs]</a>    <span class="k">def</span> <span class="nf">solve_price</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the price (USD/kg) of stream at the break even point (NPV = 0) through cash flow analysis. </span>
<span class="sd">        </span>
<span class="sd">        **Parameters**</span>
<span class="sd">        </span>
<span class="sd">            **stream:** [Stream] Stream with variable selling price.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate cashflow table</span>
        <span class="n">flow_factor</span><span class="p">,</span> <span class="n">cashflow_info</span><span class="p">,</span> <span class="n">depreciation_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cached_data</span><span class="p">()</span>
        <span class="n">cashflow_data</span><span class="p">,</span> <span class="n">duration_array</span> <span class="o">=</span> <span class="n">cashflow_info</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_parameters</span><span class="p">(</span><span class="n">flow_factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calc_cashflow</span><span class="p">(</span><span class="n">cashflow_data</span><span class="p">,</span>
                            <span class="n">parameters</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span>
                            <span class="n">depreciation_data</span><span class="p">)</span>
        
        <span class="c1"># Create function that adjusts cash flow with new stream price</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">depreciation_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tax</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">IRR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;IRR&#39;</span><span class="p">]</span>
        <span class="n">cost_factor</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">massnet</span><span class="o">*</span><span class="n">flow_factor</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">tax</span><span class="p">)</span>
        <span class="n">CF</span> <span class="o">=</span> <span class="n">cashflow_data</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">][</span><span class="n">start</span><span class="p">:]</span>
        <span class="n">CF_copy</span> <span class="o">=</span> <span class="n">_array</span><span class="p">(</span><span class="n">CF</span><span class="p">)</span>
        <span class="n">system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span>
        <span class="k">if</span> <span class="n">stream</span> <span class="ow">in</span> <span class="n">system</span><span class="o">.</span><span class="n">feeds</span><span class="p">:</span>
            <span class="n">adjust</span> <span class="o">=</span> <span class="n">CF_copy</span><span class="o">.</span><span class="fm">__sub__</span>
        <span class="k">elif</span> <span class="n">stream</span> <span class="ow">in</span> <span class="n">system</span><span class="o">.</span><span class="n">products</span><span class="p">:</span>
            <span class="n">adjust</span> <span class="o">=</span> <span class="n">CF_copy</span><span class="o">.</span><span class="fm">__add__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;stream must be either a feed or a product of the system&quot;</span><span class="p">)</span>
        
        <span class="c1"># Solve</span>
        <span class="n">calc_NPV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_NPV</span>
        <span class="n">data_subset</span> <span class="o">=</span> <span class="n">cashflow_data</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">break_even_point</span><span class="p">(</span><span class="n">cost</span><span class="p">):</span>
            <span class="n">CF</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">adjust</span><span class="p">(</span><span class="n">cost</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">calc_NPV</span><span class="p">(</span><span class="n">IRR</span><span class="p">,</span> <span class="n">data_subset</span><span class="p">,</span> <span class="n">duration_array</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cost_guess</span> <span class="o">=</span> <span class="n">cost</span> <span class="o">=</span> <span class="n">wegstein_secant</span><span class="p">(</span><span class="n">break_even_point</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">_cost_guess</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">_cost_guess</span><span class="o">+</span><span class="mf">1e-6</span><span class="p">,</span>
                                                  <span class="n">xtol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span>
                                                  <span class="n">maxiter</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stream</span><span class="o">.</span><span class="n">price</span> <span class="o">+</span> <span class="n">cost</span><span class="o">/</span><span class="n">cost_factor</span></div>
    
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">f</span><span class="s1">&#39;&lt;{type(self).__name__}: </span><span class="si">{self.system.ID}</span><span class="s1">&gt;&#39;</span>
    
    <span class="k">def</span> <span class="nf">_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">()</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;{type(self).__name__}: </span><span class="si">{self.system.ID}</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">IRR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;IRR&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span>
        <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
            <span class="n">NPV</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Net present value&#39;</span><span class="p">]</span>
            <span class="n">ROI</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Return on investment&#39;</span><span class="p">]</span>
            <span class="n">PBP</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;Pay back period&#39;</span><span class="p">]</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">f</span><span class="s1">&#39; NPV: </span><span class="si">{NPV:.3g}</span><span class="s1"> USD at </span><span class="si">{IRR:.1f}</span><span class="s1">% IRR</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">f</span><span class="s1">&#39; ROI: </span><span class="si">{ROI:.3g}</span><span class="s1"> 1/yr</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">f</span><span class="s1">&#39; PBP: </span><span class="si">{PBP:.3g}</span><span class="s1"> yr&#39;</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">f</span><span class="s1">&#39; NPV: None</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">f</span><span class="s1">&#39; ROI: None</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">f</span><span class="s1">&#39; PBP: None&#39;</span>
        <span class="k">return</span> <span class="n">out</span>
    
<div class="viewcode-block" id="TEA.show"><a class="viewcode-back" href="../../TEA.html#biosteam.TEA.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prints information on unit.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">())</span></div>
    <span class="n">_ipython_display_</span> <span class="o">=</span> <span class="n">show</span></div>
        
        
    
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Yoel Cortes-Pena and Jeremy Guest

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>